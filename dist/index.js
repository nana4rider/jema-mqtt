import { createRequire } from "module"; import url from "url"; const require = createRequire(import.meta.url); const __filename = url.fileURLToPath(import.meta.url); const __dirname = url.fileURLToPath(new URL(".", import.meta.url));
var l_=Object.create;var Pl=Object.defineProperty;var u_=Object.getOwnPropertyDescriptor;var c_=Object.getOwnPropertyNames;var f_=Object.getPrototypeOf,h_=Object.prototype.hasOwnProperty;var E=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var g=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var d_=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of c_(e))!h_.call(t,n)&&n!==r&&Pl(t,n,{get:()=>e[n],enumerable:!(i=u_(e,n))||i.enumerable});return t};var as=(t,e,r)=>(r=t!=null?l_(f_(t)):{},d_(e||!t||!t.__esModule?Pl(r,"default",{value:t,enumerable:!0}):r,t));var kl=g(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.OperationError=se.InvalidAccessError=se.GPIOPort=se.GPIOPortMap=se.GPIOAccess=void 0;se.requestGPIOAccess=y_;var Rl=E("node:events"),Kt=E("node:fs"),p_=E("node:os"),Yt=E("node:path"),g_=100,Qt="/sys/class/gpio",__=1024,Cl=65535;function ls(t){let e=Number.parseInt(t,10);if(0<=e&&e<=Cl)return e;throw new RangeError(`Must be between 0 and ${Cl}.`)}var b_=process.platform==="linux"&&6.6<=Number(p_.release().match(/\d+\.\d+/))?512:0,wi=class extends Rl.EventEmitter{_ports;onchange;constructor(e){super(),this._ports=e??new Mr,this._ports.forEach(r=>r.on("change",i=>{this.emit("change",i)})),this.on("change",r=>{this.onchange!==void 0&&this.onchange(r)})}get ports(){return this._ports}async unexportAll(){await Promise.all([...this.ports.values()].map(e=>e.exported?e.unexport():void 0))}};se.GPIOAccess=wi;var Mr=class extends Map{};se.GPIOPortMap=Mr;var Si=class extends Rl.EventEmitter{_portNumber;_pollingInterval;_direction;_exported;_exportRetry;_value;_timeout;onchange;constructor(e){super(),this._portNumber=ls(e.toString())+b_,this._pollingInterval=g_,this._direction=new ye("Unknown direction."),this._exported=new ye("Unknown export."),this._exportRetry=0,this.on("change",r=>{this.onchange!==void 0&&this.onchange(r)})}get portNumber(){return this._portNumber}get portName(){return`gpio${this.portNumber}`}get pinName(){return""}get direction(){if(this._direction instanceof ye)throw this._direction;return this._direction}get exported(){if(this._exported instanceof ye)throw this._exported;return this._exported}async export(e){if(!/^(in|out)$/.test(e))throw new Jt('Must be "in" or "out".');try{await Kt.promises.access(Yt.join(Qt,this.portName)),this._exported=!0}catch{this._exported=!1}try{clearInterval(this._timeout),this.exported||await Kt.promises.writeFile(Yt.join(Qt,"export"),String(this.portNumber)),await Kt.promises.writeFile(Yt.join(Qt,this.portName,"direction"),e),e==="in"&&(this._timeout=setInterval(this.read.bind(this),this._pollingInterval))}catch(r){if(this._exportRetry<10)await m_(100),console.warn("May be the first time port access. Retry.."),++this._exportRetry,await this.export(e);else throw new ye(r)}this._direction=e,this._exported=!0}async unexport(){clearInterval(this._timeout);try{await Kt.promises.writeFile(Yt.join(Qt,"unexport"),String(this.portNumber))}catch(e){throw new ye(e)}this._exported=!1}async read(){if(!(this.exported&&this.direction==="in"))throw new Jt('The exported must be true and value of direction must be "in".');try{let e=await Kt.promises.readFile(Yt.join(Qt,this.portName,"value")),r=ls(e.toString());return this._value!==r&&(this._value=r,this.emit("change",{value:r,port:this})),r}catch(e){throw new ye(e)}}async write(e){if(!(this.exported&&this.direction==="out"))throw new Jt('The exported must be true and value of direction must be "out".');try{await Kt.promises.writeFile(Yt.join(Qt,this.portName,"value"),ls(e.toString()).toString())}catch(r){throw new ye(r)}}};se.GPIOPort=Si;var Jt=class extends Error{constructor(e){super(e),this.name=this.constructor.name}};se.InvalidAccessError=Jt;var ye=class extends Error{constructor(e){super(e),this.name=this.constructor.name}};se.OperationError=ye;async function y_(){let t=new Mr([...Array(__).keys()].map(e=>[e,new Si(e)]));return new wi(t)}function m_(t){return new Promise(e=>setTimeout(e,t))}});var Ei=g((mA,Bl)=>{"use strict";var cs=class t extends Error{constructor(e,...r){super(`env-var: ${e}`,...r),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.name="EnvVarError"}};Bl.exports=cs});var Xt=g((wA,ql)=>{"use strict";ql.exports=function(e){return e}});var fs=g((SA,Nl)=>{"use strict";var E_=Xt();Nl.exports=function(e,r){return r=r||",",e.length?E_(e).split(r).filter(Boolean):[]}});var jl=g((EA,Ll)=>{"use strict";var v_=fs();Ll.exports=function(e,r){return e.length?new Set(v_(e,r)):new Set}});var Ul=g((vA,Dl)=>{"use strict";Dl.exports=function(e){let r=e.toLowerCase();if(r!=="false"&&r!=="true")throw new Error('should be either "true", "false", "TRUE", or "FALSE"');return r!=="false"}});var Fl=g((TA,Wl)=>{"use strict";Wl.exports=function(e){let r=e.toLowerCase();if(["false","0","true","1"].indexOf(r)===-1)throw new Error('should be either "true", "false", "TRUE", "FALSE", 1, or 0');return!(r==="0"||r==="false")}});var vi=g((AA,$l)=>{"use strict";$l.exports=function(e){let r=parseInt(e,10);if(isNaN(r)||r.toString(10)!==e)throw new Error("should be a valid integer");return r}});var hs=g((xA,Vl)=>{"use strict";var T_=vi();Vl.exports=function(e){let r=T_(e);if(r<0)throw new Error("should be a positive integer");return r}});var Gl=g((IA,Hl)=>{"use strict";var A_=hs();Hl.exports=function(e){var r=A_(e);if(r>65535)throw new Error("cannot assign a port number greater than 65535");return r}});var Kl=g((OA,zl)=>{"use strict";var x_=Xt();zl.exports=function(e,r){let i=x_(e);if(r.indexOf(i)<0)throw new Error(`should be one of [${r.join(", ")}]`);return i}});var Ti=g((PA,Yl)=>{"use strict";Yl.exports=function(e){let r=parseFloat(e);if(isNaN(r)||isNaN(e))throw new Error("should be a valid float");return r}});var Jl=g((CA,Ql)=>{"use strict";var I_=Ti();Ql.exports=function(e){let r=I_(e);if(r>0)throw new Error("should be a negative float");return r}});var Zl=g((RA,Xl)=>{"use strict";var O_=Ti();Xl.exports=function(e){let r=O_(e);if(r<0)throw new Error("should be a positive float");return r}});var tu=g((kA,eu)=>{"use strict";var P_=vi();eu.exports=function(e){let r=P_(e);if(r>0)throw new Error("should be a negative integer");return r}});var Ai=g((MA,ru)=>{"use strict";ru.exports=function(e){try{return JSON.parse(e)}catch{throw new Error("should be valid (parseable) JSON")}}});var nu=g((BA,iu)=>{"use strict";var C_=Ai();iu.exports=function(e){var r=C_(e);if(!Array.isArray(r))throw new Error("should be a parseable JSON Array");return r}});var ou=g((qA,su)=>{"use strict";var R_=Ai();su.exports=function(e){var r=R_(e);if(Array.isArray(r))throw new Error("should be a parseable JSON Object");return r}});var lu=g((NA,au)=>{"use strict";au.exports=function(e,r){try{RegExp(void 0,r)}catch{throw new Error("invalid regexp flags")}try{return new RegExp(e,r)}catch{throw new Error("should be a valid regexp")}}});var ds=g((LA,uu)=>{"use strict";var k_=Xt();uu.exports=function(e){let r=k_(e);try{return new URL(r)}catch{throw new Error("should be a valid URL")}}});var fu=g((jA,cu)=>{"use strict";var M_=ds();cu.exports=function(e){return M_(e).toString()}});var du=g((DA,hu)=>{"use strict";var B_=Xt(),q_=/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\u0001-\u0008\u000b\u000c\u000e-\u001f\u0021\u0023-\u005b\u005d-\u007f]|\\[\u0001-\u0009\u000b\u000c\u000e-\u007f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\u0001-\u0008\u000b\u000c\u000e-\u001f\u0021-\u005a\u0053-\u007f]|\\[\u0001-\u0009\u000b\u000c\u000e-\u007f])+)\])$/;hu.exports=function(e){let r=B_(e);if(!q_.test(r))throw new Error("should be a valid email address");return r}});var ps=g((UA,pu)=>{"use strict";pu.exports={asArray:fs(),asSet:jl(),asBoolStrict:Ul(),asBool:Fl(),asPortNumber:Gl(),asEnum:Kl(),asFloatNegative:Jl(),asFloatPositive:Zl(),asFloat:Ti(),asIntNegative:tu(),asIntPositive:hs(),asInt:vi(),asJsonArray:nu(),asJsonObject:ou(),asJson:Ai(),asRegExp:lu(),asString:Xt(),asUrlObject:ds(),asUrlString:fu(),asEmailString:du()}});var bu=g((WA,_u)=>{"use strict";var gu=Ei(),N_=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/;_u.exports=function(e,r,i,n){let s=!1,o=!1,a,l,u=ps();function f(_){n(r,_)}function c(_,p){let y=`"${r}" ${p}`;throw _&&(y=`${y}`),l&&(y=`${y}. An example of a valid value would be: ${l}`),new gu(y)}function h(_){return function(){let p=e[r];if(f(`will be read from the environment using "${_.name}" accessor`),typeof p>"u")if(typeof a>"u"&&o)f("was not found in the environment, but is required to be set"),c(void 0,"is a required variable, but it was not set");else if(typeof a<"u")f(`was not found in the environment, parsing default value "${a}" instead`),p=a;else{f("was not found in the environment, but is not required. returning undefined");return}o&&(f("verifying variable value is not an empty string"),p.trim().length===0&&c(void 0,"is a required variable, but its value was empty")),s&&(f("verifying variable is a valid base64 string"),p.match(N_)||c(p,"should be a valid base64 string if using convertFromBase64"),f("converting from base64 to utf8 string"),p=Buffer.from(p,"base64").toString());let y=[p].concat(Array.prototype.slice.call(arguments));try{f(`passing value "${p}" to "${_.name}" accessor`);let b=_.apply(_,y);return f(`parsed successfully, returning ${b}`),b}catch(b){c(p,b.message)}}}let d={convertFromBase64:function(){return f("marking for base64 conversion"),s=!0,d},default:function(_){if(typeof _=="number")a=_.toString();else if(Array.isArray(_)||typeof _=="object"&&_!==null)a=JSON.stringify(_);else{if(typeof _!="string")throw new gu("values passed to default() must be of Number, String, Array, or Object type");a=_}return f(`setting default value to "${a}"`),d},required:function(_){return typeof _>"u"?(f("marked as required"),o=!0):(f(`setting required flag to ${_}`),o=_),d},example:function(_){return l=_,d}};return Object.entries({...u,...i}).forEach(([_,p])=>{d[_]=h(p)}),d}});var mu=g((FA,yu)=>{"use strict";yu.exports=function(e,r){return function(n,s){(!r||!r.match(/prod|production/))&&e(`env-var (${n}): ${s}`)}}});var Eu=g(($A,Su)=>{"use strict";var L_=bu(),j_=Ei(),wu=(t,e,r)=>({from:wu,EnvVarError:Ei(),get:function(i){if(!i)return t;if(arguments.length>1)throw new j_("It looks like you passed more than one argument to env.get(). Since env-var@6.0.0 this is no longer supported. To set a default value use env.get(TARGET).default(DEFAULT)");return L_(t,i,e||{},r||function(){})},accessors:ps(),logger:mu()(console.log,t.NODE_ENV)});function D_(){try{return process.env}catch{return{}}}Su.exports=wu(D_())});var vu=g(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});var gs=class{constructor(e){this.aliasToTopic={},this.max=e}put(e,r){return r===0||r>this.max?!1:(this.aliasToTopic[r]=e,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(e){return this.aliasToTopic[e]}clear(){this.aliasToTopic={}}};_s.default=gs});var U=g((HA,Tu)=>{"use strict";Tu.exports={ArrayIsArray(t){return Array.isArray(t)},ArrayPrototypeIncludes(t,e){return t.includes(e)},ArrayPrototypeIndexOf(t,e){return t.indexOf(e)},ArrayPrototypeJoin(t,e){return t.join(e)},ArrayPrototypeMap(t,e){return t.map(e)},ArrayPrototypePop(t,e){return t.pop(e)},ArrayPrototypePush(t,e){return t.push(e)},ArrayPrototypeSlice(t,e,r){return t.slice(e,r)},Error,FunctionPrototypeCall(t,e,...r){return t.call(e,...r)},FunctionPrototypeSymbolHasInstance(t,e){return Function.prototype[Symbol.hasInstance].call(t,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(t,e){return Object.defineProperties(t,e)},ObjectDefineProperty(t,e,r){return Object.defineProperty(t,e,r)},ObjectGetOwnPropertyDescriptor(t,e){return Object.getOwnPropertyDescriptor(t,e)},ObjectKeys(t){return Object.keys(t)},ObjectSetPrototypeOf(t,e){return Object.setPrototypeOf(t,e)},Promise,PromisePrototypeCatch(t,e){return t.catch(e)},PromisePrototypeThen(t,e,r){return t.then(e,r)},PromiseReject(t){return Promise.reject(t)},PromiseResolve(t){return Promise.resolve(t)},ReflectApply:Reflect.apply,RegExpPrototypeTest(t,e){return t.test(e)},SafeSet:Set,String,StringPrototypeSlice(t,e,r){return t.slice(e,r)},StringPrototypeToLowerCase(t){return t.toLowerCase()},StringPrototypeToUpperCase(t){return t.toUpperCase()},StringPrototypeTrim(t){return t.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(t,e,r){return t.set(e,r)},Boolean,Uint8Array}});var Bu=g((Nr,qr)=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});var Cu=new WeakMap,bs=new WeakMap;function L(t){let e=Cu.get(t);return console.assert(e!=null,"'this' is expected an Event object, but got",t),e}function Au(t){if(t.passiveListener!=null){typeof console<"u"&&typeof console.error=="function"&&console.error("Unable to preventDefault inside passive event listener invocation.",t.passiveListener);return}t.event.cancelable&&(t.canceled=!0,typeof t.event.preventDefault=="function"&&t.event.preventDefault())}function Zt(t,e){Cu.set(this,{eventTarget:t,event:e,eventPhase:2,currentTarget:t,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:e.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let r=Object.keys(e);for(let i=0;i<r.length;++i){let n=r[i];n in this||Object.defineProperty(this,n,Ru(n))}}Zt.prototype={get type(){return L(this).event.type},get target(){return L(this).eventTarget},get currentTarget(){return L(this).currentTarget},composedPath(){let t=L(this).currentTarget;return t==null?[]:[t]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return L(this).eventPhase},stopPropagation(){let t=L(this);t.stopped=!0,typeof t.event.stopPropagation=="function"&&t.event.stopPropagation()},stopImmediatePropagation(){let t=L(this);t.stopped=!0,t.immediateStopped=!0,typeof t.event.stopImmediatePropagation=="function"&&t.event.stopImmediatePropagation()},get bubbles(){return!!L(this).event.bubbles},get cancelable(){return!!L(this).event.cancelable},preventDefault(){Au(L(this))},get defaultPrevented(){return L(this).canceled},get composed(){return!!L(this).event.composed},get timeStamp(){return L(this).timeStamp},get srcElement(){return L(this).eventTarget},get cancelBubble(){return L(this).stopped},set cancelBubble(t){if(!t)return;let e=L(this);e.stopped=!0,typeof e.event.cancelBubble=="boolean"&&(e.event.cancelBubble=!0)},get returnValue(){return!L(this).canceled},set returnValue(t){t||Au(L(this))},initEvent(){}};Object.defineProperty(Zt.prototype,"constructor",{value:Zt,configurable:!0,writable:!0});typeof window<"u"&&typeof window.Event<"u"&&(Object.setPrototypeOf(Zt.prototype,window.Event.prototype),bs.set(window.Event.prototype,Zt));function Ru(t){return{get(){return L(this).event[t]},set(e){L(this).event[t]=e},configurable:!0,enumerable:!0}}function U_(t){return{value(){let e=L(this).event;return e[t].apply(e,arguments)},configurable:!0,enumerable:!0}}function W_(t,e){let r=Object.keys(e);if(r.length===0)return t;function i(n,s){t.call(this,n,s)}i.prototype=Object.create(t.prototype,{constructor:{value:i,configurable:!0,writable:!0}});for(let n=0;n<r.length;++n){let s=r[n];if(!(s in t.prototype)){let a=typeof Object.getOwnPropertyDescriptor(e,s).value=="function";Object.defineProperty(i.prototype,s,a?U_(s):Ru(s))}}return i}function ku(t){if(t==null||t===Object.prototype)return Zt;let e=bs.get(t);return e==null&&(e=W_(ku(Object.getPrototypeOf(t)),t),bs.set(t,e)),e}function F_(t,e){let r=ku(Object.getPrototypeOf(e));return new r(t,e)}function $_(t){return L(t).immediateStopped}function V_(t,e){L(t).eventPhase=e}function H_(t,e){L(t).currentTarget=e}function xu(t,e){L(t).passiveListener=e}var Mu=new WeakMap,Iu=1,Ou=2,xi=3;function Ii(t){return t!==null&&typeof t=="object"}function Br(t){let e=Mu.get(t);if(e==null)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return e}function G_(t){return{get(){let r=Br(this).get(t);for(;r!=null;){if(r.listenerType===xi)return r.listener;r=r.next}return null},set(e){typeof e!="function"&&!Ii(e)&&(e=null);let r=Br(this),i=null,n=r.get(t);for(;n!=null;)n.listenerType===xi?i!==null?i.next=n.next:n.next!==null?r.set(t,n.next):r.delete(t):i=n,n=n.next;if(e!==null){let s={listener:e,listenerType:xi,passive:!1,once:!1,next:null};i===null?r.set(t,s):i.next=s}},configurable:!0,enumerable:!0}}function ys(t,e){Object.defineProperty(t,`on${e}`,G_(e))}function Pu(t){function e(){me.call(this)}e.prototype=Object.create(me.prototype,{constructor:{value:e,configurable:!0,writable:!0}});for(let r=0;r<t.length;++r)ys(e.prototype,t[r]);return e}function me(){if(this instanceof me){Mu.set(this,new Map);return}if(arguments.length===1&&Array.isArray(arguments[0]))return Pu(arguments[0]);if(arguments.length>0){let t=new Array(arguments.length);for(let e=0;e<arguments.length;++e)t[e]=arguments[e];return Pu(t)}throw new TypeError("Cannot call a class as a function")}me.prototype={addEventListener(t,e,r){if(e==null)return;if(typeof e!="function"&&!Ii(e))throw new TypeError("'listener' should be a function or an object.");let i=Br(this),n=Ii(r),o=(n?!!r.capture:!!r)?Iu:Ou,a={listener:e,listenerType:o,passive:n&&!!r.passive,once:n&&!!r.once,next:null},l=i.get(t);if(l===void 0){i.set(t,a);return}let u=null;for(;l!=null;){if(l.listener===e&&l.listenerType===o)return;u=l,l=l.next}u.next=a},removeEventListener(t,e,r){if(e==null)return;let i=Br(this),s=(Ii(r)?!!r.capture:!!r)?Iu:Ou,o=null,a=i.get(t);for(;a!=null;){if(a.listener===e&&a.listenerType===s){o!==null?o.next=a.next:a.next!==null?i.set(t,a.next):i.delete(t);return}o=a,a=a.next}},dispatchEvent(t){if(t==null||typeof t.type!="string")throw new TypeError('"event.type" should be a string.');let e=Br(this),r=t.type,i=e.get(r);if(i==null)return!0;let n=F_(this,t),s=null;for(;i!=null;){if(i.once?s!==null?s.next=i.next:i.next!==null?e.set(r,i.next):e.delete(r):s=i,xu(n,i.passive?i.listener:null),typeof i.listener=="function")try{i.listener.call(this,n)}catch(o){typeof console<"u"&&typeof console.error=="function"&&console.error(o)}else i.listenerType!==xi&&typeof i.listener.handleEvent=="function"&&i.listener.handleEvent(n);if($_(n))break;i=i.next}return xu(n,null),V_(n,0),H_(n,null),!n.defaultPrevented}};Object.defineProperty(me.prototype,"constructor",{value:me,configurable:!0,writable:!0});typeof window<"u"&&typeof window.EventTarget<"u"&&Object.setPrototypeOf(me.prototype,window.EventTarget.prototype);Nr.defineEventAttribute=ys;Nr.EventTarget=me;Nr.default=me;qr.exports=me;qr.exports.EventTarget=qr.exports.default=me;qr.exports.defineEventAttribute=ys});var er=g((jr,Lr)=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});var ms=Bu(),et=class extends ms.EventTarget{constructor(){throw super(),new TypeError("AbortSignal cannot be constructed directly")}get aborted(){let e=Oi.get(this);if(typeof e!="boolean")throw new TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return e}};ms.defineEventAttribute(et.prototype,"abort");function z_(){let t=Object.create(et.prototype);return ms.EventTarget.call(t),Oi.set(t,!1),t}function K_(t){Oi.get(t)===!1&&(Oi.set(t,!0),t.dispatchEvent({type:"abort"}))}var Oi=new WeakMap;Object.defineProperties(et.prototype,{aborted:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(et.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});var tt=class{constructor(){Nu.set(this,z_())}get signal(){return qu(this)}abort(){K_(qu(this))}},Nu=new WeakMap;function qu(t){let e=Nu.get(t);if(e==null)throw new TypeError(`Expected 'this' to be an 'AbortController' object, but got ${t===null?"null":typeof t}`);return e}Object.defineProperties(tt.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(tt.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});jr.AbortController=tt;jr.AbortSignal=et;jr.default=tt;Lr.exports=tt;Lr.exports.AbortController=Lr.exports.default=tt;Lr.exports.AbortSignal=et});var X=g((GA,Ss)=>{"use strict";var Y_=E("buffer"),{kResistStopPropagation:Q_,SymbolDispose:J_}=U(),X_=globalThis.AbortSignal||er().AbortSignal,Z_=globalThis.AbortController||er().AbortController,eb=Object.getPrototypeOf(async function(){}).constructor,Lu=globalThis.Blob||Y_.Blob,tb=typeof Lu<"u"?function(e){return e instanceof Lu}:function(e){return!1},ju=(t,e)=>{if(t!==void 0&&(t===null||typeof t!="object"||!("aborted"in t)))throw new ERR_INVALID_ARG_TYPE(e,"AbortSignal",t)},rb=(t,e)=>{if(typeof t!="function")throw new ERR_INVALID_ARG_TYPE(e,"Function",t)},ws=class extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError(`Expected input to be an Array, got ${typeof e}`);let r="";for(let i=0;i<e.length;i++)r+=`    ${e[i].stack}
`;super(r),this.name="AggregateError",this.errors=e}};Ss.exports={AggregateError:ws,kEmptyObject:Object.freeze({}),once(t){let e=!1;return function(...r){e||(e=!0,t.apply(this,r))}},createDeferredPromise:function(){let t,e;return{promise:new Promise((i,n)=>{t=i,e=n}),resolve:t,reject:e}},promisify(t){return new Promise((e,r)=>{t((i,...n)=>i?r(i):e(...n))})},debuglog(){return function(){}},format(t,...e){return t.replace(/%([sdifj])/g,function(...[r,i]){let n=e.shift();return i==="f"?n.toFixed(6):i==="j"?JSON.stringify(n):i==="s"&&typeof n=="object"?`${n.constructor!==Object?n.constructor.name:""} {}`.trim():n.toString()})},inspect(t){switch(typeof t){case"string":if(t.includes("'"))if(t.includes('"')){if(!t.includes("`")&&!t.includes("${"))return`\`${t}\``}else return`"${t}"`;return`'${t}'`;case"number":return isNaN(t)?"NaN":Object.is(t,-0)?String(t):t;case"bigint":return`${String(t)}n`;case"boolean":case"undefined":return String(t);case"object":return"{}"}},types:{isAsyncFunction(t){return t instanceof eb},isArrayBufferView(t){return ArrayBuffer.isView(t)}},isBlob:tb,deprecate(t,e){return t},addAbortListener:E("events").addAbortListener||function(e,r){if(e===void 0)throw new ERR_INVALID_ARG_TYPE("signal","AbortSignal",e);ju(e,"signal"),rb(r,"listener");let i;return e.aborted?queueMicrotask(()=>r()):(e.addEventListener("abort",r,{__proto__:null,once:!0,[Q_]:!0}),i=()=>{e.removeEventListener("abort",r)}),{__proto__:null,[J_](){var n;(n=i)===null||n===void 0||n()}}},AbortSignalAny:X_.any||function(e){if(e.length===1)return e[0];let r=new Z_,i=()=>r.abort();return e.forEach(n=>{ju(n,"signals"),n.addEventListener("abort",i,{once:!0})}),r.signal.addEventListener("abort",()=>{e.forEach(n=>n.removeEventListener("abort",i))},{once:!0}),r.signal}};Ss.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")});var te=g((zA,Wu)=>{"use strict";var{format:ib,inspect:Pi,AggregateError:nb}=X(),sb=globalThis.AggregateError||nb,ob=Symbol("kIsNodeError"),ab=["string","function","number","object","Function","Object","boolean","bigint","symbol"],lb=/^([A-Z][a-z0-9]*)+$/,ub="__node_internal_",Ci={};function mt(t,e){if(!t)throw new Ci.ERR_INTERNAL_ASSERTION(e)}function Du(t){let e="",r=t.length,i=t[0]==="-"?1:0;for(;r>=i+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function cb(t,e,r){if(typeof e=="function")return mt(e.length<=r.length,`Code: ${t}; The provided arguments length (${r.length}) does not match the required ones (${e.length}).`),e(...r);let i=(e.match(/%[dfijoOs]/g)||[]).length;return mt(i===r.length,`Code: ${t}; The provided arguments length (${r.length}) does not match the required ones (${i}).`),r.length===0?e:ib(e,...r)}function J(t,e,r){r||(r=Error);class i extends r{constructor(...s){super(cb(t,e,s))}toString(){return`${this.name} [${t}]: ${this.message}`}}Object.defineProperties(i.prototype,{name:{value:r.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${t}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),i.prototype.code=t,i.prototype[ob]=!0,Ci[t]=i}function Uu(t){let e=ub+t.name;return Object.defineProperty(t,"name",{value:e}),t}function fb(t,e){if(t&&e&&t!==e){if(Array.isArray(e.errors))return e.errors.push(t),e;let r=new sb([e,t],e.message);return r.code=e.code,r}return t||e}var Es=class extends Error{constructor(e="The operation was aborted",r=void 0){if(r!==void 0&&typeof r!="object")throw new Ci.ERR_INVALID_ARG_TYPE("options","Object",r);super(e,r),this.code="ABORT_ERR",this.name="AbortError"}};J("ERR_ASSERTION","%s",Error);J("ERR_INVALID_ARG_TYPE",(t,e,r)=>{mt(typeof t=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let i="The ";t.endsWith(" argument")?i+=`${t} `:i+=`"${t}" ${t.includes(".")?"property":"argument"} `,i+="must be ";let n=[],s=[],o=[];for(let l of e)mt(typeof l=="string","All expected entries have to be of type string"),ab.includes(l)?n.push(l.toLowerCase()):lb.test(l)?s.push(l):(mt(l!=="object",'The value "object" should be written as "Object"'),o.push(l));if(s.length>0){let l=n.indexOf("object");l!==-1&&(n.splice(n,l,1),s.push("Object"))}if(n.length>0){switch(n.length){case 1:i+=`of type ${n[0]}`;break;case 2:i+=`one of type ${n[0]} or ${n[1]}`;break;default:{let l=n.pop();i+=`one of type ${n.join(", ")}, or ${l}`}}(s.length>0||o.length>0)&&(i+=" or ")}if(s.length>0){switch(s.length){case 1:i+=`an instance of ${s[0]}`;break;case 2:i+=`an instance of ${s[0]} or ${s[1]}`;break;default:{let l=s.pop();i+=`an instance of ${s.join(", ")}, or ${l}`}}o.length>0&&(i+=" or ")}switch(o.length){case 0:break;case 1:o[0].toLowerCase()!==o[0]&&(i+="an "),i+=`${o[0]}`;break;case 2:i+=`one of ${o[0]} or ${o[1]}`;break;default:{let l=o.pop();i+=`one of ${o.join(", ")}, or ${l}`}}if(r==null)i+=`. Received ${r}`;else if(typeof r=="function"&&r.name)i+=`. Received function ${r.name}`;else if(typeof r=="object"){var a;if((a=r.constructor)!==null&&a!==void 0&&a.name)i+=`. Received an instance of ${r.constructor.name}`;else{let l=Pi(r,{depth:-1});i+=`. Received ${l}`}}else{let l=Pi(r,{colors:!1});l.length>25&&(l=`${l.slice(0,25)}...`),i+=`. Received type ${typeof r} (${l})`}return i},TypeError);J("ERR_INVALID_ARG_VALUE",(t,e,r="is invalid")=>{let i=Pi(e);return i.length>128&&(i=i.slice(0,128)+"..."),`The ${t.includes(".")?"property":"argument"} '${t}' ${r}. Received ${i}`},TypeError);J("ERR_INVALID_RETURN_VALUE",(t,e,r)=>{var i;let n=r!=null&&(i=r.constructor)!==null&&i!==void 0&&i.name?`instance of ${r.constructor.name}`:`type ${typeof r}`;return`Expected ${t} to be returned from the "${e}" function but got ${n}.`},TypeError);J("ERR_MISSING_ARGS",(...t)=>{mt(t.length>0,"At least one arg needs to be specified");let e,r=t.length;switch(t=(Array.isArray(t)?t:[t]).map(i=>`"${i}"`).join(" or "),r){case 1:e+=`The ${t[0]} argument`;break;case 2:e+=`The ${t[0]} and ${t[1]} arguments`;break;default:{let i=t.pop();e+=`The ${t.join(", ")}, and ${i} arguments`}break}return`${e} must be specified`},TypeError);J("ERR_OUT_OF_RANGE",(t,e,r)=>{mt(e,'Missing "range" argument');let i;return Number.isInteger(r)&&Math.abs(r)>2**32?i=Du(String(r)):typeof r=="bigint"?(i=String(r),(r>2n**32n||r<-(2n**32n))&&(i=Du(i)),i+="n"):i=Pi(r),`The value of "${t}" is out of range. It must be ${e}. Received ${i}`},RangeError);J("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);J("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);J("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);J("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);J("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);J("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);J("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);J("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);J("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);J("ERR_STREAM_WRITE_AFTER_END","write after end",Error);J("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);Wu.exports={AbortError:Es,aggregateTwoErrors:Uu(fb),hideStackFrames:Uu,codes:Ci}});var rr=g((KA,Ju)=>{"use strict";var{ArrayIsArray:Ts,ArrayPrototypeIncludes:Hu,ArrayPrototypeJoin:Gu,ArrayPrototypeMap:hb,NumberIsInteger:As,NumberIsNaN:db,NumberMAX_SAFE_INTEGER:pb,NumberMIN_SAFE_INTEGER:gb,NumberParseInt:_b,ObjectPrototypeHasOwnProperty:bb,RegExpPrototypeExec:zu,String:yb,StringPrototypeToUpperCase:mb,StringPrototypeTrim:wb}=U(),{hideStackFrames:ue,codes:{ERR_SOCKET_BAD_PORT:Sb,ERR_INVALID_ARG_TYPE:Z,ERR_INVALID_ARG_VALUE:tr,ERR_OUT_OF_RANGE:wt,ERR_UNKNOWN_SIGNAL:Fu}}=te(),{normalizeEncoding:Eb}=X(),{isAsyncFunction:vb,isArrayBufferView:Tb}=X().types,$u={};function Ab(t){return t===(t|0)}function xb(t){return t===t>>>0}var Ib=/^[0-7]+$/,Ob="must be a 32-bit unsigned integer or an octal string";function Pb(t,e,r){if(typeof t>"u"&&(t=r),typeof t=="string"){if(zu(Ib,t)===null)throw new tr(e,t,Ob);t=_b(t,8)}return Ku(t,e),t}var Cb=ue((t,e,r=gb,i=pb)=>{if(typeof t!="number")throw new Z(e,"number",t);if(!As(t))throw new wt(e,"an integer",t);if(t<r||t>i)throw new wt(e,`>= ${r} && <= ${i}`,t)}),Rb=ue((t,e,r=-2147483648,i=2147483647)=>{if(typeof t!="number")throw new Z(e,"number",t);if(!As(t))throw new wt(e,"an integer",t);if(t<r||t>i)throw new wt(e,`>= ${r} && <= ${i}`,t)}),Ku=ue((t,e,r=!1)=>{if(typeof t!="number")throw new Z(e,"number",t);if(!As(t))throw new wt(e,"an integer",t);let i=r?1:0,n=4294967295;if(t<i||t>n)throw new wt(e,`>= ${i} && <= ${n}`,t)});function xs(t,e){if(typeof t!="string")throw new Z(e,"string",t)}function kb(t,e,r=void 0,i){if(typeof t!="number")throw new Z(e,"number",t);if(r!=null&&t<r||i!=null&&t>i||(r!=null||i!=null)&&db(t))throw new wt(e,`${r!=null?`>= ${r}`:""}${r!=null&&i!=null?" && ":""}${i!=null?`<= ${i}`:""}`,t)}var Mb=ue((t,e,r)=>{if(!Hu(r,t)){let n="must be one of: "+Gu(hb(r,s=>typeof s=="string"?`'${s}'`:yb(s)),", ");throw new tr(e,t,n)}});function Yu(t,e){if(typeof t!="boolean")throw new Z(e,"boolean",t)}function vs(t,e,r){return t==null||!bb(t,e)?r:t[e]}var Bb=ue((t,e,r=null)=>{let i=vs(r,"allowArray",!1),n=vs(r,"allowFunction",!1);if(!vs(r,"nullable",!1)&&t===null||!i&&Ts(t)||typeof t!="object"&&(!n||typeof t!="function"))throw new Z(e,"Object",t)}),qb=ue((t,e)=>{if(t!=null&&typeof t!="object"&&typeof t!="function")throw new Z(e,"a dictionary",t)}),Ri=ue((t,e,r=0)=>{if(!Ts(t))throw new Z(e,"Array",t);if(t.length<r){let i=`must be longer than ${r}`;throw new tr(e,t,i)}});function Nb(t,e){Ri(t,e);for(let r=0;r<t.length;r++)xs(t[r],`${e}[${r}]`)}function Lb(t,e){Ri(t,e);for(let r=0;r<t.length;r++)Yu(t[r],`${e}[${r}]`)}function jb(t,e){Ri(t,e);for(let r=0;r<t.length;r++){let i=t[r],n=`${e}[${r}]`;if(i==null)throw new Z(n,"AbortSignal",i);Qu(i,n)}}function Db(t,e="signal"){if(xs(t,e),$u[t]===void 0)throw $u[mb(t)]!==void 0?new Fu(t+" (signals must use all capital letters)"):new Fu(t)}var Ub=ue((t,e="buffer")=>{if(!Tb(t))throw new Z(e,["Buffer","TypedArray","DataView"],t)});function Wb(t,e){let r=Eb(e),i=t.length;if(r==="hex"&&i%2!==0)throw new tr("encoding",e,`is invalid for data of length ${i}`)}function Fb(t,e="Port",r=!0){if(typeof t!="number"&&typeof t!="string"||typeof t=="string"&&wb(t).length===0||+t!==+t>>>0||t>65535||t===0&&!r)throw new Sb(e,t,r);return t|0}var Qu=ue((t,e)=>{if(t!==void 0&&(t===null||typeof t!="object"||!("aborted"in t)))throw new Z(e,"AbortSignal",t)}),$b=ue((t,e)=>{if(typeof t!="function")throw new Z(e,"Function",t)}),Vb=ue((t,e)=>{if(typeof t!="function"||vb(t))throw new Z(e,"Function",t)}),Hb=ue((t,e)=>{if(t!==void 0)throw new Z(e,"undefined",t)});function Gb(t,e,r){if(!Hu(r,t))throw new Z(e,`('${Gu(r,"|")}')`,t)}var zb=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function Vu(t,e){if(typeof t>"u"||!zu(zb,t))throw new tr(e,t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Kb(t){if(typeof t=="string")return Vu(t,"hints"),t;if(Ts(t)){let e=t.length,r="";if(e===0)return r;for(let i=0;i<e;i++){let n=t[i];Vu(n,"hints"),r+=n,i!==e-1&&(r+=", ")}return r}throw new tr("hints",t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}Ju.exports={isInt32:Ab,isUint32:xb,parseFileMode:Pb,validateArray:Ri,validateStringArray:Nb,validateBooleanArray:Lb,validateAbortSignalArray:jb,validateBoolean:Yu,validateBuffer:Ub,validateDictionary:qb,validateEncoding:Wb,validateFunction:$b,validateInt32:Rb,validateInteger:Cb,validateNumber:kb,validateObject:Bb,validateOneOf:Mb,validatePlainFunction:Vb,validatePort:Fb,validateSignalName:Db,validateString:xs,validateUint32:Ku,validateUndefined:Hb,validateUnion:Gb,validateAbortSignal:Qu,validateLinkHeaderValue:Kb}});var rt=g((YA,Xu)=>{"use strict";Xu.exports=global.process});var Oe=g((QA,dc)=>{"use strict";var{SymbolAsyncIterator:Zu,SymbolIterator:ec,SymbolFor:St}=U(),tc=St("nodejs.stream.destroyed"),rc=St("nodejs.stream.errored"),Is=St("nodejs.stream.readable"),Os=St("nodejs.stream.writable"),ic=St("nodejs.stream.disturbed"),Yb=St("nodejs.webstream.isClosedPromise"),Qb=St("nodejs.webstream.controllerErrorFunction");function ki(t,e=!1){var r;return!!(t&&typeof t.pipe=="function"&&typeof t.on=="function"&&(!e||typeof t.pause=="function"&&typeof t.resume=="function")&&(!t._writableState||((r=t._readableState)===null||r===void 0?void 0:r.readable)!==!1)&&(!t._writableState||t._readableState))}function Mi(t){var e;return!!(t&&typeof t.write=="function"&&typeof t.on=="function"&&(!t._readableState||((e=t._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function Jb(t){return!!(t&&typeof t.pipe=="function"&&t._readableState&&typeof t.on=="function"&&typeof t.write=="function")}function Ie(t){return t&&(t._readableState||t._writableState||typeof t.write=="function"&&typeof t.on=="function"||typeof t.pipe=="function"&&typeof t.on=="function")}function nc(t){return!!(t&&!Ie(t)&&typeof t.pipeThrough=="function"&&typeof t.getReader=="function"&&typeof t.cancel=="function")}function sc(t){return!!(t&&!Ie(t)&&typeof t.getWriter=="function"&&typeof t.abort=="function")}function oc(t){return!!(t&&!Ie(t)&&typeof t.readable=="object"&&typeof t.writable=="object")}function Xb(t){return nc(t)||sc(t)||oc(t)}function Zb(t,e){return t==null?!1:e===!0?typeof t[Zu]=="function":e===!1?typeof t[ec]=="function":typeof t[Zu]=="function"||typeof t[ec]=="function"}function Bi(t){if(!Ie(t))return null;let e=t._writableState,r=t._readableState,i=e||r;return!!(t.destroyed||t[tc]||i!=null&&i.destroyed)}function ac(t){if(!Mi(t))return null;if(t.writableEnded===!0)return!0;let e=t._writableState;return e!=null&&e.errored?!1:typeof e?.ended!="boolean"?null:e.ended}function ey(t,e){if(!Mi(t))return null;if(t.writableFinished===!0)return!0;let r=t._writableState;return r!=null&&r.errored?!1:typeof r?.finished!="boolean"?null:!!(r.finished||e===!1&&r.ended===!0&&r.length===0)}function ty(t){if(!ki(t))return null;if(t.readableEnded===!0)return!0;let e=t._readableState;return!e||e.errored?!1:typeof e?.ended!="boolean"?null:e.ended}function lc(t,e){if(!ki(t))return null;let r=t._readableState;return r!=null&&r.errored?!1:typeof r?.endEmitted!="boolean"?null:!!(r.endEmitted||e===!1&&r.ended===!0&&r.length===0)}function uc(t){return t&&t[Is]!=null?t[Is]:typeof t?.readable!="boolean"?null:Bi(t)?!1:ki(t)&&t.readable&&!lc(t)}function cc(t){return t&&t[Os]!=null?t[Os]:typeof t?.writable!="boolean"?null:Bi(t)?!1:Mi(t)&&t.writable&&!ac(t)}function ry(t,e){return Ie(t)?Bi(t)?!0:!(e?.readable!==!1&&uc(t)||e?.writable!==!1&&cc(t)):null}function iy(t){var e,r;return Ie(t)?t.writableErrored?t.writableErrored:(e=(r=t._writableState)===null||r===void 0?void 0:r.errored)!==null&&e!==void 0?e:null:null}function ny(t){var e,r;return Ie(t)?t.readableErrored?t.readableErrored:(e=(r=t._readableState)===null||r===void 0?void 0:r.errored)!==null&&e!==void 0?e:null:null}function sy(t){if(!Ie(t))return null;if(typeof t.closed=="boolean")return t.closed;let e=t._writableState,r=t._readableState;return typeof e?.closed=="boolean"||typeof r?.closed=="boolean"?e?.closed||r?.closed:typeof t._closed=="boolean"&&fc(t)?t._closed:null}function fc(t){return typeof t._closed=="boolean"&&typeof t._defaultKeepAlive=="boolean"&&typeof t._removedConnection=="boolean"&&typeof t._removedContLen=="boolean"}function hc(t){return typeof t._sent100=="boolean"&&fc(t)}function oy(t){var e;return typeof t._consuming=="boolean"&&typeof t._dumped=="boolean"&&((e=t.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function ay(t){if(!Ie(t))return null;let e=t._writableState,r=t._readableState,i=e||r;return!i&&hc(t)||!!(i&&i.autoDestroy&&i.emitClose&&i.closed===!1)}function ly(t){var e;return!!(t&&((e=t[ic])!==null&&e!==void 0?e:t.readableDidRead||t.readableAborted))}function uy(t){var e,r,i,n,s,o,a,l,u,f;return!!(t&&((e=(r=(i=(n=(s=(o=t[rc])!==null&&o!==void 0?o:t.readableErrored)!==null&&s!==void 0?s:t.writableErrored)!==null&&n!==void 0?n:(a=t._readableState)===null||a===void 0?void 0:a.errorEmitted)!==null&&i!==void 0?i:(l=t._writableState)===null||l===void 0?void 0:l.errorEmitted)!==null&&r!==void 0?r:(u=t._readableState)===null||u===void 0?void 0:u.errored)!==null&&e!==void 0?e:!((f=t._writableState)===null||f===void 0)&&f.errored))}dc.exports={isDestroyed:Bi,kIsDestroyed:tc,isDisturbed:ly,kIsDisturbed:ic,isErrored:uy,kIsErrored:rc,isReadable:uc,kIsReadable:Is,kIsClosedPromise:Yb,kControllerErrorFunction:Qb,kIsWritable:Os,isClosed:sy,isDuplexNodeStream:Jb,isFinished:ry,isIterable:Zb,isReadableNodeStream:ki,isReadableStream:nc,isReadableEnded:ty,isReadableFinished:lc,isReadableErrored:ny,isNodeStream:Ie,isWebStream:Xb,isWritable:cc,isWritableNodeStream:Mi,isWritableStream:sc,isWritableEnded:ac,isWritableFinished:ey,isWritableErrored:iy,isServerRequest:oy,isServerResponse:hc,willEmitClose:ay,isTransformStream:oc}});var We=g((JA,Ms)=>{"use strict";var it=rt(),{AbortError:Ec,codes:cy}=te(),{ERR_INVALID_ARG_TYPE:fy,ERR_STREAM_PREMATURE_CLOSE:pc}=cy,{kEmptyObject:Cs,once:Rs}=X(),{validateAbortSignal:hy,validateFunction:dy,validateObject:py,validateBoolean:gy}=rr(),{Promise:_y,PromisePrototypeThen:by,SymbolDispose:vc}=U(),{isClosed:yy,isReadable:gc,isReadableNodeStream:Ps,isReadableStream:my,isReadableFinished:_c,isReadableErrored:bc,isWritable:yc,isWritableNodeStream:mc,isWritableStream:wy,isWritableFinished:wc,isWritableErrored:Sc,isNodeStream:Sy,willEmitClose:Ey,kIsClosedPromise:vy}=Oe(),ir;function Ty(t){return t.setHeader&&typeof t.abort=="function"}var ks=()=>{};function Tc(t,e,r){var i,n;if(arguments.length===2?(r=e,e=Cs):e==null?e=Cs:py(e,"options"),dy(r,"callback"),hy(e.signal,"options.signal"),r=Rs(r),my(t)||wy(t))return Ay(t,e,r);if(!Sy(t))throw new fy("stream",["ReadableStream","WritableStream","Stream"],t);let s=(i=e.readable)!==null&&i!==void 0?i:Ps(t),o=(n=e.writable)!==null&&n!==void 0?n:mc(t),a=t._writableState,l=t._readableState,u=()=>{t.writable||h()},f=Ey(t)&&Ps(t)===s&&mc(t)===o,c=wc(t,!1),h=()=>{c=!0,t.destroyed&&(f=!1),!(f&&(!t.readable||s))&&(!s||d)&&r.call(t)},d=_c(t,!1),_=()=>{d=!0,t.destroyed&&(f=!1),!(f&&(!t.writable||o))&&(!o||c)&&r.call(t)},p=I=>{r.call(t,I)},y=yy(t),b=()=>{y=!0;let I=Sc(t)||bc(t);if(I&&typeof I!="boolean")return r.call(t,I);if(s&&!d&&Ps(t,!0)&&!_c(t,!1))return r.call(t,new pc);if(o&&!c&&!wc(t,!1))return r.call(t,new pc);r.call(t)},m=()=>{y=!0;let I=Sc(t)||bc(t);if(I&&typeof I!="boolean")return r.call(t,I);r.call(t)},A=()=>{t.req.on("finish",h)};Ty(t)?(t.on("complete",h),f||t.on("abort",b),t.req?A():t.on("request",A)):o&&!a&&(t.on("end",u),t.on("close",u)),!f&&typeof t.aborted=="boolean"&&t.on("aborted",b),t.on("end",_),t.on("finish",h),e.error!==!1&&t.on("error",p),t.on("close",b),y?it.nextTick(b):a!=null&&a.errorEmitted||l!=null&&l.errorEmitted?f||it.nextTick(m):(!s&&(!f||gc(t))&&(c||yc(t)===!1)||!o&&(!f||yc(t))&&(d||gc(t)===!1)||l&&t.req&&t.aborted)&&it.nextTick(m);let S=()=>{r=ks,t.removeListener("aborted",b),t.removeListener("complete",h),t.removeListener("abort",b),t.removeListener("request",A),t.req&&t.req.removeListener("finish",h),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",h),t.removeListener("end",_),t.removeListener("error",p),t.removeListener("close",b)};if(e.signal&&!y){let I=()=>{let N=r;S(),N.call(t,new Ec(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)it.nextTick(I);else{ir=ir||X().addAbortListener;let N=ir(e.signal,I),M=r;r=Rs((...F)=>{N[vc](),M.apply(t,F)})}}return S}function Ay(t,e,r){let i=!1,n=ks;if(e.signal)if(n=()=>{i=!0,r.call(t,new Ec(void 0,{cause:e.signal.reason}))},e.signal.aborted)it.nextTick(n);else{ir=ir||X().addAbortListener;let o=ir(e.signal,n),a=r;r=Rs((...l)=>{o[vc](),a.apply(t,l)})}let s=(...o)=>{i||it.nextTick(()=>r.apply(t,o))};return by(t[vy].promise,s,s),ks}function xy(t,e){var r;let i=!1;return e===null&&(e=Cs),(r=e)!==null&&r!==void 0&&r.cleanup&&(gy(e.cleanup,"cleanup"),i=e.cleanup),new _y((n,s)=>{let o=Tc(t,e,a=>{i&&o(),a?s(a):n()})})}Ms.exports=Tc;Ms.exports.finished=xy});var Et=g((XA,kc)=>{"use strict";var Pe=rt(),{aggregateTwoErrors:Iy,codes:{ERR_MULTIPLE_CALLBACK:Oy},AbortError:Py}=te(),{Symbol:Ic}=U(),{kIsDestroyed:Cy,isDestroyed:Ry,isFinished:ky,isServerRequest:My}=Oe(),Oc=Ic("kDestroy"),Bs=Ic("kConstruct");function Pc(t,e,r){t&&(t.stack,e&&!e.errored&&(e.errored=t),r&&!r.errored&&(r.errored=t))}function By(t,e){let r=this._readableState,i=this._writableState,n=i||r;return i!=null&&i.destroyed||r!=null&&r.destroyed?(typeof e=="function"&&e(),this):(Pc(t,i,r),i&&(i.destroyed=!0),r&&(r.destroyed=!0),n.constructed?Ac(this,t,e):this.once(Oc,function(s){Ac(this,Iy(s,t),e)}),this)}function Ac(t,e,r){let i=!1;function n(s){if(i)return;i=!0;let o=t._readableState,a=t._writableState;Pc(s,a,o),a&&(a.closed=!0),o&&(o.closed=!0),typeof r=="function"&&r(s),s?Pe.nextTick(qy,t,s):Pe.nextTick(Cc,t)}try{t._destroy(e||null,n)}catch(s){n(s)}}function qy(t,e){qs(t,e),Cc(t)}function Cc(t){let e=t._readableState,r=t._writableState;r&&(r.closeEmitted=!0),e&&(e.closeEmitted=!0),(r!=null&&r.emitClose||e!=null&&e.emitClose)&&t.emit("close")}function qs(t,e){let r=t._readableState,i=t._writableState;i!=null&&i.errorEmitted||r!=null&&r.errorEmitted||(i&&(i.errorEmitted=!0),r&&(r.errorEmitted=!0),t.emit("error",e))}function Ny(){let t=this._readableState,e=this._writableState;t&&(t.constructed=!0,t.closed=!1,t.closeEmitted=!1,t.destroyed=!1,t.errored=null,t.errorEmitted=!1,t.reading=!1,t.ended=t.readable===!1,t.endEmitted=t.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function Ns(t,e,r){let i=t._readableState,n=t._writableState;if(n!=null&&n.destroyed||i!=null&&i.destroyed)return this;i!=null&&i.autoDestroy||n!=null&&n.autoDestroy?t.destroy(e):e&&(e.stack,n&&!n.errored&&(n.errored=e),i&&!i.errored&&(i.errored=e),r?Pe.nextTick(qs,t,e):qs(t,e))}function Ly(t,e){if(typeof t._construct!="function")return;let r=t._readableState,i=t._writableState;r&&(r.constructed=!1),i&&(i.constructed=!1),t.once(Bs,e),!(t.listenerCount(Bs)>1)&&Pe.nextTick(jy,t)}function jy(t){let e=!1;function r(i){if(e){Ns(t,i??new Oy);return}e=!0;let n=t._readableState,s=t._writableState,o=s||n;n&&(n.constructed=!0),s&&(s.constructed=!0),o.destroyed?t.emit(Oc,i):i?Ns(t,i,!0):Pe.nextTick(Dy,t)}try{t._construct(i=>{Pe.nextTick(r,i)})}catch(i){Pe.nextTick(r,i)}}function Dy(t){t.emit(Bs)}function xc(t){return t?.setHeader&&typeof t.abort=="function"}function Rc(t){t.emit("close")}function Uy(t,e){t.emit("error",e),Pe.nextTick(Rc,t)}function Wy(t,e){!t||Ry(t)||(!e&&!ky(t)&&(e=new Py),My(t)?(t.socket=null,t.destroy(e)):xc(t)?t.abort():xc(t.req)?t.req.abort():typeof t.destroy=="function"?t.destroy(e):typeof t.close=="function"?t.close():e?Pe.nextTick(Uy,t,e):Pe.nextTick(Rc,t),t.destroyed||(t[Cy]=!0))}kc.exports={construct:Ly,destroyer:Wy,destroy:By,undestroy:Ny,errorOrDestroy:Ns}});var Li=g((ZA,Bc)=>{"use strict";var{ArrayIsArray:Fy,ObjectSetPrototypeOf:Mc}=U(),{EventEmitter:qi}=E("events");function Ni(t){qi.call(this,t)}Mc(Ni.prototype,qi.prototype);Mc(Ni,qi);Ni.prototype.pipe=function(t,e){let r=this;function i(f){t.writable&&t.write(f)===!1&&r.pause&&r.pause()}r.on("data",i);function n(){r.readable&&r.resume&&r.resume()}t.on("drain",n),!t._isStdio&&(!e||e.end!==!1)&&(r.on("end",o),r.on("close",a));let s=!1;function o(){s||(s=!0,t.end())}function a(){s||(s=!0,typeof t.destroy=="function"&&t.destroy())}function l(f){u(),qi.listenerCount(this,"error")===0&&this.emit("error",f)}Ls(r,"error",l),Ls(t,"error",l);function u(){r.removeListener("data",i),t.removeListener("drain",n),r.removeListener("end",o),r.removeListener("close",a),r.removeListener("error",l),t.removeListener("error",l),r.removeListener("end",u),r.removeListener("close",u),t.removeListener("close",u)}return r.on("end",u),r.on("close",u),t.on("close",u),t.emit("pipe",r),t};function Ls(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Fy(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}Bc.exports={Stream:Ni,prependListener:Ls}});var Dr=g((ex,ji)=>{"use strict";var{SymbolDispose:$y}=U(),{AbortError:qc,codes:Vy}=te(),{isNodeStream:Nc,isWebStream:Hy,kControllerErrorFunction:Gy}=Oe(),zy=We(),{ERR_INVALID_ARG_TYPE:Lc}=Vy,js,Ky=(t,e)=>{if(typeof t!="object"||!("aborted"in t))throw new Lc(e,"AbortSignal",t)};ji.exports.addAbortSignal=function(e,r){if(Ky(e,"signal"),!Nc(r)&&!Hy(r))throw new Lc("stream",["ReadableStream","WritableStream","Stream"],r);return ji.exports.addAbortSignalNoValidate(e,r)};ji.exports.addAbortSignalNoValidate=function(t,e){if(typeof t!="object"||!("aborted"in t))return e;let r=Nc(e)?()=>{e.destroy(new qc(void 0,{cause:t.reason}))}:()=>{e[Gy](new qc(void 0,{cause:t.reason}))};if(t.aborted)r();else{js=js||X().addAbortListener;let i=js(t,r);zy(e,i[$y])}return e}});var Uc=g((rx,Dc)=>{"use strict";var{StringPrototypeSlice:jc,SymbolIterator:Yy,TypedArrayPrototypeSet:Di,Uint8Array:Qy}=U(),{Buffer:Ds}=E("buffer"),{inspect:Jy}=X();Dc.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){let r={data:e,next:null};this.length>0?this.tail.next=r:this.head=r,this.tail=r,++this.length}unshift(e){let r={data:e,next:this.head};this.length===0&&(this.tail=r),this.head=r,++this.length}shift(){if(this.length===0)return;let e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let r=this.head,i=""+r.data;for(;(r=r.next)!==null;)i+=e+r.data;return i}concat(e){if(this.length===0)return Ds.alloc(0);let r=Ds.allocUnsafe(e>>>0),i=this.head,n=0;for(;i;)Di(r,i.data,n),n+=i.data.length,i=i.next;return r}consume(e,r){let i=this.head.data;if(e<i.length){let n=i.slice(0,e);return this.head.data=i.slice(e),n}return e===i.length?this.shift():r?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[Yy](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let r="",i=this.head,n=0;do{let s=i.data;if(e>s.length)r+=s,e-=s.length;else{e===s.length?(r+=s,++n,i.next?this.head=i.next:this.head=this.tail=null):(r+=jc(s,0,e),this.head=i,i.data=jc(s,e));break}++n}while((i=i.next)!==null);return this.length-=n,r}_getBuffer(e){let r=Ds.allocUnsafe(e),i=e,n=this.head,s=0;do{let o=n.data;if(e>o.length)Di(r,o,i-e),e-=o.length;else{e===o.length?(Di(r,o,i-e),++s,n.next?this.head=n.next:this.head=this.tail=null):(Di(r,new Qy(o.buffer,o.byteOffset,e),i-e),this.head=n,n.data=o.slice(e));break}++s}while((n=n.next)!==null);return this.length-=s,r}[Symbol.for("nodejs.util.inspect.custom")](e,r){return Jy(this,{...r,depth:0,customInspect:!1})}}});var Ur=g((ix,Vc)=>{"use strict";var{MathFloor:Xy,NumberIsInteger:Zy}=U(),{validateInteger:em}=rr(),{ERR_INVALID_ARG_VALUE:tm}=te().codes,Wc=16*1024,Fc=16;function rm(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function $c(t){return t?Fc:Wc}function im(t,e){em(e,"value",0),t?Fc=e:Wc=e}function nm(t,e,r,i){let n=rm(e,i,r);if(n!=null){if(!Zy(n)||n<0){let s=i?`options.${r}`:"options.highWaterMark";throw new tm(s,n)}return Xy(n)}return $c(t.objectMode)}Vc.exports={getHighWaterMark:nm,getDefaultHighWaterMark:$c,setDefaultHighWaterMark:im}});var Us=g((nx,Kc)=>{"use strict";var Hc=rt(),{PromisePrototypeThen:sm,SymbolAsyncIterator:Gc,SymbolIterator:zc}=U(),{Buffer:om}=E("buffer"),{ERR_INVALID_ARG_TYPE:am,ERR_STREAM_NULL_VALUES:lm}=te().codes;function um(t,e,r){let i;if(typeof e=="string"||e instanceof om)return new t({objectMode:!0,...r,read(){this.push(e),this.push(null)}});let n;if(e&&e[Gc])n=!0,i=e[Gc]();else if(e&&e[zc])n=!1,i=e[zc]();else throw new am("iterable",["Iterable"],e);let s=new t({objectMode:!0,highWaterMark:1,...r}),o=!1;s._read=function(){o||(o=!0,l())},s._destroy=function(u,f){sm(a(u),()=>Hc.nextTick(f,u),c=>Hc.nextTick(f,c||u))};async function a(u){let f=u!=null,c=typeof i.throw=="function";if(f&&c){let{value:h,done:d}=await i.throw(u);if(await h,d)return}if(typeof i.return=="function"){let{value:h}=await i.return();await h}}async function l(){for(;;){try{let{value:u,done:f}=n?await i.next():i.next();if(f)s.push(null);else{let c=u&&typeof u.then=="function"?await u:u;if(c===null)throw o=!1,new lm;if(s.push(c))continue;o=!1}}catch(u){s.destroy(u)}break}}return s}Kc.exports=um});var Fr=g((sx,df)=>{"use strict";var we=rt(),{ArrayPrototypeIndexOf:cm,NumberIsInteger:fm,NumberIsNaN:hm,NumberParseInt:dm,ObjectDefineProperties:Ks,ObjectKeys:pm,ObjectSetPrototypeOf:Jc,Promise:Xc,SafeSet:gm,SymbolAsyncDispose:_m,SymbolAsyncIterator:bm,Symbol:ym}=U();df.exports=O;O.ReadableState=$i;var{EventEmitter:mm}=E("events"),{Stream:nt,prependListener:wm}=Li(),{Buffer:Ws}=E("buffer"),{addAbortSignal:Sm}=Dr(),Zc=We(),C=X().debuglog("stream",t=>{C=t}),Em=Uc(),or=Et(),{getHighWaterMark:vm,getDefaultHighWaterMark:Tm}=Ur(),{aggregateTwoErrors:Yc,codes:{ERR_INVALID_ARG_TYPE:Am,ERR_METHOD_NOT_IMPLEMENTED:xm,ERR_OUT_OF_RANGE:Im,ERR_STREAM_PUSH_AFTER_EOF:Om,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:Pm},AbortError:Cm}=te(),{validateObject:Rm}=rr(),vt=ym("kPaused"),{StringDecoder:ef}=E("string_decoder"),km=Us();Jc(O.prototype,nt.prototype);Jc(O,nt);var Fs=()=>{},{errorOrDestroy:nr}=or,sr=1,Mm=2,tf=4,Wr=8,rf=16,Ui=32,Wi=64,nf=128,Bm=256,qm=512,Nm=1024,Gs=2048,zs=4096,Lm=8192,jm=16384,Dm=32768,sf=65536,Um=1<<17,Wm=1<<18;function V(t){return{enumerable:!1,get(){return(this.state&t)!==0},set(e){e?this.state|=t:this.state&=~t}}}Ks($i.prototype,{objectMode:V(sr),ended:V(Mm),endEmitted:V(tf),reading:V(Wr),constructed:V(rf),sync:V(Ui),needReadable:V(Wi),emittedReadable:V(nf),readableListening:V(Bm),resumeScheduled:V(qm),errorEmitted:V(Nm),emitClose:V(Gs),autoDestroy:V(zs),destroyed:V(Lm),closed:V(jm),closeEmitted:V(Dm),multiAwaitDrain:V(sf),readingMore:V(Um),dataEmitted:V(Wm)});function $i(t,e,r){typeof r!="boolean"&&(r=e instanceof Ce()),this.state=Gs|zs|rf|Ui,t&&t.objectMode&&(this.state|=sr),r&&t&&t.readableObjectMode&&(this.state|=sr),this.highWaterMark=t?vm(this,t,"readableHighWaterMark",r):Tm(!1),this.buffer=new Em,this.length=0,this.pipes=[],this.flowing=null,this[vt]=null,t&&t.emitClose===!1&&(this.state&=~Gs),t&&t.autoDestroy===!1&&(this.state&=~zs),this.errored=null,this.defaultEncoding=t&&t.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,t&&t.encoding&&(this.decoder=new ef(t.encoding),this.encoding=t.encoding)}function O(t){if(!(this instanceof O))return new O(t);let e=this instanceof Ce();this._readableState=new $i(t,this,e),t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.construct=="function"&&(this._construct=t.construct),t.signal&&!e&&Sm(t.signal,this)),nt.call(this,t),or.construct(this,()=>{this._readableState.needReadable&&Fi(this,this._readableState)})}O.prototype.destroy=or.destroy;O.prototype._undestroy=or.undestroy;O.prototype._destroy=function(t,e){e(t)};O.prototype[mm.captureRejectionSymbol]=function(t){this.destroy(t)};O.prototype[_m]=function(){let t;return this.destroyed||(t=this.readableEnded?null:new Cm,this.destroy(t)),new Xc((e,r)=>Zc(this,i=>i&&i!==t?r(i):e(null)))};O.prototype.push=function(t,e){return of(this,t,e,!1)};O.prototype.unshift=function(t,e){return of(this,t,e,!0)};function of(t,e,r,i){C("readableAddChunk",e);let n=t._readableState,s;if(n.state&sr||(typeof e=="string"?(r=r||n.defaultEncoding,n.encoding!==r&&(i&&n.encoding?e=Ws.from(e,r).toString(n.encoding):(e=Ws.from(e,r),r=""))):e instanceof Ws?r="":nt._isUint8Array(e)?(e=nt._uint8ArrayToBuffer(e),r=""):e!=null&&(s=new Am("chunk",["string","Buffer","Uint8Array"],e))),s)nr(t,s);else if(e===null)n.state&=~Wr,Vm(t,n);else if(n.state&sr||e&&e.length>0)if(i)if(n.state&tf)nr(t,new Pm);else{if(n.destroyed||n.errored)return!1;$s(t,n,e,!0)}else if(n.ended)nr(t,new Om);else{if(n.destroyed||n.errored)return!1;n.state&=~Wr,n.decoder&&!r?(e=n.decoder.write(e),n.objectMode||e.length!==0?$s(t,n,e,!1):Fi(t,n)):$s(t,n,e,!1)}else i||(n.state&=~Wr,Fi(t,n));return!n.ended&&(n.length<n.highWaterMark||n.length===0)}function $s(t,e,r,i){e.flowing&&e.length===0&&!e.sync&&t.listenerCount("data")>0?(e.state&sf?e.awaitDrainWriters.clear():e.awaitDrainWriters=null,e.dataEmitted=!0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,i?e.buffer.unshift(r):e.buffer.push(r),e.state&Wi&&Vi(t)),Fi(t,e)}O.prototype.isPaused=function(){let t=this._readableState;return t[vt]===!0||t.flowing===!1};O.prototype.setEncoding=function(t){let e=new ef(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;let r=this._readableState.buffer,i="";for(let n of r)i+=e.write(n);return r.clear(),i!==""&&r.push(i),this._readableState.length=i.length,this};var Fm=1073741824;function $m(t){if(t>Fm)throw new Im("size","<= 1GiB",t);return t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++,t}function Qc(t,e){return t<=0||e.length===0&&e.ended?0:e.state&sr?1:hm(t)?e.flowing&&e.length?e.buffer.first().length:e.length:t<=e.length?t:e.ended?e.length:0}O.prototype.read=function(t){C("read",t),t===void 0?t=NaN:fm(t)||(t=dm(t,10));let e=this._readableState,r=t;if(t>e.highWaterMark&&(e.highWaterMark=$m(t)),t!==0&&(e.state&=~nf),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return C("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?Vs(this):Vi(this),null;if(t=Qc(t,e),t===0&&e.ended)return e.length===0&&Vs(this),null;let i=(e.state&Wi)!==0;if(C("need readable",i),(e.length===0||e.length-t<e.highWaterMark)&&(i=!0,C("length less than watermark",i)),e.ended||e.reading||e.destroyed||e.errored||!e.constructed)i=!1,C("reading, ended or constructing",i);else if(i){C("do read"),e.state|=Wr|Ui,e.length===0&&(e.state|=Wi);try{this._read(e.highWaterMark)}catch(s){nr(this,s)}e.state&=~Ui,e.reading||(t=Qc(r,e))}let n;return t>0?n=ff(t,e):n=null,n===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.multiAwaitDrain?e.awaitDrainWriters.clear():e.awaitDrainWriters=null),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&Vs(this)),n!==null&&!e.errorEmitted&&!e.closeEmitted&&(e.dataEmitted=!0,this.emit("data",n)),n};function Vm(t,e){if(C("onEofChunk"),!e.ended){if(e.decoder){let r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?Vi(t):(e.needReadable=!1,e.emittedReadable=!0,af(t))}}function Vi(t){let e=t._readableState;C("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(C("emitReadable",e.flowing),e.emittedReadable=!0,we.nextTick(af,t))}function af(t){let e=t._readableState;C("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&!e.errored&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,uf(t)}function Fi(t,e){!e.readingMore&&e.constructed&&(e.readingMore=!0,we.nextTick(Hm,t,e))}function Hm(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){let r=e.length;if(C("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}O.prototype._read=function(t){throw new xm("_read()")};O.prototype.pipe=function(t,e){let r=this,i=this._readableState;i.pipes.length===1&&(i.multiAwaitDrain||(i.multiAwaitDrain=!0,i.awaitDrainWriters=new gm(i.awaitDrainWriters?[i.awaitDrainWriters]:[]))),i.pipes.push(t),C("pipe count=%d opts=%j",i.pipes.length,e);let s=(!e||e.end!==!1)&&t!==we.stdout&&t!==we.stderr?a:y;i.endEmitted?we.nextTick(s):r.once("end",s),t.on("unpipe",o);function o(b,m){C("onunpipe"),b===r&&m&&m.hasUnpiped===!1&&(m.hasUnpiped=!0,f())}function a(){C("onend"),t.end()}let l,u=!1;function f(){C("cleanup"),t.removeListener("close",_),t.removeListener("finish",p),l&&t.removeListener("drain",l),t.removeListener("error",d),t.removeListener("unpipe",o),r.removeListener("end",a),r.removeListener("end",y),r.removeListener("data",h),u=!0,l&&i.awaitDrainWriters&&(!t._writableState||t._writableState.needDrain)&&l()}function c(){u||(i.pipes.length===1&&i.pipes[0]===t?(C("false write response, pause",0),i.awaitDrainWriters=t,i.multiAwaitDrain=!1):i.pipes.length>1&&i.pipes.includes(t)&&(C("false write response, pause",i.awaitDrainWriters.size),i.awaitDrainWriters.add(t)),r.pause()),l||(l=Gm(r,t),t.on("drain",l))}r.on("data",h);function h(b){C("ondata");let m=t.write(b);C("dest.write",m),m===!1&&c()}function d(b){if(C("onerror",b),y(),t.removeListener("error",d),t.listenerCount("error")===0){let m=t._writableState||t._readableState;m&&!m.errorEmitted?nr(t,b):t.emit("error",b)}}wm(t,"error",d);function _(){t.removeListener("finish",p),y()}t.once("close",_);function p(){C("onfinish"),t.removeListener("close",_),y()}t.once("finish",p);function y(){C("unpipe"),r.unpipe(t)}return t.emit("pipe",r),t.writableNeedDrain===!0?c():i.flowing||(C("pipe resume"),r.resume()),t};function Gm(t,e){return function(){let i=t._readableState;i.awaitDrainWriters===e?(C("pipeOnDrain",1),i.awaitDrainWriters=null):i.multiAwaitDrain&&(C("pipeOnDrain",i.awaitDrainWriters.size),i.awaitDrainWriters.delete(e)),(!i.awaitDrainWriters||i.awaitDrainWriters.size===0)&&t.listenerCount("data")&&t.resume()}}O.prototype.unpipe=function(t){let e=this._readableState,r={hasUnpiped:!1};if(e.pipes.length===0)return this;if(!t){let n=e.pipes;e.pipes=[],this.pause();for(let s=0;s<n.length;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}let i=cm(e.pipes,t);return i===-1?this:(e.pipes.splice(i,1),e.pipes.length===0&&this.pause(),t.emit("unpipe",this,r),this)};O.prototype.on=function(t,e){let r=nt.prototype.on.call(this,t,e),i=this._readableState;return t==="data"?(i.readableListening=this.listenerCount("readable")>0,i.flowing!==!1&&this.resume()):t==="readable"&&!i.endEmitted&&!i.readableListening&&(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,C("on readable",i.length,i.reading),i.length?Vi(this):i.reading||we.nextTick(zm,this)),r};O.prototype.addListener=O.prototype.on;O.prototype.removeListener=function(t,e){let r=nt.prototype.removeListener.call(this,t,e);return t==="readable"&&we.nextTick(lf,this),r};O.prototype.off=O.prototype.removeListener;O.prototype.removeAllListeners=function(t){let e=nt.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&we.nextTick(lf,this),e};function lf(t){let e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&e[vt]===!1?e.flowing=!0:t.listenerCount("data")>0?t.resume():e.readableListening||(e.flowing=null)}function zm(t){C("readable nexttick read 0"),t.read(0)}O.prototype.resume=function(){let t=this._readableState;return t.flowing||(C("resume"),t.flowing=!t.readableListening,Km(this,t)),t[vt]=!1,this};function Km(t,e){e.resumeScheduled||(e.resumeScheduled=!0,we.nextTick(Ym,t,e))}function Ym(t,e){C("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),uf(t),e.flowing&&!e.reading&&t.read(0)}O.prototype.pause=function(){return C("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(C("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[vt]=!0,this};function uf(t){let e=t._readableState;for(C("flow",e.flowing);e.flowing&&t.read()!==null;);}O.prototype.wrap=function(t){let e=!1;t.on("data",i=>{!this.push(i)&&t.pause&&(e=!0,t.pause())}),t.on("end",()=>{this.push(null)}),t.on("error",i=>{nr(this,i)}),t.on("close",()=>{this.destroy()}),t.on("destroy",()=>{this.destroy()}),this._read=()=>{e&&t.resume&&(e=!1,t.resume())};let r=pm(t);for(let i=1;i<r.length;i++){let n=r[i];this[n]===void 0&&typeof t[n]=="function"&&(this[n]=t[n].bind(t))}return this};O.prototype[bm]=function(){return cf(this)};O.prototype.iterator=function(t){return t!==void 0&&Rm(t,"options"),cf(this,t)};function cf(t,e){typeof t.read!="function"&&(t=O.wrap(t,{objectMode:!0}));let r=Qm(t,e);return r.stream=t,r}async function*Qm(t,e){let r=Fs;function i(o){this===t?(r(),r=Fs):r=o}t.on("readable",i);let n,s=Zc(t,{writable:!1},o=>{n=o?Yc(n,o):null,r(),r=Fs});try{for(;;){let o=t.destroyed?null:t.read();if(o!==null)yield o;else{if(n)throw n;if(n===null)return;await new Xc(i)}}}catch(o){throw n=Yc(n,o),n}finally{(n||e?.destroyOnReturn!==!1)&&(n===void 0||t._readableState.autoDestroy)?or.destroyer(t,null):(t.off("readable",i),s())}}Ks(O.prototype,{readable:{__proto__:null,get(){let t=this._readableState;return!!t&&t.readable!==!1&&!t.destroyed&&!t.errorEmitted&&!t.endEmitted},set(t){this._readableState&&(this._readableState.readable=!!t)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(t){this._readableState&&(this._readableState.destroyed=t)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}});Ks($i.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[vt]!==!1},set(t){this[vt]=!!t}}});O._fromList=ff;function ff(t,e){if(e.length===0)return null;let r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function Vs(t){let e=t._readableState;C("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,we.nextTick(Jm,e,t))}function Jm(t,e){if(C("endReadableNT",t.endEmitted,t.length),!t.errored&&!t.closeEmitted&&!t.endEmitted&&t.length===0){if(t.endEmitted=!0,e.emit("end"),e.writable&&e.allowHalfOpen===!1)we.nextTick(Xm,e);else if(t.autoDestroy){let r=e._writableState;(!r||r.autoDestroy&&(r.finished||r.writable===!1))&&e.destroy()}}}function Xm(t){t.writable&&!t.writableEnded&&!t.destroyed&&t.end()}O.from=function(t,e){return km(O,t,e)};var Hs;function hf(){return Hs===void 0&&(Hs={}),Hs}O.fromWeb=function(t,e){return hf().newStreamReadableFromReadableStream(t,e)};O.toWeb=function(t,e){return hf().newReadableStreamFromStreamReadable(t,e)};O.wrap=function(t,e){var r,i;return new O({objectMode:(r=(i=t.readableObjectMode)!==null&&i!==void 0?i:t.objectMode)!==null&&r!==void 0?r:!0,...e,destroy(n,s){or.destroyer(t,n),s(n)}}).wrap(t)}});var Yi=g((ox,Af)=>{"use strict";var Tt=rt(),{ArrayPrototypeSlice:_f,Error:Zm,FunctionPrototypeSymbolHasInstance:bf,ObjectDefineProperty:yf,ObjectDefineProperties:ew,ObjectSetPrototypeOf:mf,StringPrototypeToLowerCase:tw,Symbol:rw,SymbolHasInstance:iw}=U();Af.exports=W;W.WritableState=Hr;var{EventEmitter:nw}=E("events"),$r=Li().Stream,{Buffer:Hi}=E("buffer"),Ki=Et(),{addAbortSignal:sw}=Dr(),{getHighWaterMark:ow,getDefaultHighWaterMark:aw}=Ur(),{ERR_INVALID_ARG_TYPE:lw,ERR_METHOD_NOT_IMPLEMENTED:uw,ERR_MULTIPLE_CALLBACK:wf,ERR_STREAM_CANNOT_PIPE:cw,ERR_STREAM_DESTROYED:Vr,ERR_STREAM_ALREADY_FINISHED:fw,ERR_STREAM_NULL_VALUES:hw,ERR_STREAM_WRITE_AFTER_END:dw,ERR_UNKNOWN_ENCODING:Sf}=te().codes,{errorOrDestroy:ar}=Ki;mf(W.prototype,$r.prototype);mf(W,$r);function Js(){}var lr=rw("kOnFinished");function Hr(t,e,r){typeof r!="boolean"&&(r=e instanceof Ce()),this.objectMode=!!(t&&t.objectMode),r&&(this.objectMode=this.objectMode||!!(t&&t.writableObjectMode)),this.highWaterMark=t?ow(this,t,"writableHighWaterMark",r):aw(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let i=!!(t&&t.decodeStrings===!1);this.decodeStrings=!i,this.defaultEncoding=t&&t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=gw.bind(void 0,e),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,zi(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!t||t.emitClose!==!1,this.autoDestroy=!t||t.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[lr]=[]}function zi(t){t.buffered=[],t.bufferedIndex=0,t.allBuffers=!0,t.allNoop=!0}Hr.prototype.getBuffer=function(){return _f(this.buffered,this.bufferedIndex)};yf(Hr.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function W(t){let e=this instanceof Ce();if(!e&&!bf(W,this))return new W(t);this._writableState=new Hr(t,this,e),t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final),typeof t.construct=="function"&&(this._construct=t.construct),t.signal&&sw(t.signal,this)),$r.call(this,t),Ki.construct(this,()=>{let r=this._writableState;r.writing||Zs(this,r),eo(this,r)})}yf(W,iw,{__proto__:null,value:function(t){return bf(this,t)?!0:this!==W?!1:t&&t._writableState instanceof Hr}});W.prototype.pipe=function(){ar(this,new cw)};function Ef(t,e,r,i){let n=t._writableState;if(typeof r=="function")i=r,r=n.defaultEncoding;else{if(!r)r=n.defaultEncoding;else if(r!=="buffer"&&!Hi.isEncoding(r))throw new Sf(r);typeof i!="function"&&(i=Js)}if(e===null)throw new hw;if(!n.objectMode)if(typeof e=="string")n.decodeStrings!==!1&&(e=Hi.from(e,r),r="buffer");else if(e instanceof Hi)r="buffer";else if($r._isUint8Array(e))e=$r._uint8ArrayToBuffer(e),r="buffer";else throw new lw("chunk",["string","Buffer","Uint8Array"],e);let s;return n.ending?s=new dw:n.destroyed&&(s=new Vr("write")),s?(Tt.nextTick(i,s),ar(t,s,!0),s):(n.pendingcb++,pw(t,n,e,r,i))}W.prototype.write=function(t,e,r){return Ef(this,t,e,r)===!0};W.prototype.cork=function(){this._writableState.corked++};W.prototype.uncork=function(){let t=this._writableState;t.corked&&(t.corked--,t.writing||Zs(this,t))};W.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=tw(e)),!Hi.isEncoding(e))throw new Sf(e);return this._writableState.defaultEncoding=e,this};function pw(t,e,r,i,n){let s=e.objectMode?1:r.length;e.length+=s;let o=e.length<e.highWaterMark;return o||(e.needDrain=!0),e.writing||e.corked||e.errored||!e.constructed?(e.buffered.push({chunk:r,encoding:i,callback:n}),e.allBuffers&&i!=="buffer"&&(e.allBuffers=!1),e.allNoop&&n!==Js&&(e.allNoop=!1)):(e.writelen=s,e.writecb=n,e.writing=!0,e.sync=!0,t._write(r,i,e.onwrite),e.sync=!1),o&&!e.errored&&!e.destroyed}function pf(t,e,r,i,n,s,o){e.writelen=i,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new Vr("write")):r?t._writev(n,e.onwrite):t._write(n,s,e.onwrite),e.sync=!1}function gf(t,e,r,i){--e.pendingcb,i(r),Xs(e),ar(t,r)}function gw(t,e){let r=t._writableState,i=r.sync,n=r.writecb;if(typeof n!="function"){ar(t,new wf);return}r.writing=!1,r.writecb=null,r.length-=r.writelen,r.writelen=0,e?(e.stack,r.errored||(r.errored=e),t._readableState&&!t._readableState.errored&&(t._readableState.errored=e),i?Tt.nextTick(gf,t,r,e,n):gf(t,r,e,n)):(r.buffered.length>r.bufferedIndex&&Zs(t,r),i?r.afterWriteTickInfo!==null&&r.afterWriteTickInfo.cb===n?r.afterWriteTickInfo.count++:(r.afterWriteTickInfo={count:1,cb:n,stream:t,state:r},Tt.nextTick(_w,r.afterWriteTickInfo)):vf(t,r,1,n))}function _w({stream:t,state:e,count:r,cb:i}){return e.afterWriteTickInfo=null,vf(t,e,r,i)}function vf(t,e,r,i){for(!e.ending&&!t.destroyed&&e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"));r-- >0;)e.pendingcb--,i();e.destroyed&&Xs(e),eo(t,e)}function Xs(t){if(t.writing)return;for(let n=t.bufferedIndex;n<t.buffered.length;++n){var e;let{chunk:s,callback:o}=t.buffered[n],a=t.objectMode?1:s.length;t.length-=a,o((e=t.errored)!==null&&e!==void 0?e:new Vr("write"))}let r=t[lr].splice(0);for(let n=0;n<r.length;n++){var i;r[n]((i=t.errored)!==null&&i!==void 0?i:new Vr("end"))}zi(t)}function Zs(t,e){if(e.corked||e.bufferProcessing||e.destroyed||!e.constructed)return;let{buffered:r,bufferedIndex:i,objectMode:n}=e,s=r.length-i;if(!s)return;let o=i;if(e.bufferProcessing=!0,s>1&&t._writev){e.pendingcb-=s-1;let a=e.allNoop?Js:u=>{for(let f=o;f<r.length;++f)r[f].callback(u)},l=e.allNoop&&o===0?r:_f(r,o);l.allBuffers=e.allBuffers,pf(t,e,!0,e.length,l,"",a),zi(e)}else{do{let{chunk:a,encoding:l,callback:u}=r[o];r[o++]=null;let f=n?1:a.length;pf(t,e,!1,f,a,l,u)}while(o<r.length&&!e.writing);o===r.length?zi(e):o>256?(r.splice(0,o),e.bufferedIndex=0):e.bufferedIndex=o}e.bufferProcessing=!1}W.prototype._write=function(t,e,r){if(this._writev)this._writev([{chunk:t,encoding:e}],r);else throw new uw("_write()")};W.prototype._writev=null;W.prototype.end=function(t,e,r){let i=this._writableState;typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null);let n;if(t!=null){let s=Ef(this,t,e);s instanceof Zm&&(n=s)}return i.corked&&(i.corked=1,this.uncork()),n||(!i.errored&&!i.ending?(i.ending=!0,eo(this,i,!0),i.ended=!0):i.finished?n=new fw("end"):i.destroyed&&(n=new Vr("end"))),typeof r=="function"&&(n||i.finished?Tt.nextTick(r,n):i[lr].push(r)),this};function Gi(t){return t.ending&&!t.destroyed&&t.constructed&&t.length===0&&!t.errored&&t.buffered.length===0&&!t.finished&&!t.writing&&!t.errorEmitted&&!t.closeEmitted}function bw(t,e){let r=!1;function i(n){if(r){ar(t,n??wf());return}if(r=!0,e.pendingcb--,n){let s=e[lr].splice(0);for(let o=0;o<s.length;o++)s[o](n);ar(t,n,e.sync)}else Gi(e)&&(e.prefinished=!0,t.emit("prefinish"),e.pendingcb++,Tt.nextTick(Qs,t,e))}e.sync=!0,e.pendingcb++;try{t._final(i)}catch(n){i(n)}e.sync=!1}function yw(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.finalCalled=!0,bw(t,e)):(e.prefinished=!0,t.emit("prefinish")))}function eo(t,e,r){Gi(e)&&(yw(t,e),e.pendingcb===0&&(r?(e.pendingcb++,Tt.nextTick((i,n)=>{Gi(n)?Qs(i,n):n.pendingcb--},t,e)):Gi(e)&&(e.pendingcb++,Qs(t,e))))}function Qs(t,e){e.pendingcb--,e.finished=!0;let r=e[lr].splice(0);for(let i=0;i<r.length;i++)r[i]();if(t.emit("finish"),e.autoDestroy){let i=t._readableState;(!i||i.autoDestroy&&(i.endEmitted||i.readable===!1))&&t.destroy()}}ew(W.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(t){this._writableState&&(this._writableState.destroyed=t)}},writable:{__proto__:null,get(){let t=this._writableState;return!!t&&t.writable!==!1&&!t.destroyed&&!t.errored&&!t.ending&&!t.ended},set(t){this._writableState&&(this._writableState.writable=!!t)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let t=this._writableState;return t?!t.destroyed&&!t.ending&&t.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var mw=Ki.destroy;W.prototype.destroy=function(t,e){let r=this._writableState;return!r.destroyed&&(r.bufferedIndex<r.buffered.length||r[lr].length)&&Tt.nextTick(Xs,r),mw.call(this,t,e),this};W.prototype._undestroy=Ki.undestroy;W.prototype._destroy=function(t,e){e(t)};W.prototype[nw.captureRejectionSymbol]=function(t){this.destroy(t)};var Ys;function Tf(){return Ys===void 0&&(Ys={}),Ys}W.fromWeb=function(t,e){return Tf().newStreamWritableFromWritableStream(t,e)};W.toWeb=function(t){return Tf().newWritableStreamFromStreamWritable(t)}});var Uf=g((ax,Df)=>{"use strict";var to=rt(),ww=E("buffer"),{isReadable:Sw,isWritable:Ew,isIterable:xf,isNodeStream:vw,isReadableNodeStream:If,isWritableNodeStream:Of,isDuplexNodeStream:Tw,isReadableStream:Pf,isWritableStream:Cf}=Oe(),Rf=We(),{AbortError:Lf,codes:{ERR_INVALID_ARG_TYPE:Aw,ERR_INVALID_RETURN_VALUE:kf}}=te(),{destroyer:cr}=Et(),xw=Ce(),jf=Fr(),Iw=Yi(),{createDeferredPromise:Mf}=X(),Bf=Us(),qf=globalThis.Blob||ww.Blob,Ow=typeof qf<"u"?function(e){return e instanceof qf}:function(e){return!1},Pw=globalThis.AbortController||er().AbortController,{FunctionPrototypeCall:Nf}=U(),st=class extends xw{constructor(e){super(e),e?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),e?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};Df.exports=function t(e,r){if(Tw(e))return e;if(If(e))return ur({readable:e});if(Of(e))return ur({writable:e});if(vw(e))return ur({writable:!1,readable:!1});if(Pf(e))return ur({readable:jf.fromWeb(e)});if(Cf(e))return ur({writable:Iw.fromWeb(e)});if(typeof e=="function"){let{value:n,write:s,final:o,destroy:a}=Cw(e);if(xf(n))return Bf(st,n,{objectMode:!0,write:s,final:o,destroy:a});let l=n?.then;if(typeof l=="function"){let u,f=Nf(l,n,c=>{if(c!=null)throw new kf("nully","body",c)},c=>{cr(u,c)});return u=new st({objectMode:!0,readable:!1,write:s,final(c){o(async()=>{try{await f,to.nextTick(c,null)}catch(h){to.nextTick(c,h)}})},destroy:a})}throw new kf("Iterable, AsyncIterable or AsyncFunction",r,n)}if(Ow(e))return t(e.arrayBuffer());if(xf(e))return Bf(st,e,{objectMode:!0,writable:!1});if(Pf(e?.readable)&&Cf(e?.writable))return st.fromWeb(e);if(typeof e?.writable=="object"||typeof e?.readable=="object"){let n=e!=null&&e.readable?If(e?.readable)?e?.readable:t(e.readable):void 0,s=e!=null&&e.writable?Of(e?.writable)?e?.writable:t(e.writable):void 0;return ur({readable:n,writable:s})}let i=e?.then;if(typeof i=="function"){let n;return Nf(i,e,s=>{s!=null&&n.push(s),n.push(null)},s=>{cr(n,s)}),n=new st({objectMode:!0,writable:!1,read(){}})}throw new Aw(r,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],e)};function Cw(t){let{promise:e,resolve:r}=Mf(),i=new Pw,n=i.signal;return{value:t(async function*(){for(;;){let o=e;e=null;let{chunk:a,done:l,cb:u}=await o;if(to.nextTick(u),l)return;if(n.aborted)throw new Lf(void 0,{cause:n.reason});({promise:e,resolve:r}=Mf()),yield a}}(),{signal:n}),write(o,a,l){let u=r;r=null,u({chunk:o,done:!1,cb:l})},final(o){let a=r;r=null,a({done:!0,cb:o})},destroy(o,a){i.abort(),a(o)}}}function ur(t){let e=t.readable&&typeof t.readable.read!="function"?jf.wrap(t.readable):t.readable,r=t.writable,i=!!Sw(e),n=!!Ew(r),s,o,a,l,u;function f(c){let h=l;l=null,h?h(c):c&&u.destroy(c)}return u=new st({readableObjectMode:!!(e!=null&&e.readableObjectMode),writableObjectMode:!!(r!=null&&r.writableObjectMode),readable:i,writable:n}),n&&(Rf(r,c=>{n=!1,c&&cr(e,c),f(c)}),u._write=function(c,h,d){r.write(c,h)?d():s=d},u._final=function(c){r.end(),o=c},r.on("drain",function(){if(s){let c=s;s=null,c()}}),r.on("finish",function(){if(o){let c=o;o=null,c()}})),i&&(Rf(e,c=>{i=!1,c&&cr(e,c),f(c)}),e.on("readable",function(){if(a){let c=a;a=null,c()}}),e.on("end",function(){u.push(null)}),u._read=function(){for(;;){let c=e.read();if(c===null){a=u._read;return}if(!u.push(c))return}}),u._destroy=function(c,h){!c&&l!==null&&(c=new Lf),a=null,s=null,o=null,l===null?h(c):(l=h,cr(r,c),cr(e,c))},u}});var Ce=g((lx,$f)=>{"use strict";var{ObjectDefineProperties:Rw,ObjectGetOwnPropertyDescriptor:Fe,ObjectKeys:kw,ObjectSetPrototypeOf:Wf}=U();$f.exports=Se;var no=Fr(),ce=Yi();Wf(Se.prototype,no.prototype);Wf(Se,no);{let t=kw(ce.prototype);for(let e=0;e<t.length;e++){let r=t[e];Se.prototype[r]||(Se.prototype[r]=ce.prototype[r])}}function Se(t){if(!(this instanceof Se))return new Se(t);no.call(this,t),ce.call(this,t),t?(this.allowHalfOpen=t.allowHalfOpen!==!1,t.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),t.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}Rw(Se.prototype,{writable:{__proto__:null,...Fe(ce.prototype,"writable")},writableHighWaterMark:{__proto__:null,...Fe(ce.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...Fe(ce.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...Fe(ce.prototype,"writableBuffer")},writableLength:{__proto__:null,...Fe(ce.prototype,"writableLength")},writableFinished:{__proto__:null,...Fe(ce.prototype,"writableFinished")},writableCorked:{__proto__:null,...Fe(ce.prototype,"writableCorked")},writableEnded:{__proto__:null,...Fe(ce.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...Fe(ce.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(t){this._readableState&&this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}});var ro;function Ff(){return ro===void 0&&(ro={}),ro}Se.fromWeb=function(t,e){return Ff().newStreamDuplexFromReadableWritablePair(t,e)};Se.toWeb=function(t){return Ff().newReadableWritablePairFromDuplex(t)};var io;Se.from=function(t){return io||(io=Uf()),io(t,"body")}});var ao=g((ux,Hf)=>{"use strict";var{ObjectSetPrototypeOf:Vf,Symbol:Mw}=U();Hf.exports=$e;var{ERR_METHOD_NOT_IMPLEMENTED:Bw}=te().codes,oo=Ce(),{getHighWaterMark:qw}=Ur();Vf($e.prototype,oo.prototype);Vf($e,oo);var Gr=Mw("kCallback");function $e(t){if(!(this instanceof $e))return new $e(t);let e=t?qw(this,t,"readableHighWaterMark",!0):null;e===0&&(t={...t,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:t.writableHighWaterMark||0}),oo.call(this,t),this._readableState.sync=!1,this[Gr]=null,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",Nw)}function so(t){typeof this._flush=="function"&&!this.destroyed?this._flush((e,r)=>{if(e){t?t(e):this.destroy(e);return}r!=null&&this.push(r),this.push(null),t&&t()}):(this.push(null),t&&t())}function Nw(){this._final!==so&&so.call(this)}$e.prototype._final=so;$e.prototype._transform=function(t,e,r){throw new Bw("_transform()")};$e.prototype._write=function(t,e,r){let i=this._readableState,n=this._writableState,s=i.length;this._transform(t,e,(o,a)=>{if(o){r(o);return}a!=null&&this.push(a),n.ended||s===i.length||i.length<i.highWaterMark?r():this[Gr]=r})};$e.prototype._read=function(){if(this[Gr]){let t=this[Gr];this[Gr]=null,t()}}});var uo=g((cx,zf)=>{"use strict";var{ObjectSetPrototypeOf:Gf}=U();zf.exports=fr;var lo=ao();Gf(fr.prototype,lo.prototype);Gf(fr,lo);function fr(t){if(!(this instanceof fr))return new fr(t);lo.call(this,t)}fr.prototype._transform=function(t,e,r){r(null,t)}});var Zi=g((fx,Xf)=>{"use strict";var zr=rt(),{ArrayIsArray:Lw,Promise:jw,SymbolAsyncIterator:Dw,SymbolDispose:Uw}=U(),Xi=We(),{once:Ww}=X(),Fw=Et(),Kf=Ce(),{aggregateTwoErrors:$w,codes:{ERR_INVALID_ARG_TYPE:mo,ERR_INVALID_RETURN_VALUE:co,ERR_MISSING_ARGS:Vw,ERR_STREAM_DESTROYED:Hw,ERR_STREAM_PREMATURE_CLOSE:Gw},AbortError:zw}=te(),{validateFunction:Kw,validateAbortSignal:Yw}=rr(),{isIterable:At,isReadable:fo,isReadableNodeStream:Ji,isNodeStream:Yf,isTransformStream:hr,isWebStream:Qw,isReadableStream:ho,isReadableFinished:Jw}=Oe(),Xw=globalThis.AbortController||er().AbortController,po,go,_o;function Qf(t,e,r){let i=!1;t.on("close",()=>{i=!0});let n=Xi(t,{readable:e,writable:r},s=>{i=!s});return{destroy:s=>{i||(i=!0,Fw.destroyer(t,s||new Hw("pipe")))},cleanup:n}}function Zw(t){return Kw(t[t.length-1],"streams[stream.length - 1]"),t.pop()}function bo(t){if(At(t))return t;if(Ji(t))return e0(t);throw new mo("val",["Readable","Iterable","AsyncIterable"],t)}async function*e0(t){go||(go=Fr()),yield*go.prototype[Dw].call(t)}async function Qi(t,e,r,{end:i}){let n,s=null,o=u=>{if(u&&(n=u),s){let f=s;s=null,f()}},a=()=>new jw((u,f)=>{n?f(n):s=()=>{n?f(n):u()}});e.on("drain",o);let l=Xi(e,{readable:!1},o);try{e.writableNeedDrain&&await a();for await(let u of t)e.write(u)||await a();i&&(e.end(),await a()),r()}catch(u){r(n!==u?$w(n,u):u)}finally{l(),e.off("drain",o)}}async function yo(t,e,r,{end:i}){hr(e)&&(e=e.writable);let n=e.getWriter();try{for await(let s of t)await n.ready,n.write(s).catch(()=>{});await n.ready,i&&await n.close(),r()}catch(s){try{await n.abort(s),r(s)}catch(o){r(o)}}}function t0(...t){return Jf(t,Ww(Zw(t)))}function Jf(t,e,r){if(t.length===1&&Lw(t[0])&&(t=t[0]),t.length<2)throw new Vw("streams");let i=new Xw,n=i.signal,s=r?.signal,o=[];Yw(s,"options.signal");function a(){_(new zw)}_o=_o||X().addAbortListener;let l;s&&(l=_o(s,a));let u,f,c=[],h=0;function d(A){_(A,--h===0)}function _(A,S){var I;if(A&&(!u||u.code==="ERR_STREAM_PREMATURE_CLOSE")&&(u=A),!(!u&&!S)){for(;c.length;)c.shift()(u);(I=l)===null||I===void 0||I[Uw](),i.abort(),S&&(u||o.forEach(N=>N()),zr.nextTick(e,u,f))}}let p;for(let A=0;A<t.length;A++){let S=t[A],I=A<t.length-1,N=A>0,M=I||r?.end!==!1,F=A===t.length-1;if(Yf(S)){let B=function(Q){Q&&Q.name!=="AbortError"&&Q.code!=="ERR_STREAM_PREMATURE_CLOSE"&&d(Q)};var m=B;if(M){let{destroy:Q,cleanup:kr}=Qf(S,I,N);c.push(Q),fo(S)&&F&&o.push(kr)}S.on("error",B),fo(S)&&F&&o.push(()=>{S.removeListener("error",B)})}if(A===0)if(typeof S=="function"){if(p=S({signal:n}),!At(p))throw new co("Iterable, AsyncIterable or Stream","source",p)}else At(S)||Ji(S)||hr(S)?p=S:p=Kf.from(S);else if(typeof S=="function"){if(hr(p)){var y;p=bo((y=p)===null||y===void 0?void 0:y.readable)}else p=bo(p);if(p=S(p,{signal:n}),I){if(!At(p,!0))throw new co("AsyncIterable",`transform[${A-1}]`,p)}else{var b;po||(po=uo());let B=new po({objectMode:!0}),Q=(b=p)===null||b===void 0?void 0:b.then;if(typeof Q=="function")h++,Q.call(p,Ze=>{f=Ze,Ze!=null&&B.write(Ze),M&&B.end(),zr.nextTick(d)},Ze=>{B.destroy(Ze),zr.nextTick(d,Ze)});else if(At(p,!0))h++,Qi(p,B,d,{end:M});else if(ho(p)||hr(p)){let Ze=p.readable||p;h++,Qi(Ze,B,d,{end:M})}else throw new co("AsyncIterable or Promise","destination",p);p=B;let{destroy:kr,cleanup:os}=Qf(p,!1,!0);c.push(kr),F&&o.push(os)}}else if(Yf(S)){if(Ji(p)){h+=2;let B=r0(p,S,d,{end:M});fo(S)&&F&&o.push(B)}else if(hr(p)||ho(p)){let B=p.readable||p;h++,Qi(B,S,d,{end:M})}else if(At(p))h++,Qi(p,S,d,{end:M});else throw new mo("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],p);p=S}else if(Qw(S)){if(Ji(p))h++,yo(bo(p),S,d,{end:M});else if(ho(p)||At(p))h++,yo(p,S,d,{end:M});else if(hr(p))h++,yo(p.readable,S,d,{end:M});else throw new mo("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],p);p=S}else p=Kf.from(S)}return(n!=null&&n.aborted||s!=null&&s.aborted)&&zr.nextTick(a),p}function r0(t,e,r,{end:i}){let n=!1;if(e.on("close",()=>{n||r(new Gw)}),t.pipe(e,{end:!1}),i){let o=function(){n=!0,e.end()};var s=o;Jw(t)?zr.nextTick(o):t.once("end",o)}else r();return Xi(t,{readable:!0,writable:!1},o=>{let a=t._readableState;o&&o.code==="ERR_STREAM_PREMATURE_CLOSE"&&a&&a.ended&&!a.errored&&!a.errorEmitted?t.once("end",r).once("error",r):r(o)}),Xi(e,{readable:!1,writable:!0},r)}Xf.exports={pipelineImpl:Jf,pipeline:t0}});var So=g((hx,nh)=>{"use strict";var{pipeline:i0}=Zi(),en=Ce(),{destroyer:n0}=Et(),{isNodeStream:tn,isReadable:Zf,isWritable:eh,isWebStream:wo,isTransformStream:xt,isWritableStream:th,isReadableStream:rh}=Oe(),{AbortError:s0,codes:{ERR_INVALID_ARG_VALUE:ih,ERR_MISSING_ARGS:o0}}=te(),a0=We();nh.exports=function(...e){if(e.length===0)throw new o0("streams");if(e.length===1)return en.from(e[0]);let r=[...e];if(typeof e[0]=="function"&&(e[0]=en.from(e[0])),typeof e[e.length-1]=="function"){let d=e.length-1;e[d]=en.from(e[d])}for(let d=0;d<e.length;++d)if(!(!tn(e[d])&&!wo(e[d]))){if(d<e.length-1&&!(Zf(e[d])||rh(e[d])||xt(e[d])))throw new ih(`streams[${d}]`,r[d],"must be readable");if(d>0&&!(eh(e[d])||th(e[d])||xt(e[d])))throw new ih(`streams[${d}]`,r[d],"must be writable")}let i,n,s,o,a;function l(d){let _=o;o=null,_?_(d):d?a.destroy(d):!h&&!c&&a.destroy()}let u=e[0],f=i0(e,l),c=!!(eh(u)||th(u)||xt(u)),h=!!(Zf(f)||rh(f)||xt(f));if(a=new en({writableObjectMode:!!(u!=null&&u.writableObjectMode),readableObjectMode:!!(f!=null&&f.readableObjectMode),writable:c,readable:h}),c){if(tn(u))a._write=function(_,p,y){u.write(_,p)?y():i=y},a._final=function(_){u.end(),n=_},u.on("drain",function(){if(i){let _=i;i=null,_()}});else if(wo(u)){let p=(xt(u)?u.writable:u).getWriter();a._write=async function(y,b,m){try{await p.ready,p.write(y).catch(()=>{}),m()}catch(A){m(A)}},a._final=async function(y){try{await p.ready,p.close().catch(()=>{}),n=y}catch(b){y(b)}}}let d=xt(f)?f.readable:f;a0(d,()=>{if(n){let _=n;n=null,_()}})}if(h){if(tn(f))f.on("readable",function(){if(s){let d=s;s=null,d()}}),f.on("end",function(){a.push(null)}),a._read=function(){for(;;){let d=f.read();if(d===null){s=a._read;return}if(!a.push(d))return}};else if(wo(f)){let _=(xt(f)?f.readable:f).getReader();a._read=async function(){for(;;)try{let{value:p,done:y}=await _.read();if(!a.push(p))return;if(y){a.push(null);return}}catch{return}}}}return a._destroy=function(d,_){!d&&o!==null&&(d=new s0),s=null,i=null,n=null,o===null?_(d):(o=_,tn(f)&&n0(f,d))},a}});var ph=g((dx,To)=>{"use strict";var l0=globalThis.AbortController||er().AbortController,{codes:{ERR_INVALID_ARG_VALUE:u0,ERR_INVALID_ARG_TYPE:Kr,ERR_MISSING_ARGS:c0,ERR_OUT_OF_RANGE:f0},AbortError:Re}=te(),{validateAbortSignal:It,validateInteger:sh,validateObject:Ot}=rr(),h0=U().Symbol("kWeak"),d0=U().Symbol("kResistStopPropagation"),{finished:p0}=We(),g0=So(),{addAbortSignalNoValidate:_0}=Dr(),{isWritable:b0,isNodeStream:y0}=Oe(),{deprecate:m0}=X(),{ArrayPrototypePush:w0,Boolean:S0,MathFloor:oh,Number:E0,NumberIsNaN:v0,Promise:ah,PromiseReject:lh,PromiseResolve:T0,PromisePrototypeThen:uh,Symbol:fh}=U(),rn=fh("kEmpty"),ch=fh("kEof");function A0(t,e){if(e!=null&&Ot(e,"options"),e?.signal!=null&&It(e.signal,"options.signal"),y0(t)&&!b0(t))throw new u0("stream",t,"must be writable");let r=g0(this,t);return e!=null&&e.signal&&_0(e.signal,r),r}function nn(t,e){if(typeof t!="function")throw new Kr("fn",["Function","AsyncFunction"],t);e!=null&&Ot(e,"options"),e?.signal!=null&&It(e.signal,"options.signal");let r=1;e?.concurrency!=null&&(r=oh(e.concurrency));let i=r-1;return e?.highWaterMark!=null&&(i=oh(e.highWaterMark)),sh(r,"options.concurrency",1),sh(i,"options.highWaterMark",0),i+=r,async function*(){let s=X().AbortSignalAny([e?.signal].filter(S0)),o=this,a=[],l={signal:s},u,f,c=!1,h=0;function d(){c=!0,_()}function _(){h-=1,p()}function p(){f&&!c&&h<r&&a.length<i&&(f(),f=null)}async function y(){try{for await(let b of o){if(c)return;if(s.aborted)throw new Re;try{if(b=t(b,l),b===rn)continue;b=T0(b)}catch(m){b=lh(m)}h+=1,uh(b,_,d),a.push(b),u&&(u(),u=null),!c&&(a.length>=i||h>=r)&&await new ah(m=>{f=m})}a.push(ch)}catch(b){let m=lh(b);uh(m,_,d),a.push(m)}finally{c=!0,u&&(u(),u=null)}}y();try{for(;;){for(;a.length>0;){let b=await a[0];if(b===ch)return;if(s.aborted)throw new Re;b!==rn&&(yield b),a.shift(),p()}await new ah(b=>{u=b})}}finally{c=!0,f&&(f(),f=null)}}.call(this)}function x0(t=void 0){return t!=null&&Ot(t,"options"),t?.signal!=null&&It(t.signal,"options.signal"),async function*(){let r=0;for await(let n of this){var i;if(t!=null&&(i=t.signal)!==null&&i!==void 0&&i.aborted)throw new Re({cause:t.signal.reason});yield[r++,n]}}.call(this)}async function hh(t,e=void 0){for await(let r of vo.call(this,t,e))return!0;return!1}async function I0(t,e=void 0){if(typeof t!="function")throw new Kr("fn",["Function","AsyncFunction"],t);return!await hh.call(this,async(...r)=>!await t(...r),e)}async function O0(t,e){for await(let r of vo.call(this,t,e))return r}async function P0(t,e){if(typeof t!="function")throw new Kr("fn",["Function","AsyncFunction"],t);async function r(i,n){return await t(i,n),rn}for await(let i of nn.call(this,r,e));}function vo(t,e){if(typeof t!="function")throw new Kr("fn",["Function","AsyncFunction"],t);async function r(i,n){return await t(i,n)?i:rn}return nn.call(this,r,e)}var Eo=class extends c0{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function C0(t,e,r){var i;if(typeof t!="function")throw new Kr("reducer",["Function","AsyncFunction"],t);r!=null&&Ot(r,"options"),r?.signal!=null&&It(r.signal,"options.signal");let n=arguments.length>1;if(r!=null&&(i=r.signal)!==null&&i!==void 0&&i.aborted){let u=new Re(void 0,{cause:r.signal.reason});throw this.once("error",()=>{}),await p0(this.destroy(u)),u}let s=new l0,o=s.signal;if(r!=null&&r.signal){let u={once:!0,[h0]:this,[d0]:!0};r.signal.addEventListener("abort",()=>s.abort(),u)}let a=!1;try{for await(let u of this){var l;if(a=!0,r!=null&&(l=r.signal)!==null&&l!==void 0&&l.aborted)throw new Re;n?e=await t(e,u,{signal:o}):(e=u,n=!0)}if(!a&&!n)throw new Eo}finally{s.abort()}return e}async function R0(t){t!=null&&Ot(t,"options"),t?.signal!=null&&It(t.signal,"options.signal");let e=[];for await(let i of this){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new Re(void 0,{cause:t.signal.reason});w0(e,i)}return e}function k0(t,e){let r=nn.call(this,t,e);return async function*(){for await(let n of r)yield*n}.call(this)}function dh(t){if(t=E0(t),v0(t))return 0;if(t<0)throw new f0("number",">= 0",t);return t}function M0(t,e=void 0){return e!=null&&Ot(e,"options"),e?.signal!=null&&It(e.signal,"options.signal"),t=dh(t),async function*(){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new Re;for await(let s of this){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new Re;t--<=0&&(yield s)}}.call(this)}function B0(t,e=void 0){return e!=null&&Ot(e,"options"),e?.signal!=null&&It(e.signal,"options.signal"),t=dh(t),async function*(){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new Re;for await(let s of this){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new Re;if(t-- >0&&(yield s),t<=0)return}}.call(this)}To.exports.streamReturningOperators={asIndexedPairs:m0(x0,"readable.asIndexedPairs will be removed in a future version."),drop:M0,filter:vo,flatMap:k0,map:nn,take:B0,compose:A0};To.exports.promiseReturningOperators={every:I0,forEach:P0,reduce:C0,toArray:R0,some:hh,find:O0}});var Ao=g((px,gh)=>{"use strict";var{ArrayPrototypePop:q0,Promise:N0}=U(),{isIterable:L0,isNodeStream:j0,isWebStream:D0}=Oe(),{pipelineImpl:U0}=Zi(),{finished:W0}=We();xo();function F0(...t){return new N0((e,r)=>{let i,n,s=t[t.length-1];if(s&&typeof s=="object"&&!j0(s)&&!L0(s)&&!D0(s)){let o=q0(t);i=o.signal,n=o.end}U0(t,(o,a)=>{o?r(o):e(a)},{signal:i,end:n})})}gh.exports={finished:W0,pipeline:F0}});var xo=g((gx,Th)=>{"use strict";var{Buffer:$0}=E("buffer"),{ObjectDefineProperty:Ve,ObjectKeys:yh,ReflectApply:mh}=U(),{promisify:{custom:wh}}=X(),{streamReturningOperators:_h,promiseReturningOperators:bh}=ph(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:Sh}}=te(),V0=So(),{setDefaultHighWaterMark:H0,getDefaultHighWaterMark:G0}=Ur(),{pipeline:Eh}=Zi(),{destroyer:z0}=Et(),vh=We(),Io=Ao(),Yr=Oe(),j=Th.exports=Li().Stream;j.isDestroyed=Yr.isDestroyed;j.isDisturbed=Yr.isDisturbed;j.isErrored=Yr.isErrored;j.isReadable=Yr.isReadable;j.isWritable=Yr.isWritable;j.Readable=Fr();for(let t of yh(_h)){let r=function(...i){if(new.target)throw Sh();return j.Readable.from(mh(e,this,i))};Oo=r;let e=_h[t];Ve(r,"name",{__proto__:null,value:e.name}),Ve(r,"length",{__proto__:null,value:e.length}),Ve(j.Readable.prototype,t,{__proto__:null,value:r,enumerable:!1,configurable:!0,writable:!0})}var Oo;for(let t of yh(bh)){let r=function(...n){if(new.target)throw Sh();return mh(e,this,n)};Oo=r;let e=bh[t];Ve(r,"name",{__proto__:null,value:e.name}),Ve(r,"length",{__proto__:null,value:e.length}),Ve(j.Readable.prototype,t,{__proto__:null,value:r,enumerable:!1,configurable:!0,writable:!0})}var Oo;j.Writable=Yi();j.Duplex=Ce();j.Transform=ao();j.PassThrough=uo();j.pipeline=Eh;var{addAbortSignal:K0}=Dr();j.addAbortSignal=K0;j.finished=vh;j.destroy=z0;j.compose=V0;j.setDefaultHighWaterMark=H0;j.getDefaultHighWaterMark=G0;Ve(j,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return Io}});Ve(Eh,wh,{__proto__:null,enumerable:!0,get(){return Io.pipeline}});Ve(vh,wh,{__proto__:null,enumerable:!0,get(){return Io.finished}});j.Stream=j;j._isUint8Array=function(e){return e instanceof Uint8Array};j._uint8ArrayToBuffer=function(e){return $0.from(e.buffer,e.byteOffset,e.byteLength)}});var ot=g((_x,P)=>{"use strict";var H=E("stream");if(H&&process.env.READABLE_STREAM==="disable"){let t=H.promises;P.exports._uint8ArrayToBuffer=H._uint8ArrayToBuffer,P.exports._isUint8Array=H._isUint8Array,P.exports.isDisturbed=H.isDisturbed,P.exports.isErrored=H.isErrored,P.exports.isReadable=H.isReadable,P.exports.Readable=H.Readable,P.exports.Writable=H.Writable,P.exports.Duplex=H.Duplex,P.exports.Transform=H.Transform,P.exports.PassThrough=H.PassThrough,P.exports.addAbortSignal=H.addAbortSignal,P.exports.finished=H.finished,P.exports.destroy=H.destroy,P.exports.pipeline=H.pipeline,P.exports.compose=H.compose,Object.defineProperty(H,"promises",{configurable:!0,enumerable:!0,get(){return t}}),P.exports.Stream=H.Stream}else{let t=xo(),e=Ao(),r=t.Readable.destroy;P.exports=t.Readable,P.exports._uint8ArrayToBuffer=t._uint8ArrayToBuffer,P.exports._isUint8Array=t._isUint8Array,P.exports.isDisturbed=t.isDisturbed,P.exports.isErrored=t.isErrored,P.exports.isReadable=t.isReadable,P.exports.Readable=t.Readable,P.exports.Writable=t.Writable,P.exports.Duplex=t.Duplex,P.exports.Transform=t.Transform,P.exports.PassThrough=t.PassThrough,P.exports.addAbortSignal=t.addAbortSignal,P.exports.finished=t.finished,P.exports.destroy=t.destroy,P.exports.destroy=r,P.exports.pipeline=t.pipeline,P.exports.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return e}}),P.exports.Stream=t.Stream}P.exports.default=P.exports});var Ah=g((bx,Po)=>{"use strict";typeof Object.create=="function"?Po.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Po.exports=function(e,r){if(r){e.super_=r;var i=function(){};i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e}}});var xh=g((yx,Ro)=>{"use strict";try{if(Co=E("util"),typeof Co.inherits!="function")throw"";Ro.exports=Co.inherits}catch{Ro.exports=Ah()}var Co});var Ph=g((mx,Oh)=>{"use strict";var{Buffer:Ee}=E("buffer"),Ih=Symbol.for("BufferList");function q(t){if(!(this instanceof q))return new q(t);q._init.call(this,t)}q._init=function(e){Object.defineProperty(this,Ih,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)};q.prototype._new=function(e){return new q(e)};q.prototype._offset=function(e){if(e===0)return[0,0];let r=0;for(let i=0;i<this._bufs.length;i++){let n=r+this._bufs[i].length;if(e<n||i===this._bufs.length-1)return[i,e-r];r=n}};q.prototype._reverseOffset=function(t){let e=t[0],r=t[1];for(let i=0;i<e;i++)r+=this._bufs[i].length;return r};q.prototype.get=function(e){if(e>this.length||e<0)return;let r=this._offset(e);return this._bufs[r[0]][r[1]]};q.prototype.slice=function(e,r){return typeof e=="number"&&e<0&&(e+=this.length),typeof r=="number"&&r<0&&(r+=this.length),this.copy(null,0,e,r)};q.prototype.copy=function(e,r,i,n){if((typeof i!="number"||i<0)&&(i=0),(typeof n!="number"||n>this.length)&&(n=this.length),i>=this.length||n<=0)return e||Ee.alloc(0);let s=!!e,o=this._offset(i),a=n-i,l=a,u=s&&r||0,f=o[1];if(i===0&&n===this.length){if(!s)return this._bufs.length===1?this._bufs[0]:Ee.concat(this._bufs,this.length);for(let c=0;c<this._bufs.length;c++)this._bufs[c].copy(e,u),u+=this._bufs[c].length;return e}if(l<=this._bufs[o[0]].length-f)return s?this._bufs[o[0]].copy(e,r,f,f+l):this._bufs[o[0]].slice(f,f+l);s||(e=Ee.allocUnsafe(a));for(let c=o[0];c<this._bufs.length;c++){let h=this._bufs[c].length-f;if(l>h)this._bufs[c].copy(e,u,f),u+=h;else{this._bufs[c].copy(e,u,f,f+l),u+=h;break}l-=h,f&&(f=0)}return e.length>u?e.slice(0,u):e};q.prototype.shallowSlice=function(e,r){if(e=e||0,r=typeof r!="number"?this.length:r,e<0&&(e+=this.length),r<0&&(r+=this.length),e===r)return this._new();let i=this._offset(e),n=this._offset(r),s=this._bufs.slice(i[0],n[0]+1);return n[1]===0?s.pop():s[s.length-1]=s[s.length-1].slice(0,n[1]),i[1]!==0&&(s[0]=s[0].slice(i[1])),this._new(s)};q.prototype.toString=function(e,r,i){return this.slice(r,i).toString(e)};q.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;)if(e>=this._bufs[0].length)e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}return this};q.prototype.duplicate=function(){let e=this._new();for(let r=0;r<this._bufs.length;r++)e.append(this._bufs[r]);return e};q.prototype.append=function(e){if(e==null)return this;if(e.buffer)this._appendBuffer(Ee.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let r=0;r<e.length;r++)this.append(e[r]);else if(this._isBufferList(e))for(let r=0;r<e._bufs.length;r++)this.append(e._bufs[r]);else typeof e=="number"&&(e=e.toString()),this._appendBuffer(Ee.from(e));return this};q.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length};q.prototype.indexOf=function(t,e,r){if(r===void 0&&typeof e=="string"&&(r=e,e=void 0),typeof t=="function"||Array.isArray(t))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof t=="number"?t=Ee.from([t]):typeof t=="string"?t=Ee.from(t,r):this._isBufferList(t)?t=t.slice():Array.isArray(t.buffer)?t=Ee.from(t.buffer,t.byteOffset,t.byteLength):Ee.isBuffer(t)||(t=Ee.from(t)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let i=this._offset(e),n=i[0],s=i[1];for(;n<this._bufs.length;n++){let o=this._bufs[n];for(;s<o.length;)if(o.length-s>=t.length){let l=o.indexOf(t,s);if(l!==-1)return this._reverseOffset([n,l]);s=o.length-t.length+1}else{let l=this._reverseOffset([n,s]);if(this._match(l,t))return l;s++}s=0}return-1};q.prototype._match=function(t,e){if(this.length-t<e.length)return!1;for(let r=0;r<e.length;r++)if(this.get(t+r)!==e[r])return!1;return!0};(function(){let t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let e in t)(function(r){t[r]===null?q.prototype[r]=function(i,n){return this.slice(i,i+n)[r](0,n)}:q.prototype[r]=function(i=0){return this.slice(i,i+t[r])[r](0)}})(e)})();q.prototype._isBufferList=function(e){return e instanceof q||q.isBufferList(e)};q.isBufferList=function(e){return e!=null&&e[Ih]};Oh.exports=q});var Ch=g((Sx,sn)=>{"use strict";var ko=ot().Duplex,Y0=xh(),Qr=Ph();function ee(t){if(!(this instanceof ee))return new ee(t);if(typeof t=="function"){this._callback=t;let e=function(i){this._callback&&(this._callback(i),this._callback=null)}.bind(this);this.on("pipe",function(i){i.on("error",e)}),this.on("unpipe",function(i){i.removeListener("error",e)}),t=null}Qr._init.call(this,t),ko.call(this)}Y0(ee,ko);Object.assign(ee.prototype,Qr.prototype);ee.prototype._new=function(e){return new ee(e)};ee.prototype._write=function(e,r,i){this._appendBuffer(e),typeof i=="function"&&i()};ee.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)};ee.prototype.end=function(e){ko.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)};ee.prototype._destroy=function(e,r){this._bufs.length=0,this.length=0,r(e)};ee.prototype._isBufferList=function(e){return e instanceof ee||e instanceof Qr||ee.isBufferList(e)};ee.isBufferList=Qr.isBufferList;sn.exports=ee;sn.exports.BufferListStream=ee;sn.exports.BufferList=Qr});var kh=g((Ex,Rh)=>{"use strict";var Mo=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};Rh.exports=Mo});var Bo=g((vx,Mh)=>{"use strict";var w=Mh.exports,{Buffer:ne}=E("buffer");w.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"};w.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0};w.requiredHeaderFlagsErrors={};for(let t in w.requiredHeaderFlags){let e=w.requiredHeaderFlags[t];w.requiredHeaderFlagsErrors[t]="Invalid header flag bits, must be 0x"+e.toString(16)+" for "+w.types[t]+" packet"}w.codes={};for(let t in w.types){let e=w.types[t];w.codes[e]=t}w.CMD_SHIFT=4;w.CMD_MASK=240;w.DUP_MASK=8;w.QOS_MASK=3;w.QOS_SHIFT=1;w.RETAIN_MASK=1;w.VARBYTEINT_MASK=127;w.VARBYTEINT_FIN_MASK=128;w.VARBYTEINT_MAX=268435455;w.SESSIONPRESENT_MASK=1;w.SESSIONPRESENT_HEADER=ne.from([w.SESSIONPRESENT_MASK]);w.CONNACK_HEADER=ne.from([w.codes.connack<<w.CMD_SHIFT]);w.USERNAME_MASK=128;w.PASSWORD_MASK=64;w.WILL_RETAIN_MASK=32;w.WILL_QOS_MASK=24;w.WILL_QOS_SHIFT=3;w.WILL_FLAG_MASK=4;w.CLEAN_SESSION_MASK=2;w.CONNECT_HEADER=ne.from([w.codes.connect<<w.CMD_SHIFT]);w.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11};w.propertiesCodes={};for(let t in w.properties){let e=w.properties[t];w.propertiesCodes[e]=t}w.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function at(t){return[0,1,2].map(e=>[0,1].map(r=>[0,1].map(i=>{let n=ne.alloc(1);return n.writeUInt8(w.codes[t]<<w.CMD_SHIFT|(r?w.DUP_MASK:0)|e<<w.QOS_SHIFT|i,0,!0),n})))}w.PUBLISH_HEADER=at("publish");w.SUBSCRIBE_HEADER=at("subscribe");w.SUBSCRIBE_OPTIONS_QOS_MASK=3;w.SUBSCRIBE_OPTIONS_NL_MASK=1;w.SUBSCRIBE_OPTIONS_NL_SHIFT=2;w.SUBSCRIBE_OPTIONS_RAP_MASK=1;w.SUBSCRIBE_OPTIONS_RAP_SHIFT=3;w.SUBSCRIBE_OPTIONS_RH_MASK=3;w.SUBSCRIBE_OPTIONS_RH_SHIFT=4;w.SUBSCRIBE_OPTIONS_RH=[0,16,32];w.SUBSCRIBE_OPTIONS_NL=4;w.SUBSCRIBE_OPTIONS_RAP=8;w.SUBSCRIBE_OPTIONS_QOS=[0,1,2];w.UNSUBSCRIBE_HEADER=at("unsubscribe");w.ACKS={unsuback:at("unsuback"),puback:at("puback"),pubcomp:at("pubcomp"),pubrel:at("pubrel"),pubrec:at("pubrec")};w.SUBACK_HEADER=ne.from([w.codes.suback<<w.CMD_SHIFT]);w.VERSION3=ne.from([3]);w.VERSION4=ne.from([4]);w.VERSION5=ne.from([5]);w.VERSION131=ne.from([131]);w.VERSION132=ne.from([132]);w.QOS=[0,1,2].map(t=>ne.from([t]));w.EMPTY={pingreq:ne.from([w.codes.pingreq<<4,0]),pingresp:ne.from([w.codes.pingresp<<4,0]),disconnect:ne.from([w.codes.disconnect<<4,0])};w.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"};w.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"};w.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};w.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"};w.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};w.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}});var qh=g((Tx,Bh)=>{"use strict";var dr=1e3,pr=dr*60,gr=pr*60,Pt=gr*24,Q0=Pt*7,J0=Pt*365.25;Bh.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return X0(t);if(r==="number"&&isFinite(t))return e.long?eS(t):Z0(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function X0(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),i=(e[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*J0;case"weeks":case"week":case"w":return r*Q0;case"days":case"day":case"d":return r*Pt;case"hours":case"hour":case"hrs":case"hr":case"h":return r*gr;case"minutes":case"minute":case"mins":case"min":case"m":return r*pr;case"seconds":case"second":case"secs":case"sec":case"s":return r*dr;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Z0(t){var e=Math.abs(t);return e>=Pt?Math.round(t/Pt)+"d":e>=gr?Math.round(t/gr)+"h":e>=pr?Math.round(t/pr)+"m":e>=dr?Math.round(t/dr)+"s":t+"ms"}function eS(t){var e=Math.abs(t);return e>=Pt?on(t,e,Pt,"day"):e>=gr?on(t,e,gr,"hour"):e>=pr?on(t,e,pr,"minute"):e>=dr?on(t,e,dr,"second"):t+" ms"}function on(t,e,r,i){var n=e>=r*1.5;return Math.round(t/r)+" "+i+(n?"s":"")}});var qo=g((Ax,Nh)=>{"use strict";function tS(t){r.debug=r,r.default=r,r.coerce=l,r.disable=o,r.enable=n,r.enabled=a,r.humanize=qh(),r.destroy=u,Object.keys(t).forEach(f=>{r[f]=t[f]}),r.names=[],r.skips=[],r.formatters={};function e(f){let c=0;for(let h=0;h<f.length;h++)c=(c<<5)-c+f.charCodeAt(h),c|=0;return r.colors[Math.abs(c)%r.colors.length]}r.selectColor=e;function r(f){let c,h=null,d,_;function p(...y){if(!p.enabled)return;let b=p,m=Number(new Date),A=m-(c||m);b.diff=A,b.prev=c,b.curr=m,c=m,y[0]=r.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let S=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(N,M)=>{if(N==="%%")return"%";S++;let F=r.formatters[M];if(typeof F=="function"){let B=y[S];N=F.call(b,B),y.splice(S,1),S--}return N}),r.formatArgs.call(b,y),(b.log||r.log).apply(b,y)}return p.namespace=f,p.useColors=r.useColors(),p.color=r.selectColor(f),p.extend=i,p.destroy=r.destroy,Object.defineProperty(p,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(d!==r.namespaces&&(d=r.namespaces,_=r.enabled(f)),_),set:y=>{h=y}}),typeof r.init=="function"&&r.init(p),p}function i(f,c){let h=r(this.namespace+(typeof c>"u"?":":c)+f);return h.log=this.log,h}function n(f){r.save(f),r.namespaces=f,r.names=[],r.skips=[];let c=(typeof f=="string"?f:"").trim().replace(" ",",").split(",").filter(Boolean);for(let h of c)h[0]==="-"?r.skips.push(h.slice(1)):r.names.push(h)}function s(f,c){let h=0,d=0,_=-1,p=0;for(;h<f.length;)if(d<c.length&&(c[d]===f[h]||c[d]==="*"))c[d]==="*"?(_=d,p=h,d++):(h++,d++);else if(_!==-1)d=_+1,p++,h=p;else return!1;for(;d<c.length&&c[d]==="*";)d++;return d===c.length}function o(){let f=[...r.names,...r.skips.map(c=>"-"+c)].join(",");return r.enable(""),f}function a(f){for(let c of r.skips)if(s(f,c))return!1;for(let c of r.names)if(s(f,c))return!0;return!1}function l(f){return f instanceof Error?f.stack||f.message:f}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Nh.exports=tS});var Lh=g((oe,an)=>{"use strict";oe.formatArgs=iS;oe.save=nS;oe.load=sS;oe.useColors=rS;oe.storage=oS();oe.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();oe.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function rS(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function iS(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+an.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(r++,n==="%c"&&(i=r))}),t.splice(i,0,e)}oe.log=console.debug||console.log||(()=>{});function nS(t){try{t?oe.storage.setItem("debug",t):oe.storage.removeItem("debug")}catch{}}function sS(){let t;try{t=oe.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function oS(){try{return localStorage}catch{}}an.exports=qo()(oe);var{formatters:aS}=an.exports;aS.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Dh=g((xx,jh)=>{"use strict";jh.exports=(t,e=process.argv)=>{let r=t.startsWith("-")?"":t.length===1?"-":"--",i=e.indexOf(r+t),n=e.indexOf("--");return i!==-1&&(n===-1||i<n)}});var Fh=g((Ix,Wh)=>{"use strict";var lS=E("os"),Uh=E("tty"),fe=Dh(),{env:z}=process,lt;fe("no-color")||fe("no-colors")||fe("color=false")||fe("color=never")?lt=0:(fe("color")||fe("colors")||fe("color=true")||fe("color=always"))&&(lt=1);"FORCE_COLOR"in z&&(z.FORCE_COLOR==="true"?lt=1:z.FORCE_COLOR==="false"?lt=0:lt=z.FORCE_COLOR.length===0?1:Math.min(parseInt(z.FORCE_COLOR,10),3));function No(t){return t===0?!1:{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}function Lo(t,e){if(lt===0)return 0;if(fe("color=16m")||fe("color=full")||fe("color=truecolor"))return 3;if(fe("color=256"))return 2;if(t&&!e&&lt===void 0)return 0;let r=lt||0;if(z.TERM==="dumb")return r;if(process.platform==="win32"){let i=lS.release().split(".");return Number(i[0])>=10&&Number(i[2])>=10586?Number(i[2])>=14931?3:2:1}if("CI"in z)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(i=>i in z)||z.CI_NAME==="codeship"?1:r;if("TEAMCITY_VERSION"in z)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(z.TEAMCITY_VERSION)?1:0;if(z.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in z){let i=parseInt((z.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(z.TERM_PROGRAM){case"iTerm.app":return i>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(z.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(z.TERM)||"COLORTERM"in z?1:r}function uS(t){let e=Lo(t,t&&t.isTTY);return No(e)}Wh.exports={supportsColor:uS,stdout:No(Lo(!0,Uh.isatty(1))),stderr:No(Lo(!0,Uh.isatty(2)))}});var Vh=g((K,un)=>{"use strict";var cS=E("tty"),ln=E("util");K.init=bS;K.log=pS;K.formatArgs=hS;K.save=gS;K.load=_S;K.useColors=fS;K.destroy=ln.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");K.colors=[6,2,3,4,5,1];try{let t=Fh();t&&(t.stderr||t).level>=2&&(K.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}K.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let r=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,s)=>s.toUpperCase()),i=process.env[e];return/^(yes|on|true|enabled)$/i.test(i)?i=!0:/^(no|off|false|disabled)$/i.test(i)?i=!1:i==="null"?i=null:i=Number(i),t[r]=i,t},{});function fS(){return"colors"in K.inspectOpts?!!K.inspectOpts.colors:cS.isatty(process.stderr.fd)}function hS(t){let{namespace:e,useColors:r}=this;if(r){let i=this.color,n="\x1B[3"+(i<8?i:"8;5;"+i),s=`  ${n};1m${e} \x1B[0m`;t[0]=s+t[0].split(`
`).join(`
`+s),t.push(n+"m+"+un.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=dS()+e+" "+t[0]}function dS(){return K.inspectOpts.hideDate?"":new Date().toISOString()+" "}function pS(...t){return process.stderr.write(ln.formatWithOptions(K.inspectOpts,...t)+`
`)}function gS(t){t?process.env.DEBUG=t:delete process.env.DEBUG}function _S(){return process.env.DEBUG}function bS(t){t.inspectOpts={};let e=Object.keys(K.inspectOpts);for(let r=0;r<e.length;r++)t.inspectOpts[e[r]]=K.inspectOpts[e[r]]}un.exports=qo()(K);var{formatters:$h}=un.exports;$h.o=function(t){return this.inspectOpts.colors=this.useColors,ln.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};$h.O=function(t){return this.inspectOpts.colors=this.useColors,ln.inspect(t,this.inspectOpts)}});var ke=g((Ox,jo)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?jo.exports=Lh():jo.exports=Vh()});var zh=g((Px,Gh)=>{"use strict";var yS=Ch(),{EventEmitter:mS}=E("events"),Hh=kh(),R=Bo(),T=ke()("mqtt-packet:parser"),Do=class t extends mS{constructor(){super(),this.parser=this.constructor.parser}static parser(e){return this instanceof t?(this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new t().parser(e)}_resetState(){T("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new Hh,this.error=null,this._list=yS(),this._stateCounter=0}parse(e){for(this.error&&this._resetState(),this._list.append(e),T("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,T("parse: state complete. _stateCounter is now: %d",this._stateCounter),T("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return T("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let e=this._list.readUInt8(0),r=e>>R.CMD_SHIFT;this.packet.cmd=R.types[r];let i=e&15,n=R.requiredHeaderFlags[r];return n!=null&&i!==n?this._emitError(new Error(R.requiredHeaderFlagsErrors[r])):(this.packet.retain=(e&R.RETAIN_MASK)!==0,this.packet.qos=e>>R.QOS_SHIFT&R.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=(e&R.DUP_MASK)!==0,T("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),T("_parseLength %d",e.value),!!e}_parsePayload(){T("_parsePayload: payload %O",this._list);let e=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return T("_parsePayload complete result: %s",e),e}_parseConnect(){T("_parseConnect");let e,r,i,n,s={},o=this.packet,a=this._parseString();if(a===null)return this._emitError(new Error("Cannot parse protocolId"));if(a!=="MQTT"&&a!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(o.protocolId=a,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(o.protocolVersion=this._list.readUInt8(this._pos),o.protocolVersion>=128&&(o.bridgeMode=!0,o.protocolVersion=o.protocolVersion-128),o.protocolVersion!==3&&o.protocolVersion!==4&&o.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(this._list.readUInt8(this._pos)&1)return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));s.username=this._list.readUInt8(this._pos)&R.USERNAME_MASK,s.password=this._list.readUInt8(this._pos)&R.PASSWORD_MASK,s.will=this._list.readUInt8(this._pos)&R.WILL_FLAG_MASK;let l=!!(this._list.readUInt8(this._pos)&R.WILL_RETAIN_MASK),u=(this._list.readUInt8(this._pos)&R.WILL_QOS_MASK)>>R.WILL_QOS_SHIFT;if(s.will)o.will={},o.will.retain=l,o.will.qos=u;else{if(l)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(u)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(o.clean=(this._list.readUInt8(this._pos)&R.CLEAN_SESSION_MASK)!==0,this._pos++,o.keepalive=this._parseNum(),o.keepalive===-1)return this._emitError(new Error("Packet too short"));if(o.protocolVersion===5){let c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(o.properties=c)}let f=this._parseString();if(f===null)return this._emitError(new Error("Packet too short"));if(o.clientId=f,T("_parseConnect: packet.clientId: %s",o.clientId),s.will){if(o.protocolVersion===5){let c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(o.will.properties=c)}if(e=this._parseString(),e===null)return this._emitError(new Error("Cannot parse will topic"));if(o.will.topic=e,T("_parseConnect: packet.will.topic: %s",o.will.topic),r=this._parseBuffer(),r===null)return this._emitError(new Error("Cannot parse will payload"));o.will.payload=r,T("_parseConnect: packet.will.paylaod: %s",o.will.payload)}if(s.username){if(n=this._parseString(),n===null)return this._emitError(new Error("Cannot parse username"));o.username=n,T("_parseConnect: packet.username: %s",o.username)}if(s.password){if(i=this._parseBuffer(),i===null)return this._emitError(new Error("Cannot parse password"));o.password=i}return this.settings=o,T("_parseConnect: complete"),o}_parseConnack(){T("_parseConnack");let e=this.packet;if(this._list.length<1)return null;let r=this._list.readUInt8(this._pos++);if(r>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(e.sessionPresent=!!(r&R.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?e.reasonCode=this._list.readUInt8(this._pos++):e.reasonCode=0;else{if(this._list.length<2)return null;e.returnCode=this._list.readUInt8(this._pos++)}if(e.returnCode===-1||e.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){let i=this._parseProperties();Object.getOwnPropertyNames(i).length&&(e.properties=i)}T("_parseConnack: complete")}_parsePublish(){T("_parsePublish");let e=this.packet;if(e.topic=this._parseString(),e.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(e.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}e.payload=this._list.slice(this._pos,e.length),T("_parsePublish: payload from buffer list: %o",e.payload)}}_parseSubscribe(){T("_parseSubscribe");let e=this.packet,r,i,n,s,o,a,l;if(e.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(e.properties=u)}if(e.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<e.length;){if(r=this._parseString(),r===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=e.length)return this._emitError(new Error("Malformed Subscribe Payload"));if(i=this._parseByte(),this.settings.protocolVersion===5){if(i&192)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if(i&252)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(n=i&R.SUBSCRIBE_OPTIONS_QOS_MASK,n>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(a=(i>>R.SUBSCRIBE_OPTIONS_NL_SHIFT&R.SUBSCRIBE_OPTIONS_NL_MASK)!==0,o=(i>>R.SUBSCRIBE_OPTIONS_RAP_SHIFT&R.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,s=i>>R.SUBSCRIBE_OPTIONS_RH_SHIFT&R.SUBSCRIBE_OPTIONS_RH_MASK,s>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));l={topic:r,qos:n},this.settings.protocolVersion===5?(l.nl=a,l.rap=o,l.rh=s):this.settings.bridgeMode&&(l.rh=0,l.rap=!0,l.nl=!0),T("_parseSubscribe: push subscription `%s` to subscription",l),e.subscriptions.push(l)}}}_parseSuback(){T("_parseSuback");let e=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}if(e.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let r=this._list.readUInt8(this._pos++);if(this.settings.protocolVersion===5){if(!R.MQTT5_SUBACK_CODES[r])return this._emitError(new Error("Invalid suback code"))}else if(r>2&&r!==128)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(r)}}}_parseUnsubscribe(){T("_parseUnsubscribe");let e=this.packet;if(e.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}if(e.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<e.length;){let r=this._parseString();if(r===null)return this._emitError(new Error("Cannot parse topic"));T("_parseUnsubscribe: push topic `%s` to unsubscriptions",r),e.unsubscriptions.push(r)}}}_parseUnsuback(){T("_parseUnsuback");let e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((this.settings.protocolVersion===3||this.settings.protocolVersion===4)&&e.length!==2)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(e.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(this.settings.protocolVersion===5){let r=this._parseProperties();for(Object.getOwnPropertyNames(r).length&&(e.properties=r),e.granted=[];this._pos<this.packet.length;){let i=this._list.readUInt8(this._pos++);if(!R.MQTT5_UNSUBACK_CODES[i])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push(i)}}}_parseConfirmation(){T("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let e=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5){if(e.length>2){switch(e.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!R.MQTT5_PUBACK_PUBREC_CODES[e.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!R.MQTT5_PUBREL_PUBCOMP_CODES[e.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break}T("_parseConfirmation: packet.reasonCode `%d`",e.reasonCode)}else e.reasonCode=0;if(e.length>3){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}}return!0}_parseDisconnect(){let e=this.packet;if(T("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?(e.reasonCode=this._parseByte(),R.MQTT5_DISCONNECT_CODES[e.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):e.reasonCode=0;let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}return T("_parseDisconnect result: true"),!0}_parseAuth(){T("_parseAuth");let e=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(e.reasonCode=this._parseByte(),!R.MQTT5_AUTH_CODES[e.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let r=this._parseProperties();return Object.getOwnPropertyNames(r).length&&(e.properties=r),T("_parseAuth: result: true"),!0}_parseMessageId(){let e=this.packet;return e.messageId=this._parseNum(),e.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(T("_parseMessageId: packet.messageId %d",e.messageId),!0)}_parseString(e){let r=this._parseNum(),i=r+this._pos;if(r===-1||i>this._list.length||i>this.packet.length)return null;let n=this._list.toString("utf8",this._pos,i);return this._pos+=r,T("_parseString: result: %s",n),n}_parseStringPair(){return T("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let e=this._parseNum(),r=e+this._pos;if(e===-1||r>this._list.length||r>this.packet.length)return null;let i=this._list.slice(this._pos,r);return this._pos+=e,T("_parseBuffer: result: %o",i),i}_parseNum(){if(this._list.length-this._pos<2)return-1;let e=this._list.readUInt16BE(this._pos);return this._pos+=2,T("_parseNum: result: %s",e),e}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let e=this._list.readUInt32BE(this._pos);return this._pos+=4,T("_parse4ByteNum: result: %s",e),e}_parseVarByteNum(e){T("_parseVarByteNum");let r=4,i=0,n=1,s=0,o=!1,a,l=this._pos?this._pos:0;for(;i<r&&l+i<this._list.length;){if(a=this._list.readUInt8(l+i++),s+=n*(a&R.VARBYTEINT_MASK),n*=128,!(a&R.VARBYTEINT_FIN_MASK)){o=!0;break}if(this._list.length<=i)break}return!o&&i===r&&this._list.length>=i&&this._emitError(new Error("Invalid variable byte integer")),l&&(this._pos+=i),o?e?o={bytes:i,value:s}:o=s:o=!1,T("_parseVarByteNum: result: %o",o),o}_parseByte(){let e;return this._pos<this._list.length&&(e=this._list.readUInt8(this._pos),this._pos++),T("_parseByte: result: %o",e),e}_parseByType(e){switch(T("_parseByType: type: %s",e),e){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){T("_parseProperties");let e=this._parseVarByteNum(),i=this._pos+e,n={};for(;this._pos<i;){let s=this._parseByte();if(!s)return this._emitError(new Error("Cannot parse property code type")),!1;let o=R.propertiesCodes[s];if(!o)return this._emitError(new Error("Unknown property")),!1;if(o==="userProperties"){n[o]||(n[o]=Object.create(null));let a=this._parseByType(R.propertiesTypes[o]);if(n[o][a.name])if(Array.isArray(n[o][a.name]))n[o][a.name].push(a.value);else{let l=n[o][a.name];n[o][a.name]=[l],n[o][a.name].push(a.value)}else n[o][a.name]=a.value;continue}n[o]?Array.isArray(n[o])?n[o].push(this._parseByType(R.propertiesTypes[o])):(n[o]=[n[o]],n[o].push(this._parseByType(R.propertiesTypes[o]))):n[o]=this._parseByType(R.propertiesTypes[o])}return n}_newPacket(){return T("_newPacket"),this.packet&&(this._list.consume(this.packet.length),T("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),T("_newPacket: new packet"),this.packet=new Hh,this._pos=0,!0}_emitError(e){T("_emitError",e),this.error=e,this.emit("error",e)}};Gh.exports=Do});var Jh=g((Cx,Qh)=>{"use strict";var{Buffer:Jr}=E("buffer"),wS=65536,Kh={},SS=Jr.isBuffer(Jr.from([1,2]).subarray(0,1));function Yh(t){let e=Jr.allocUnsafe(2);return e.writeUInt8(t>>8,0),e.writeUInt8(t&255,1),e}function ES(){for(let t=0;t<wS;t++)Kh[t]=Yh(t)}function vS(t){let r=0,i=0,n=Jr.allocUnsafe(4);do r=t%128|0,t=t/128|0,t>0&&(r=r|128),n.writeUInt8(r,i++);while(t>0&&i<4);return t>0&&(i=0),SS?n.subarray(0,i):n.slice(0,i)}function TS(t){let e=Jr.allocUnsafe(4);return e.writeUInt32BE(t,0),e}Qh.exports={cache:Kh,generateCache:ES,generateNumber:Yh,genBufVariableByteInt:vS,generate4ByteBuffer:TS}});var Xh=g((Rx,Uo)=>{"use strict";typeof process>"u"||!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0?Uo.exports={nextTick:AS}:Uo.exports=process;function AS(t,e,r,i){if(typeof t!="function")throw new TypeError('"callback" argument must be a function');var n=arguments.length,s,o;switch(n){case 0:case 1:return process.nextTick(t);case 2:return process.nextTick(function(){t.call(null,e)});case 3:return process.nextTick(function(){t.call(null,e,r)});case 4:return process.nextTick(function(){t.call(null,e,r,i)});default:for(s=new Array(n-1),o=0;o<s.length;)s[o++]=arguments[o];return process.nextTick(function(){t.apply(null,s)})}}});var $o=g((kx,od)=>{"use strict";var x=Bo(),{Buffer:v}=E("buffer"),xS=v.allocUnsafe(0),IS=v.from([0]),Xr=Jh(),OS=Xh().nextTick,he=ke()("mqtt-packet:writeToStream"),cn=Xr.cache,PS=Xr.generateNumber,CS=Xr.generateCache,Wo=Xr.genBufVariableByteInt,RS=Xr.generate4ByteBuffer,re=Fo,fn=!0;function nd(t,e,r){switch(he("generate called"),e.cork&&(e.cork(),OS(kS,e)),fn&&(fn=!1,CS()),he("generate: packet.cmd: %s",t.cmd),t.cmd){case"connect":return MS(t,e,r);case"connack":return BS(t,e,r);case"publish":return qS(t,e,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return NS(t,e,r);case"subscribe":return LS(t,e,r);case"suback":return jS(t,e,r);case"unsubscribe":return DS(t,e,r);case"unsuback":return US(t,e,r);case"pingreq":case"pingresp":return WS(t,e,r);case"disconnect":return FS(t,e,r);case"auth":return $S(t,e,r);default:return e.destroy(new Error("Unknown command")),!1}}Object.defineProperty(nd,"cacheNumbers",{get(){return re===Fo},set(t){t?((!cn||Object.keys(cn).length===0)&&(fn=!0),re=Fo):(fn=!1,re=VS)}});function kS(t){t.uncork()}function MS(t,e,r){let i=t||{},n=i.protocolId||"MQTT",s=i.protocolVersion||4,o=i.will,a=i.clean,l=i.keepalive||0,u=i.clientId||"",f=i.username,c=i.password,h=i.properties;a===void 0&&(a=!0);let d=0;if(!n||typeof n!="string"&&!v.isBuffer(n))return e.destroy(new Error("Invalid protocolId")),!1;if(d+=n.length+2,s!==3&&s!==4&&s!==5)return e.destroy(new Error("Invalid protocol version")),!1;if(d+=1,(typeof u=="string"||v.isBuffer(u))&&(u||s>=4)&&(u||a))d+=v.byteLength(u)+2;else{if(s<4)return e.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(a*1===0)return e.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof l!="number"||l<0||l>65535||l%1!==0)return e.destroy(new Error("Invalid keepalive")),!1;d+=2,d+=1;let _,p;if(s===5){if(_=ut(e,h),!_)return!1;d+=_.length}if(o){if(typeof o!="object")return e.destroy(new Error("Invalid will")),!1;if(!o.topic||typeof o.topic!="string")return e.destroy(new Error("Invalid will topic")),!1;if(d+=v.byteLength(o.topic)+2,d+=2,o.payload)if(o.payload.length>=0)typeof o.payload=="string"?d+=v.byteLength(o.payload):d+=o.payload.length;else return e.destroy(new Error("Invalid will payload")),!1;if(p={},s===5){if(p=ut(e,o.properties),!p)return!1;d+=p.length}}let y=!1;if(f!=null)if(id(f))y=!0,d+=v.byteLength(f)+2;else return e.destroy(new Error("Invalid username")),!1;if(c!=null){if(!y)return e.destroy(new Error("Username is required to use password")),!1;if(id(c))d+=sd(c)+2;else return e.destroy(new Error("Invalid password")),!1}e.write(x.CONNECT_HEADER),de(e,d),_r(e,n),i.bridgeMode&&(s+=128),e.write(s===131?x.VERSION131:s===132?x.VERSION132:s===4?x.VERSION4:s===5?x.VERSION5:x.VERSION3);let b=0;return b|=f!=null?x.USERNAME_MASK:0,b|=c!=null?x.PASSWORD_MASK:0,b|=o&&o.retain?x.WILL_RETAIN_MASK:0,b|=o&&o.qos?o.qos<<x.WILL_QOS_SHIFT:0,b|=o?x.WILL_FLAG_MASK:0,b|=a?x.CLEAN_SESSION_MASK:0,e.write(v.from([b])),re(e,l),s===5&&_.write(),_r(e,u),o&&(s===5&&p.write(),Ct(e,o.topic),_r(e,o.payload)),f!=null&&_r(e,f),c!=null&&_r(e,c),!0}function BS(t,e,r){let i=r?r.protocolVersion:4,n=t||{},s=i===5?n.reasonCode:n.returnCode,o=n.properties,a=2;if(typeof s!="number")return e.destroy(new Error("Invalid return code")),!1;let l=null;if(i===5){if(l=ut(e,o),!l)return!1;a+=l.length}return e.write(x.CONNACK_HEADER),de(e,a),e.write(n.sessionPresent?x.SESSIONPRESENT_HEADER:IS),e.write(v.from([s])),l?.write(),!0}function qS(t,e,r){he("publish: packet: %o",t);let i=r?r.protocolVersion:4,n=t||{},s=n.qos||0,o=n.retain?x.RETAIN_MASK:0,a=n.topic,l=n.payload||xS,u=n.messageId,f=n.properties,c=0;if(typeof a=="string")c+=v.byteLength(a)+2;else if(v.isBuffer(a))c+=a.length+2;else return e.destroy(new Error("Invalid topic")),!1;if(v.isBuffer(l)?c+=l.length:c+=v.byteLength(l),s&&typeof u!="number")return e.destroy(new Error("Invalid messageId")),!1;s&&(c+=2);let h=null;if(i===5){if(h=ut(e,f),!h)return!1;c+=h.length}return e.write(x.PUBLISH_HEADER[s][n.dup?1:0][o?1:0]),de(e,c),re(e,sd(a)),e.write(a),s>0&&re(e,u),h?.write(),he("publish: payload: %o",l),e.write(l)}function NS(t,e,r){let i=r?r.protocolVersion:4,n=t||{},s=n.cmd||"puback",o=n.messageId,a=n.dup&&s==="pubrel"?x.DUP_MASK:0,l=0,u=n.reasonCode,f=n.properties,c=i===5?3:2;if(s==="pubrel"&&(l=1),typeof o!="number")return e.destroy(new Error("Invalid messageId")),!1;let h=null;if(i===5&&typeof f=="object"){if(h=Zr(e,f,r,c),!h)return!1;c+=h.length}return e.write(x.ACKS[s][l][a][0]),c===3&&(c+=u!==0?1:-1),de(e,c),re(e,o),i===5&&c!==2&&e.write(v.from([u])),h!==null?h.write():c===4&&e.write(v.from([0])),!0}function LS(t,e,r){he("subscribe: packet: ");let i=r?r.protocolVersion:4,n=t||{},s=n.dup?x.DUP_MASK:0,o=n.messageId,a=n.subscriptions,l=n.properties,u=0;if(typeof o!="number")return e.destroy(new Error("Invalid messageId")),!1;u+=2;let f=null;if(i===5){if(f=ut(e,l),!f)return!1;u+=f.length}if(typeof a=="object"&&a.length)for(let h=0;h<a.length;h+=1){let d=a[h].topic,_=a[h].qos;if(typeof d!="string")return e.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if(typeof _!="number")return e.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(i===5){if(typeof(a[h].nl||!1)!="boolean")return e.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(a[h].rap||!1)!="boolean")return e.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let b=a[h].rh||0;if(typeof b!="number"||b>2)return e.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}u+=v.byteLength(d)+2+1}else return e.destroy(new Error("Invalid subscriptions")),!1;he("subscribe: writing to stream: %o",x.SUBSCRIBE_HEADER),e.write(x.SUBSCRIBE_HEADER[1][s?1:0][0]),de(e,u),re(e,o),f!==null&&f.write();let c=!0;for(let h of a){let d=h.topic,_=h.qos,p=+h.nl,y=+h.rap,b=h.rh,m;Ct(e,d),m=x.SUBSCRIBE_OPTIONS_QOS[_],i===5&&(m|=p?x.SUBSCRIBE_OPTIONS_NL:0,m|=y?x.SUBSCRIBE_OPTIONS_RAP:0,m|=b?x.SUBSCRIBE_OPTIONS_RH[b]:0),c=e.write(v.from([m]))}return c}function jS(t,e,r){let i=r?r.protocolVersion:4,n=t||{},s=n.messageId,o=n.granted,a=n.properties,l=0;if(typeof s!="number")return e.destroy(new Error("Invalid messageId")),!1;if(l+=2,typeof o=="object"&&o.length)for(let f=0;f<o.length;f+=1){if(typeof o[f]!="number")return e.destroy(new Error("Invalid qos vector")),!1;l+=1}else return e.destroy(new Error("Invalid qos vector")),!1;let u=null;if(i===5){if(u=Zr(e,a,r,l),!u)return!1;l+=u.length}return e.write(x.SUBACK_HEADER),de(e,l),re(e,s),u!==null&&u.write(),e.write(v.from(o))}function DS(t,e,r){let i=r?r.protocolVersion:4,n=t||{},s=n.messageId,o=n.dup?x.DUP_MASK:0,a=n.unsubscriptions,l=n.properties,u=0;if(typeof s!="number")return e.destroy(new Error("Invalid messageId")),!1;if(u+=2,typeof a=="object"&&a.length)for(let h=0;h<a.length;h+=1){if(typeof a[h]!="string")return e.destroy(new Error("Invalid unsubscriptions")),!1;u+=v.byteLength(a[h])+2}else return e.destroy(new Error("Invalid unsubscriptions")),!1;let f=null;if(i===5){if(f=ut(e,l),!f)return!1;u+=f.length}e.write(x.UNSUBSCRIBE_HEADER[1][o?1:0][0]),de(e,u),re(e,s),f!==null&&f.write();let c=!0;for(let h=0;h<a.length;h++)c=Ct(e,a[h]);return c}function US(t,e,r){let i=r?r.protocolVersion:4,n=t||{},s=n.messageId,o=n.dup?x.DUP_MASK:0,a=n.granted,l=n.properties,u=n.cmd,f=0,c=2;if(typeof s!="number")return e.destroy(new Error("Invalid messageId")),!1;if(i===5)if(typeof a=="object"&&a.length)for(let d=0;d<a.length;d+=1){if(typeof a[d]!="number")return e.destroy(new Error("Invalid qos vector")),!1;c+=1}else return e.destroy(new Error("Invalid qos vector")),!1;let h=null;if(i===5){if(h=Zr(e,l,r,c),!h)return!1;c+=h.length}return e.write(x.ACKS[u][f][o][0]),de(e,c),re(e,s),h!==null&&h.write(),i===5&&e.write(v.from(a)),!0}function WS(t,e,r){return e.write(x.EMPTY[t.cmd])}function FS(t,e,r){let i=r?r.protocolVersion:4,n=t||{},s=n.reasonCode,o=n.properties,a=i===5?1:0,l=null;if(i===5){if(l=Zr(e,o,r,a),!l)return!1;a+=l.length}return e.write(v.from([x.codes.disconnect<<4])),de(e,a),i===5&&e.write(v.from([s])),l!==null&&l.write(),!0}function $S(t,e,r){let i=r?r.protocolVersion:4,n=t||{},s=n.reasonCode,o=n.properties,a=i===5?1:0;i!==5&&e.destroy(new Error("Invalid mqtt version for auth packet"));let l=Zr(e,o,r,a);return l?(a+=l.length,e.write(v.from([x.codes.auth<<4])),de(e,a),e.write(v.from([s])),l!==null&&l.write(),!0):!1}var Zh={};function de(t,e){if(e>x.VARBYTEINT_MAX)return t.destroy(new Error(`Invalid variable byte integer: ${e}`)),!1;let r=Zh[e];return r||(r=Wo(e),e<16384&&(Zh[e]=r)),he("writeVarByteInt: writing to stream: %o",r),t.write(r)}function Ct(t,e){let r=v.byteLength(e);return re(t,r),he("writeString: %s",e),t.write(e,"utf8")}function ed(t,e,r){Ct(t,e),Ct(t,r)}function Fo(t,e){return he("writeNumberCached: number: %d",e),he("writeNumberCached: %o",cn[e]),t.write(cn[e])}function VS(t,e){let r=PS(e);return he("writeNumberGenerated: %o",r),t.write(r)}function HS(t,e){let r=RS(e);return he("write4ByteNumber: %o",r),t.write(r)}function _r(t,e){typeof e=="string"?Ct(t,e):e?(re(t,e.length),t.write(e)):re(t,0)}function ut(t,e){if(typeof e!="object"||e.length!=null)return{length:1,write(){rd(t,{},0)}};let r=0;function i(s,o){let a=x.propertiesTypes[s],l=0;switch(a){case"byte":{if(typeof o!="boolean")return t.destroy(new Error(`Invalid ${s}: ${o}`)),!1;l+=2;break}case"int8":{if(typeof o!="number"||o<0||o>255)return t.destroy(new Error(`Invalid ${s}: ${o}`)),!1;l+=2;break}case"binary":{if(o&&o===null)return t.destroy(new Error(`Invalid ${s}: ${o}`)),!1;l+=1+v.byteLength(o)+2;break}case"int16":{if(typeof o!="number"||o<0||o>65535)return t.destroy(new Error(`Invalid ${s}: ${o}`)),!1;l+=3;break}case"int32":{if(typeof o!="number"||o<0||o>4294967295)return t.destroy(new Error(`Invalid ${s}: ${o}`)),!1;l+=5;break}case"var":{if(typeof o!="number"||o<0||o>268435455)return t.destroy(new Error(`Invalid ${s}: ${o}`)),!1;l+=1+v.byteLength(Wo(o));break}case"string":{if(typeof o!="string")return t.destroy(new Error(`Invalid ${s}: ${o}`)),!1;l+=3+v.byteLength(o.toString());break}case"pair":{if(typeof o!="object")return t.destroy(new Error(`Invalid ${s}: ${o}`)),!1;l+=Object.getOwnPropertyNames(o).reduce((u,f)=>{let c=o[f];return Array.isArray(c)?u+=c.reduce((h,d)=>(h+=3+v.byteLength(f.toString())+2+v.byteLength(d.toString()),h),0):u+=3+v.byteLength(f.toString())+2+v.byteLength(o[f].toString()),u},0);break}default:return t.destroy(new Error(`Invalid property ${s}: ${o}`)),!1}return l}if(e)for(let s in e){let o=0,a=0,l=e[s];if(Array.isArray(l))for(let u=0;u<l.length;u++){if(a=i(s,l[u]),!a)return!1;o+=a}else{if(a=i(s,l),!a)return!1;o=a}if(!o)return!1;r+=o}return{length:v.byteLength(Wo(r))+r,write(){rd(t,e,r)}}}function Zr(t,e,r,i){let n=["reasonString","userProperties"],s=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,o=ut(t,e);if(s)for(;i+o.length>s;){let a=n.shift();if(a&&e[a])delete e[a],o=ut(t,e);else return!1}return o}function td(t,e,r){switch(x.propertiesTypes[e]){case"byte":{t.write(v.from([x.properties[e]])),t.write(v.from([+r]));break}case"int8":{t.write(v.from([x.properties[e]])),t.write(v.from([r]));break}case"binary":{t.write(v.from([x.properties[e]])),_r(t,r);break}case"int16":{t.write(v.from([x.properties[e]])),re(t,r);break}case"int32":{t.write(v.from([x.properties[e]])),HS(t,r);break}case"var":{t.write(v.from([x.properties[e]])),de(t,r);break}case"string":{t.write(v.from([x.properties[e]])),Ct(t,r);break}case"pair":{Object.getOwnPropertyNames(r).forEach(n=>{let s=r[n];Array.isArray(s)?s.forEach(o=>{t.write(v.from([x.properties[e]])),ed(t,n.toString(),o.toString())}):(t.write(v.from([x.properties[e]])),ed(t,n.toString(),s.toString()))});break}default:return t.destroy(new Error(`Invalid property ${e} value: ${r}`)),!1}}function rd(t,e,r){de(t,r);for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==null){let n=e[i];if(Array.isArray(n))for(let s=0;s<n.length;s++)td(t,i,n[s]);else td(t,i,n)}}function sd(t){return t?t instanceof v?t.length:v.byteLength(t):0}function id(t){return typeof t=="string"||t instanceof v}od.exports=nd});var ud=g((Mx,ld)=>{"use strict";var GS=$o(),{EventEmitter:zS}=E("events"),{Buffer:ad}=E("buffer");function KS(t,e){let r=new Vo;return GS(t,r,e),r.concat()}var Vo=class extends zS{constructor(){super(),this._array=new Array(20),this._i=0}write(e){return this._array[this._i++]=e,!0}concat(){let e=0,r=new Array(this._array.length),i=this._array,n=0,s;for(s=0;s<i.length&&i[s]!==void 0;s++)typeof i[s]!="string"?r[s]=i[s].length:r[s]=ad.byteLength(i[s]),e+=r[s];let o=ad.allocUnsafe(e);for(s=0;s<i.length&&i[s]!==void 0;s++)typeof i[s]!="string"?(i[s].copy(o,n),n+=r[s]):(o.write(i[s],n),n+=r[s]);return o}destroy(e){e&&this.emit("error",e)}};ld.exports=KS});var cd=g(hn=>{"use strict";hn.parser=zh().parser;hn.generate=ud();hn.writeToStream=$o()});var zo=g(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});var Ho=class{constructor(){this.nextId=Math.max(1,Math.floor(Math.random()*65535))}allocate(){let e=this.nextId++;return this.nextId===65536&&(this.nextId=1),e}getLastAllocated(){return this.nextId===1?65535:this.nextId-1}register(e){return!0}deallocate(e){}clear(){}};Go.default=Ho});var hd=g((Nx,fd)=>{"use strict";fd.exports=YS;function br(t){return t instanceof Buffer?Buffer.from(t):new t.constructor(t.buffer.slice(),t.byteOffset,t.length)}function YS(t){if(t=t||{},t.circles)return QS(t);let e=new Map;if(e.set(Date,o=>new Date(o)),e.set(Map,(o,a)=>new Map(i(Array.from(o),a))),e.set(Set,(o,a)=>new Set(i(Array.from(o),a))),t.constructorHandlers)for(let o of t.constructorHandlers)e.set(o[0],o[1]);let r=null;return t.proto?s:n;function i(o,a){let l=Object.keys(o),u=new Array(l.length);for(let f=0;f<l.length;f++){let c=l[f],h=o[c];typeof h!="object"||h===null?u[c]=h:h.constructor!==Object&&(r=e.get(h.constructor))?u[c]=r(h,a):ArrayBuffer.isView(h)?u[c]=br(h):u[c]=a(h)}return u}function n(o){if(typeof o!="object"||o===null)return o;if(Array.isArray(o))return i(o,n);if(o.constructor!==Object&&(r=e.get(o.constructor)))return r(o,n);let a={};for(let l in o){if(Object.hasOwnProperty.call(o,l)===!1)continue;let u=o[l];typeof u!="object"||u===null?a[l]=u:u.constructor!==Object&&(r=e.get(u.constructor))?a[l]=r(u,n):ArrayBuffer.isView(u)?a[l]=br(u):a[l]=n(u)}return a}function s(o){if(typeof o!="object"||o===null)return o;if(Array.isArray(o))return i(o,s);if(o.constructor!==Object&&(r=e.get(o.constructor)))return r(o,s);let a={};for(let l in o){let u=o[l];typeof u!="object"||u===null?a[l]=u:u.constructor!==Object&&(r=e.get(u.constructor))?a[l]=r(u,s):ArrayBuffer.isView(u)?a[l]=br(u):a[l]=s(u)}return a}}function QS(t){let e=[],r=[],i=new Map;if(i.set(Date,l=>new Date(l)),i.set(Map,(l,u)=>new Map(s(Array.from(l),u))),i.set(Set,(l,u)=>new Set(s(Array.from(l),u))),t.constructorHandlers)for(let l of t.constructorHandlers)i.set(l[0],l[1]);let n=null;return t.proto?a:o;function s(l,u){let f=Object.keys(l),c=new Array(f.length);for(let h=0;h<f.length;h++){let d=f[h],_=l[d];if(typeof _!="object"||_===null)c[d]=_;else if(_.constructor!==Object&&(n=i.get(_.constructor)))c[d]=n(_,u);else if(ArrayBuffer.isView(_))c[d]=br(_);else{let p=e.indexOf(_);p!==-1?c[d]=r[p]:c[d]=u(_)}}return c}function o(l){if(typeof l!="object"||l===null)return l;if(Array.isArray(l))return s(l,o);if(l.constructor!==Object&&(n=i.get(l.constructor)))return n(l,o);let u={};e.push(l),r.push(u);for(let f in l){if(Object.hasOwnProperty.call(l,f)===!1)continue;let c=l[f];if(typeof c!="object"||c===null)u[f]=c;else if(c.constructor!==Object&&(n=i.get(c.constructor)))u[f]=n(c,o);else if(ArrayBuffer.isView(c))u[f]=br(c);else{let h=e.indexOf(c);h!==-1?u[f]=r[h]:u[f]=o(c)}}return e.pop(),r.pop(),u}function a(l){if(typeof l!="object"||l===null)return l;if(Array.isArray(l))return s(l,a);if(l.constructor!==Object&&(n=i.get(l.constructor)))return n(l,a);let u={};e.push(l),r.push(u);for(let f in l){let c=l[f];if(typeof c!="object"||c===null)u[f]=c;else if(c.constructor!==Object&&(n=i.get(c.constructor)))u[f]=n(c,a);else if(ArrayBuffer.isView(c))u[f]=br(c);else{let h=e.indexOf(c);h!==-1?u[f]=r[h]:u[f]=a(c)}}return e.pop(),r.pop(),u}}});var pd=g((Lx,dd)=>{"use strict";dd.exports=hd()()});var _d=g(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.validateTopics=yr.validateTopic=void 0;function gd(t){let e=t.split("/");for(let r=0;r<e.length;r++)if(e[r]!=="+"){if(e[r]==="#")return r===e.length-1;if(e[r].indexOf("+")!==-1||e[r].indexOf("#")!==-1)return!1}return!0}yr.validateTopic=gd;function JS(t){if(t.length===0)return"empty_topic_list";for(let e=0;e<t.length;e++)if(!gd(t[e]))return t[e];return null}yr.validateTopics=JS});var Qo=g(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});var XS=ot(),ZS={objectMode:!0},eE={clean:!0},Ko=class{constructor(e){this.options=e||{},this.options=Object.assign(Object.assign({},eE),e),this._inflights=new Map}put(e,r){return this._inflights.set(e.messageId,e),r&&r(),this}createStream(){let e=new XS.Readable(ZS),r=[],i=!1,n=0;return this._inflights.forEach((s,o)=>{r.push(s)}),e._read=()=>{!i&&n<r.length?e.push(r[n++]):e.push(null)},e.destroy=s=>{if(!i)return i=!0,setTimeout(()=>{e.emit("close")},0),e},e}del(e,r){let i=this._inflights.get(e.messageId);return i?(this._inflights.delete(e.messageId),r(null,i)):r&&r(new Error("missing packet")),this}get(e,r){let i=this._inflights.get(e.messageId);return i?r(null,i):r&&r(new Error("missing packet")),this}close(e){this.options.clean&&(this._inflights=null),e&&e()}};Yo.default=Ko});var yd=g(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});var bd=[0,16,128,131,135,144,145,151,153],tE=(t,e,r)=>{t.log("handlePublish: packet %o",e),r=typeof r<"u"?r:t.noop;let i=e.topic.toString(),n=e.payload,{qos:s}=e,{messageId:o}=e,{options:a}=t;if(t.options.protocolVersion===5){let l;if(e.properties&&(l=e.properties.topicAlias),typeof l<"u")if(i.length===0)if(l>0&&l<=65535){let u=t.topicAliasRecv.getTopicByAlias(l);if(u)i=u,t.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",i,l);else{t.log("handlePublish :: unregistered topic alias. alias: %d",l),t.emit("error",new Error("Received unregistered Topic Alias"));return}}else{t.log("handlePublish :: topic alias out of range. alias: %d",l),t.emit("error",new Error("Received Topic Alias is out of range"));return}else if(t.topicAliasRecv.put(i,l))t.log("handlePublish :: registered topic: %s - alias: %d",i,l);else{t.log("handlePublish :: topic alias out of range. alias: %d",l),t.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(t.log("handlePublish: qos %d",s),s){case 2:{a.customHandleAcks(i,n,e,(l,u)=>{if(typeof l=="number"&&(u=l,l=null),l)return t.emit("error",l);if(bd.indexOf(u)===-1)return t.emit("error",new Error("Wrong reason code for pubrec"));u?t._sendPacket({cmd:"pubrec",messageId:o,reasonCode:u},r):t.incomingStore.put(e,()=>{t._sendPacket({cmd:"pubrec",messageId:o},r)})});break}case 1:{a.customHandleAcks(i,n,e,(l,u)=>{if(typeof l=="number"&&(u=l,l=null),l)return t.emit("error",l);if(bd.indexOf(u)===-1)return t.emit("error",new Error("Wrong reason code for puback"));u||t.emit("message",i,n,e),t.handleMessage(e,f=>{if(f)return r&&r(f);t._sendPacket({cmd:"puback",messageId:o,reasonCode:u},r)})});break}case 0:t.emit("message",i,n,e),t.handleMessage(e,r);break;default:t.log("handlePublish: unknown QoS. Doing nothing.");break}};Jo.default=tE});var md=g((Wx,rE)=>{rE.exports={name:"mqtt",description:"A library for the MQTT protocol",version:"5.10.3",contributors:["Adam Rudd <adamvrr@gmail.com>","Matteo Collina <matteo.collina@gmail.com> (https://github.com/mcollina)","Siarhei Buntsevich <scarry0506@gmail.com> (https://github.com/scarry1992)","Yoseph Maguire <yomaguir@microsoft.com> (https://github.com/YoDaMa)","Daniel Lando <daniel.sorridi@gmail.com> (https://github.com/robertsLando)"],keywords:["mqtt","publish/subscribe","publish","subscribe"],license:"MIT",repository:{type:"git",url:"git://github.com/mqttjs/MQTT.js.git"},main:"./build/index.js",module:"./dist/mqtt.esm.js",bin:{mqtt_pub:"./build/bin/pub.js",mqtt_sub:"./build/bin/sub.js",mqtt:"./build/bin/mqtt.js"},files:["dist/","CONTRIBUTING.md","LICENSE.md","help/","build/","src/"],exports:{".":{browser:{import:"./dist/mqtt.esm.js",default:"./dist/mqtt.min.js"},default:"./build/index.js"},"./package.json":"./package.json","./*.map":"./build/*.js.map","./dist/*":"./dist/*.js","./*":"./build/*.js"},types:"build/index.d.ts",typesVersions:{"*":{"*":["./build/index.d.ts"]}},scripts:{lint:"eslint --ext .ts .","lint-fix":"eslint --fix --ext .ts .","build:ts":"rimraf build/ && tsc -p tsconfig.build.json","build:browser":"node esbuild.js",build:"npm run build:ts && npm run build:browser",prepare:"npm run build","unit-test:node":"node -r esbuild-register --test-concurrency 4 --test-reporter=junit --test-reporter-destination=junit.xml --test-reporter=spec --test-reporter-destination=stdout --test test/node/*.ts ","unit-test:browser":"wtr","test:node":"node_modules/.bin/nyc npm run unit-test:node","test:browser":"npm run build && npm run unit-test:browser",test:"npm run test:node",changelog:"conventional-changelog -p angular -i CHANGELOG.md -s && git add CHANGELOG.md","changelog-init":"conventional-changelog -p angular -i CHANGELOG.md -s -r 0",release:"read -p 'GITHUB_TOKEN: ' GITHUB_TOKEN && export GITHUB_TOKEN=$GITHUB_TOKEN && release-it"},"release-it":{github:{release:!0},git:{tagName:"v${version}",commitMessage:"chore(release): ${version}"},hooks:{"before:init":["npm run test"]},npm:{publish:!0},plugins:{"@release-it/conventional-changelog":{preset:"angular",infile:"CHANGELOG.md"}}},publishConfig:{provenance:!0},"pre-commit":["lint"],engines:{node:">=16.0.0"},browser:{"./mqtt.js":"./dist/mqtt.js",fs:!1,tls:!1,net:!1},dependencies:{"@types/readable-stream":"^4.0.5","@types/ws":"^8.5.9",commist:"^3.2.0","concat-stream":"^2.0.0",debug:"^4.3.4","help-me":"^5.0.0","lru-cache":"^10.0.1",minimist:"^1.2.8","mqtt-packet":"^9.0.1","number-allocator":"^1.0.14","readable-stream":"^4.4.2",reinterval:"^1.1.0",rfdc:"^1.3.0",split2:"^4.2.0","worker-timers":"^7.1.4",ws:"^8.17.1"},devDependencies:{"@esm-bundle/chai":"^4.3.4-fix.0","@release-it/conventional-changelog":"^7.0.2","@types/chai":"^4.3.10","@types/node":"^20.9.0","@types/sinon":"^17.0.1","@types/tape":"^5.6.4","@typescript-eslint/eslint-plugin":"^6.10.0","@typescript-eslint/parser":"^6.10.0","@web/test-runner":"^0.18.0","@web/test-runner-playwright":"^0.11.0","aedes-cli":"^0.8.0",chai:"^4.3.10",chokidar:"^3.5.3","conventional-changelog-cli":"^4.1.0","end-of-stream":"^1.4.4",esbuild:"^0.19.5","esbuild-plugin-polyfill-node":"^0.3.0","esbuild-register":"^3.5.0",eslint:"^8.53.0","eslint-config-airbnb-base":"^15.0.0","eslint-config-airbnb-typescript":"^17.1.0","eslint-config-prettier":"^9.0.0","eslint-plugin-import":"^2.29.0","eslint-plugin-prettier":"^5.0.1",global:"^4.4.0","leaked-handles":"^5.2.0",mkdirp:"^3.0.1","mqtt-connection":"^4.1.0","mqtt-level-store":"^3.1.0",nyc:"^15.1.0","pre-commit":"^1.2.2",prettier:"^3.0.3","release-it":"^16.2.1",rimraf:"^5.0.5",should:"^13.2.3",sinon:"^17.0.1",snazzy:"^9.0.0",tape:"^5.7.2","ts-node":"^10.9.1",typescript:"^5.2.2"}}});var Rt=g(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.MQTTJS_VERSION=Me.nextTick=Me.applyMixin=Me.ErrorWithReasonCode=void 0;var Xo=class t extends Error{constructor(e,r){super(e),this.code=r,Object.setPrototypeOf(this,t.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};Me.ErrorWithReasonCode=Xo;function iE(t,e,r=!1){var i;let n=[e];for(;;){let s=n[0],o=Object.getPrototypeOf(s);if(o?.prototype)n.unshift(o);else break}for(let s of n)for(let o of Object.getOwnPropertyNames(s.prototype))(r||o!=="constructor")&&Object.defineProperty(t.prototype,o,(i=Object.getOwnPropertyDescriptor(s.prototype,o))!==null&&i!==void 0?i:Object.create(null))}Me.applyMixin=iE;Me.nextTick=typeof(process==null?void 0:process.nextTick)=="function"?process.nextTick:t=>{setTimeout(t,0)};Me.MQTTJS_VERSION=md().version});var ei=g(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.ReasonCodes=void 0;var wd=Rt();ct.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};var nE=(t,e)=>{let{messageId:r}=e,i=e.cmd,n=null,s=t.outgoing[r]?t.outgoing[r].cb:null,o=null;if(!s){t.log("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(t.log("_handleAck :: packet type",i),i){case"pubcomp":case"puback":{let a=e.reasonCode;a&&a>0&&a!==16?(o=new wd.ErrorWithReasonCode(`Publish error: ${ct.ReasonCodes[a]}`,a),t._removeOutgoingAndStoreMessage(r,()=>{s(o,e)})):t._removeOutgoingAndStoreMessage(r,s);break}case"pubrec":{n={cmd:"pubrel",qos:2,messageId:r};let a=e.reasonCode;a&&a>0&&a!==16?(o=new wd.ErrorWithReasonCode(`Publish error: ${ct.ReasonCodes[a]}`,a),t._removeOutgoingAndStoreMessage(r,()=>{s(o,e)})):t._sendPacket(n);break}case"suback":{delete t.outgoing[r],t.messageIdProvider.deallocate(r);let a=e.granted;for(let l=0;l<a.length;l++){let u=a[l];if(u&128){o=new Error(`Subscribe error: ${ct.ReasonCodes[u]}`),o.code=u;let f=t.messageIdToTopic[r];f&&f.forEach(c=>{delete t._resubscribeTopics[c]})}}delete t.messageIdToTopic[r],t._invokeStoreProcessingQueue(),s(o,e);break}case"unsuback":{delete t.outgoing[r],t.messageIdProvider.deallocate(r),t._invokeStoreProcessingQueue(),s(null,e);break}default:t.emit("error",new Error("unrecognized packet type"))}t.disconnecting&&Object.keys(t.outgoing).length===0&&t.emit("outgoingEmpty")};ct.default=nE});var Ed=g(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});var Sd=Rt(),sE=ei(),oE=(t,e)=>{let{options:r}=t,i=r.protocolVersion,n=i===5?e.reasonCode:e.returnCode;if(i!==5){let s=new Sd.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${i}`,n);t.emit("error",s);return}t.handleAuth(e,(s,o)=>{if(s){t.emit("error",s);return}if(n===24)t.reconnecting=!1,t._sendPacket(o);else{let a=new Sd.ErrorWithReasonCode(`Connection refused: ${sE.ReasonCodes[n]}`,n);t.emit("error",a)}})};Zo.default=oE});var Id=g(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.LRUCache=void 0;var mr=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Td=new Set,ea=typeof process=="object"&&process?process:{},Ad=(t,e,r,i)=>{typeof ea.emitWarning=="function"?ea.emitWarning(t,e,r,i):console.error(`[${r}] ${e}: ${t}`)},dn=globalThis.AbortController,vd=globalThis.AbortSignal;if(typeof dn>"u"){vd=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,n){this._onabort.push(n)}},dn=class{constructor(){e()}signal=new vd;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(let n of this.signal._onabort)n(i);this.signal.onabort?.(i)}}};let t=ea.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",e=()=>{t&&(t=!1,Ad("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}var aE=t=>!Td.has(t),zx=Symbol("type"),ft=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),xd=t=>ft(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?wr:null:null,wr=class extends Array{constructor(e){super(e),this.fill(0)}},ta=class t{heap;length;static#l=!1;static create(e){let r=xd(e);if(!r)return[];t.#l=!0;let i=new t(e,r);return t.#l=!1,i}constructor(e,r){if(!t.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new r(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},ra=class t{#l;#f;#g;#_;#C;#R;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#b;#i;#r;#e;#u;#h;#a;#s;#y;#o;#m;#w;#d;#S;#x;#c;static unsafeExposeInternals(e){return{starts:e.#w,ttls:e.#d,sizes:e.#m,keyMap:e.#i,keyList:e.#r,valList:e.#e,next:e.#u,prev:e.#h,get head(){return e.#a},get tail(){return e.#s},free:e.#y,isBackgroundFetch:r=>e.#t(r),backgroundFetch:(r,i,n,s)=>e.#B(r,i,n,s),moveToTail:r=>e.#P(r),indexes:r=>e.#E(r),rindexes:r=>e.#v(r),isStale:r=>e.#p(r)}}get max(){return this.#l}get maxSize(){return this.#f}get calculatedSize(){return this.#b}get size(){return this.#n}get fetchMethod(){return this.#C}get memoMethod(){return this.#R}get dispose(){return this.#g}get disposeAfter(){return this.#_}constructor(e){let{max:r=0,ttl:i,ttlResolution:n=1,ttlAutopurge:s,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:l,dispose:u,disposeAfter:f,noDisposeOnSet:c,noUpdateTTL:h,maxSize:d=0,maxEntrySize:_=0,sizeCalculation:p,fetchMethod:y,memoMethod:b,noDeleteOnFetchRejection:m,noDeleteOnStaleGet:A,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:I,ignoreFetchAbort:N}=e;if(r!==0&&!ft(r))throw new TypeError("max option must be a nonnegative integer");let M=r?xd(r):Array;if(!M)throw new Error("invalid max value: "+r);if(this.#l=r,this.#f=d,this.maxEntrySize=_||this.#f,this.sizeCalculation=p,this.sizeCalculation){if(!this.#f&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(b!==void 0&&typeof b!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#R=b,y!==void 0&&typeof y!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#C=y,this.#x=!!y,this.#i=new Map,this.#r=new Array(r).fill(void 0),this.#e=new Array(r).fill(void 0),this.#u=new M(r),this.#h=new M(r),this.#a=0,this.#s=0,this.#y=ta.create(r),this.#n=0,this.#b=0,typeof u=="function"&&(this.#g=u),typeof f=="function"?(this.#_=f,this.#o=[]):(this.#_=void 0,this.#o=void 0),this.#S=!!this.#g,this.#c=!!this.#_,this.noDisposeOnSet=!!c,this.noUpdateTTL=!!h,this.noDeleteOnFetchRejection=!!m,this.allowStaleOnFetchRejection=!!S,this.allowStaleOnFetchAbort=!!I,this.ignoreFetchAbort=!!N,this.maxEntrySize!==0){if(this.#f!==0&&!ft(this.#f))throw new TypeError("maxSize must be a positive integer if specified");if(!ft(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#W()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!A,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=ft(n)||n===0?n:1,this.ttlAutopurge=!!s,this.ttl=i||0,this.ttl){if(!ft(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#q()}if(this.#l===0&&this.ttl===0&&this.#f===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#f){let F="LRU_CACHE_UNBOUNDED";aE(F)&&(Td.add(F),Ad("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",F,t))}}getRemainingTTL(e){return this.#i.has(e)?1/0:0}#q(){let e=new wr(this.#l),r=new wr(this.#l);this.#d=e,this.#w=r,this.#N=(s,o,a=mr.now())=>{if(r[s]=o!==0?a:0,e[s]=o,o!==0&&this.ttlAutopurge){let l=setTimeout(()=>{this.#p(s)&&this.#T(this.#r[s],"expire")},o+1);l.unref&&l.unref()}},this.#I=s=>{r[s]=e[s]!==0?mr.now():0},this.#A=(s,o)=>{if(e[o]){let a=e[o],l=r[o];if(!a||!l)return;s.ttl=a,s.start=l,s.now=i||n();let u=s.now-l;s.remainingTTL=a-u}};let i=0,n=()=>{let s=mr.now();if(this.ttlResolution>0){i=s;let o=setTimeout(()=>i=0,this.ttlResolution);o.unref&&o.unref()}return s};this.getRemainingTTL=s=>{let o=this.#i.get(s);if(o===void 0)return 0;let a=e[o],l=r[o];if(!a||!l)return 1/0;let u=(i||n())-l;return a-u},this.#p=s=>{let o=r[s],a=e[s];return!!a&&!!o&&(i||n())-o>a}}#I=()=>{};#A=()=>{};#N=()=>{};#p=()=>!1;#W(){let e=new wr(this.#l);this.#b=0,this.#m=e,this.#O=r=>{this.#b-=e[r],e[r]=0},this.#L=(r,i,n,s)=>{if(this.#t(i))return 0;if(!ft(n))if(s){if(typeof s!="function")throw new TypeError("sizeCalculation must be a function");if(n=s(i,r),!ft(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n},this.#k=(r,i,n)=>{if(e[r]=i,this.#f){let s=this.#f-e[r];for(;this.#b>s;)this.#M(!0)}this.#b+=e[r],n&&(n.entrySize=i,n.totalCalculatedSize=this.#b)}}#O=e=>{};#k=(e,r,i)=>{};#L=(e,r,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#E({allowStale:e=this.allowStale}={}){if(this.#n)for(let r=this.#s;!(!this.#j(r)||((e||!this.#p(r))&&(yield r),r===this.#a));)r=this.#h[r]}*#v({allowStale:e=this.allowStale}={}){if(this.#n)for(let r=this.#a;!(!this.#j(r)||((e||!this.#p(r))&&(yield r),r===this.#s));)r=this.#u[r]}#j(e){return e!==void 0&&this.#i.get(this.#r[e])===e}*entries(){for(let e of this.#E())this.#e[e]!==void 0&&this.#r[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#r[e],this.#e[e]])}*rentries(){for(let e of this.#v())this.#e[e]!==void 0&&this.#r[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#r[e],this.#e[e]])}*keys(){for(let e of this.#E()){let r=this.#r[e];r!==void 0&&!this.#t(this.#e[e])&&(yield r)}}*rkeys(){for(let e of this.#v()){let r=this.#r[e];r!==void 0&&!this.#t(this.#e[e])&&(yield r)}}*values(){for(let e of this.#E())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(let e of this.#v())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,r={}){for(let i of this.#E()){let n=this.#e[i],s=this.#t(n)?n.__staleWhileFetching:n;if(s!==void 0&&e(s,this.#r[i],this))return this.get(this.#r[i],r)}}forEach(e,r=this){for(let i of this.#E()){let n=this.#e[i],s=this.#t(n)?n.__staleWhileFetching:n;s!==void 0&&e.call(r,s,this.#r[i],this)}}rforEach(e,r=this){for(let i of this.#v()){let n=this.#e[i],s=this.#t(n)?n.__staleWhileFetching:n;s!==void 0&&e.call(r,s,this.#r[i],this)}}purgeStale(){let e=!1;for(let r of this.#v({allowStale:!0}))this.#p(r)&&(this.#T(this.#r[r],"expire"),e=!0);return e}info(e){let r=this.#i.get(e);if(r===void 0)return;let i=this.#e[r],n=this.#t(i)?i.__staleWhileFetching:i;if(n===void 0)return;let s={value:n};if(this.#d&&this.#w){let o=this.#d[r],a=this.#w[r];if(o&&a){let l=o-(mr.now()-a);s.ttl=l,s.start=Date.now()}}return this.#m&&(s.size=this.#m[r]),s}dump(){let e=[];for(let r of this.#E({allowStale:!0})){let i=this.#r[r],n=this.#e[r],s=this.#t(n)?n.__staleWhileFetching:n;if(s===void 0||i===void 0)continue;let o={value:s};if(this.#d&&this.#w){o.ttl=this.#d[r];let a=mr.now()-this.#w[r];o.start=Math.floor(Date.now()-a)}this.#m&&(o.size=this.#m[r]),e.unshift([i,o])}return e}load(e){this.clear();for(let[r,i]of e){if(i.start){let n=Date.now()-i.start;i.start=mr.now()-n}this.set(r,i.value,i)}}set(e,r,i={}){if(r===void 0)return this.delete(e),this;let{ttl:n=this.ttl,start:s,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:l}=i,{noUpdateTTL:u=this.noUpdateTTL}=i,f=this.#L(e,r,i.size||0,a);if(this.maxEntrySize&&f>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.#T(e,"set"),this;let c=this.#n===0?void 0:this.#i.get(e);if(c===void 0)c=this.#n===0?this.#s:this.#y.length!==0?this.#y.pop():this.#n===this.#l?this.#M(!1):this.#n,this.#r[c]=e,this.#e[c]=r,this.#i.set(e,c),this.#u[this.#s]=c,this.#h[c]=this.#s,this.#s=c,this.#n++,this.#k(c,f,l),l&&(l.set="add"),u=!1;else{this.#P(c);let h=this.#e[c];if(r!==h){if(this.#x&&this.#t(h)){h.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:d}=h;d!==void 0&&!o&&(this.#S&&this.#g?.(d,e,"set"),this.#c&&this.#o?.push([d,e,"set"]))}else o||(this.#S&&this.#g?.(h,e,"set"),this.#c&&this.#o?.push([h,e,"set"]));if(this.#O(c),this.#k(c,f,l),this.#e[c]=r,l){l.set="replace";let d=h&&this.#t(h)?h.__staleWhileFetching:h;d!==void 0&&(l.oldValue=d)}}else l&&(l.set="update")}if(n!==0&&!this.#d&&this.#q(),this.#d&&(u||this.#N(c,n,s),l&&this.#A(l,c)),!o&&this.#c&&this.#o){let h=this.#o,d;for(;d=h?.shift();)this.#_?.(...d)}return this}pop(){try{for(;this.#n;){let e=this.#e[this.#a];if(this.#M(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#c&&this.#o){let e=this.#o,r;for(;r=e?.shift();)this.#_?.(...r)}}}#M(e){let r=this.#a,i=this.#r[r],n=this.#e[r];return this.#x&&this.#t(n)?n.__abortController.abort(new Error("evicted")):(this.#S||this.#c)&&(this.#S&&this.#g?.(n,i,"evict"),this.#c&&this.#o?.push([n,i,"evict"])),this.#O(r),e&&(this.#r[r]=void 0,this.#e[r]=void 0,this.#y.push(r)),this.#n===1?(this.#a=this.#s=0,this.#y.length=0):this.#a=this.#u[r],this.#i.delete(i),this.#n--,r}has(e,r={}){let{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=r,s=this.#i.get(e);if(s!==void 0){let o=this.#e[s];if(this.#t(o)&&o.__staleWhileFetching===void 0)return!1;if(this.#p(s))n&&(n.has="stale",this.#A(n,s));else return i&&this.#I(s),n&&(n.has="hit",this.#A(n,s)),!0}else n&&(n.has="miss");return!1}peek(e,r={}){let{allowStale:i=this.allowStale}=r,n=this.#i.get(e);if(n===void 0||!i&&this.#p(n))return;let s=this.#e[n];return this.#t(s)?s.__staleWhileFetching:s}#B(e,r,i,n){let s=r===void 0?void 0:this.#e[r];if(this.#t(s))return s;let o=new dn,{signal:a}=i;a?.addEventListener("abort",()=>o.abort(a.reason),{signal:o.signal});let l={signal:o.signal,options:i,context:n},u=(p,y=!1)=>{let{aborted:b}=o.signal,m=i.ignoreFetchAbort&&p!==void 0;if(i.status&&(b&&!y?(i.status.fetchAborted=!0,i.status.fetchError=o.signal.reason,m&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),b&&!m&&!y)return c(o.signal.reason);let A=d;return this.#e[r]===d&&(p===void 0?A.__staleWhileFetching?this.#e[r]=A.__staleWhileFetching:this.#T(e,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(e,p,l.options))),p},f=p=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=p),c(p)),c=p=>{let{aborted:y}=o.signal,b=y&&i.allowStaleOnFetchAbort,m=b||i.allowStaleOnFetchRejection,A=m||i.noDeleteOnFetchRejection,S=d;if(this.#e[r]===d&&(!A||S.__staleWhileFetching===void 0?this.#T(e,"fetch"):b||(this.#e[r]=S.__staleWhileFetching)),m)return i.status&&S.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),S.__staleWhileFetching;if(S.__returned===S)throw p},h=(p,y)=>{let b=this.#C?.(e,s,l);b&&b instanceof Promise&&b.then(m=>p(m===void 0?void 0:m),y),o.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(p(void 0),i.allowStaleOnFetchAbort&&(p=m=>u(m,!0)))})};i.status&&(i.status.fetchDispatched=!0);let d=new Promise(h).then(u,f),_=Object.assign(d,{__abortController:o,__staleWhileFetching:s,__returned:void 0});return r===void 0?(this.set(e,_,{...l.options,status:void 0}),r=this.#i.get(e)):this.#e[r]=_,_}#t(e){if(!this.#x)return!1;let r=e;return!!r&&r instanceof Promise&&r.hasOwnProperty("__staleWhileFetching")&&r.__abortController instanceof dn}async fetch(e,r={}){let{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:u=this.sizeCalculation,noUpdateTTL:f=this.noUpdateTTL,noDeleteOnFetchRejection:c=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:h=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:_=this.allowStaleOnFetchAbort,context:p,forceRefresh:y=!1,status:b,signal:m}=r;if(!this.#x)return b&&(b.fetch="get"),this.get(e,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:s,status:b});let A={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:s,ttl:o,noDisposeOnSet:a,size:l,sizeCalculation:u,noUpdateTTL:f,noDeleteOnFetchRejection:c,allowStaleOnFetchRejection:h,allowStaleOnFetchAbort:_,ignoreFetchAbort:d,status:b,signal:m},S=this.#i.get(e);if(S===void 0){b&&(b.fetch="miss");let I=this.#B(e,S,A,p);return I.__returned=I}else{let I=this.#e[S];if(this.#t(I)){let Q=i&&I.__staleWhileFetching!==void 0;return b&&(b.fetch="inflight",Q&&(b.returnedStale=!0)),Q?I.__staleWhileFetching:I.__returned=I}let N=this.#p(S);if(!y&&!N)return b&&(b.fetch="hit"),this.#P(S),n&&this.#I(S),b&&this.#A(b,S),I;let M=this.#B(e,S,A,p),B=M.__staleWhileFetching!==void 0&&i;return b&&(b.fetch=N?"stale":"refresh",B&&N&&(b.returnedStale=!0)),B?M.__staleWhileFetching:M.__returned=M}}async forceFetch(e,r={}){let i=await this.fetch(e,r);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(e,r={}){let i=this.#R;if(!i)throw new Error("no memoMethod provided to constructor");let{context:n,forceRefresh:s,...o}=r,a=this.get(e,o);if(!s&&a!==void 0)return a;let l=i(e,a,{options:o,context:n});return this.set(e,l,o),l}get(e,r={}){let{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:o}=r,a=this.#i.get(e);if(a!==void 0){let l=this.#e[a],u=this.#t(l);return o&&this.#A(o,a),this.#p(a)?(o&&(o.get="stale"),u?(o&&i&&l.__staleWhileFetching!==void 0&&(o.returnedStale=!0),i?l.__staleWhileFetching:void 0):(s||this.#T(e,"expire"),o&&i&&(o.returnedStale=!0),i?l:void 0)):(o&&(o.get="hit"),u?l.__staleWhileFetching:(this.#P(a),n&&this.#I(a),l))}else o&&(o.get="miss")}#D(e,r){this.#h[r]=e,this.#u[e]=r}#P(e){e!==this.#s&&(e===this.#a?this.#a=this.#u[e]:this.#D(this.#h[e],this.#u[e]),this.#D(this.#s,e),this.#s=e)}delete(e){return this.#T(e,"delete")}#T(e,r){let i=!1;if(this.#n!==0){let n=this.#i.get(e);if(n!==void 0)if(i=!0,this.#n===1)this.#U(r);else{this.#O(n);let s=this.#e[n];if(this.#t(s)?s.__abortController.abort(new Error("deleted")):(this.#S||this.#c)&&(this.#S&&this.#g?.(s,e,r),this.#c&&this.#o?.push([s,e,r])),this.#i.delete(e),this.#r[n]=void 0,this.#e[n]=void 0,n===this.#s)this.#s=this.#h[n];else if(n===this.#a)this.#a=this.#u[n];else{let o=this.#h[n];this.#u[o]=this.#u[n];let a=this.#u[n];this.#h[a]=this.#h[n]}this.#n--,this.#y.push(n)}}if(this.#c&&this.#o?.length){let n=this.#o,s;for(;s=n?.shift();)this.#_?.(...s)}return i}clear(){return this.#U("delete")}#U(e){for(let r of this.#v({allowStale:!0})){let i=this.#e[r];if(this.#t(i))i.__abortController.abort(new Error("deleted"));else{let n=this.#r[r];this.#S&&this.#g?.(i,n,e),this.#c&&this.#o?.push([i,n,e])}}if(this.#i.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#d&&this.#w&&(this.#d.fill(0),this.#w.fill(0)),this.#m&&this.#m.fill(0),this.#a=0,this.#s=0,this.#y.length=0,this.#b=0,this.#n=0,this.#c&&this.#o){let r=this.#o,i;for(;i=r?.shift();)this.#_?.(...i)}}};pn.LRUCache=ra});var Be=g(ht=>{"use strict";Object.defineProperty(ht,"t",{value:!0});ht.ContainerIterator=ht.Container=ht.Base=void 0;var ia=class{constructor(e=0){this.iteratorType=e}equals(e){return this.o===e.o}};ht.ContainerIterator=ia;var gn=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return this.i===0}};ht.Base=gn;var na=class extends gn{};ht.Container=na});var Od=g(_n=>{"use strict";Object.defineProperty(_n,"t",{value:!0});_n.default=void 0;var lE=Be(),sa=class extends lE.Base{constructor(e=[]){super(),this.S=[];let r=this;e.forEach(function(i){r.push(i)})}clear(){this.i=0,this.S=[]}push(e){return this.S.push(e),this.i+=1,this.i}pop(){if(this.i!==0)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}},uE=sa;_n.default=uE});var Pd=g(bn=>{"use strict";Object.defineProperty(bn,"t",{value:!0});bn.default=void 0;var cE=Be(),oa=class extends cE.Base{constructor(e=[]){super(),this.j=0,this.q=[];let r=this;e.forEach(function(i){r.push(i)})}clear(){this.q=[],this.i=this.j=0}push(e){let r=this.q.length;if(this.j/r>.5&&this.j+this.i>=r&&r>4096){let i=this.i;for(let n=0;n<i;++n)this.q[n]=this.q[this.j+n];this.j=0,this.q[this.i]=e}else this.q[this.j+this.i]=e;return++this.i}pop(){if(this.i===0)return;let e=this.q[this.j++];return this.i-=1,e}front(){if(this.i!==0)return this.q[this.j]}},fE=oa;bn.default=fE});var Cd=g(yn=>{"use strict";Object.defineProperty(yn,"t",{value:!0});yn.default=void 0;var hE=Be(),aa=class extends hE.Base{constructor(e=[],r=function(n,s){return n>s?-1:n<s?1:0},i=!0){if(super(),this.v=r,Array.isArray(e))this.C=i?[...e]:e;else{this.C=[];let s=this;e.forEach(function(o){s.C.push(o)})}this.i=this.C.length;let n=this.i>>1;for(let s=this.i-1>>1;s>=0;--s)this.k(s,n)}m(e){let r=this.C[e];for(;e>0;){let i=e-1>>1,n=this.C[i];if(this.v(n,r)<=0)break;this.C[e]=n,e=i}this.C[e]=r}k(e,r){let i=this.C[e];for(;e<r;){let n=e<<1|1,s=n+1,o=this.C[n];if(s<this.i&&this.v(o,this.C[s])>0&&(n=s,o=this.C[s]),this.v(o,i)>=0)break;this.C[e]=o,e=n}this.C[e]=i}clear(){this.i=0,this.C.length=0}push(e){this.C.push(e),this.m(this.i),this.i+=1}pop(){if(this.i===0)return;let e=this.C[0],r=this.C.pop();return this.i-=1,this.i&&(this.C[0]=r,this.k(0,this.i>>1)),e}top(){return this.C[0]}find(e){return this.C.indexOf(e)>=0}remove(e){let r=this.C.indexOf(e);return r<0?!1:(r===0?this.pop():r===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(r,1,this.C.pop()),this.i-=1,this.m(r),this.k(r,this.i>>1)),!0)}updateItem(e){let r=this.C.indexOf(e);return r<0?!1:(this.m(r),this.k(r,this.i>>1),!0)}toArray(){return[...this.C]}},dE=aa;yn.default=dE});var wn=g(mn=>{"use strict";Object.defineProperty(mn,"t",{value:!0});mn.default=void 0;var pE=Be(),la=class extends pE.Container{},gE=la;mn.default=gE});var qe=g(ua=>{"use strict";Object.defineProperty(ua,"t",{value:!0});ua.throwIteratorAccessError=_E;function _E(){throw new RangeError("Iterator access denied!")}});var fa=g(En=>{"use strict";Object.defineProperty(En,"t",{value:!0});En.RandomIterator=void 0;var bE=Be(),Sn=qe(),ca=class extends bE.ContainerIterator{constructor(e,r){super(r),this.o=e,this.iteratorType===0?(this.pre=function(){return this.o===0&&(0,Sn.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,Sn.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,Sn.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return this.o===-1&&(0,Sn.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(e){this.container.setElementByPos(this.o,e)}};En.RandomIterator=ca});var Rd=g(vn=>{"use strict";Object.defineProperty(vn,"t",{value:!0});vn.default=void 0;var yE=wE(wn()),mE=fa();function wE(t){return t&&t.t?t:{default:t}}var kt=class t extends mE.RandomIterator{constructor(e,r,i){super(e,i),this.container=r}copy(){return new t(this.o,this.container,this.iteratorType)}},ha=class extends yE.default{constructor(e=[],r=!0){if(super(),Array.isArray(e))this.J=r?[...e]:e,this.i=e.length;else{this.J=[];let i=this;e.forEach(function(n){i.pushBack(n)})}}clear(){this.i=0,this.J.length=0}begin(){return new kt(0,this)}end(){return new kt(this.i,this)}rBegin(){return new kt(this.i-1,this,1)}rEnd(){return new kt(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;return this.J[e]}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;return this.J.splice(e,1),this.i-=1,this.i}eraseElementByValue(e){let r=0;for(let i=0;i<this.i;++i)this.J[i]!==e&&(this.J[r++]=this.J[i]);return this.i=this.J.length=r,this.i}eraseElementByIterator(e){let r=e.o;return e=e.next(),this.eraseElementByPos(r),e}pushBack(e){return this.J.push(e),this.i+=1,this.i}popBack(){if(this.i!==0)return this.i-=1,this.J.pop()}setElementByPos(e,r){if(e<0||e>this.i-1)throw new RangeError;this.J[e]=r}insert(e,r,i=1){if(e<0||e>this.i)throw new RangeError;return this.J.splice(e,0,...new Array(i).fill(r)),this.i+=i,this.i}find(e){for(let r=0;r<this.i;++r)if(this.J[r]===e)return new kt(r,this);return this.end()}reverse(){this.J.reverse()}unique(){let e=1;for(let r=1;r<this.i;++r)this.J[r]!==this.J[r-1]&&(this.J[e++]=this.J[r]);return this.i=this.J.length=e,this.i}sort(e){this.J.sort(e)}forEach(e){for(let r=0;r<this.i;++r)e(this.J[r],r,this)}[Symbol.iterator](){return function*(){yield*this.J}.bind(this)()}},SE=ha;vn.default=SE});var kd=g(Tn=>{"use strict";Object.defineProperty(Tn,"t",{value:!0});Tn.default=void 0;var EE=TE(wn()),vE=Be(),Mt=qe();function TE(t){return t&&t.t?t:{default:t}}var Bt=class t extends vE.ContainerIterator{constructor(e,r,i,n){super(n),this.o=e,this.h=r,this.container=i,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,Mt.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,Mt.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,Mt.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,Mt.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,Mt.throwIteratorAccessError)(),this.o.l}set pointer(e){this.o===this.h&&(0,Mt.throwIteratorAccessError)(),this.o.l=e}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},da=class extends EE.default{constructor(e=[]){super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let r=this;e.forEach(function(i){r.pushBack(i)})}V(e){let{L:r,B:i}=e;r.B=i,i.L=r,e===this.p&&(this.p=i),e===this._&&(this._=r),this.i-=1}G(e,r){let i=r.B,n={l:e,L:r,B:i};r.B=n,i.L=n,r===this.h&&(this.p=n),i===this.h&&(this._=n),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new Bt(this.p,this.h,this)}end(){return new Bt(this.h,this.h,this)}rBegin(){return new Bt(this._,this.h,this,1)}rEnd(){return new Bt(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let r=this.p;for(;e--;)r=r.B;return r.l}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let r=this.p;for(;e--;)r=r.B;return this.V(r),this.i}eraseElementByValue(e){let r=this.p;for(;r!==this.h;)r.l===e&&this.V(r),r=r.B;return this.i}eraseElementByIterator(e){let r=e.o;return r===this.h&&(0,Mt.throwIteratorAccessError)(),e=e.next(),this.V(r),e}pushBack(e){return this.G(e,this._),this.i}popBack(){if(this.i===0)return;let e=this._.l;return this.V(this._),e}pushFront(e){return this.G(e,this.h),this.i}popFront(){if(this.i===0)return;let e=this.p.l;return this.V(this.p),e}setElementByPos(e,r){if(e<0||e>this.i-1)throw new RangeError;let i=this.p;for(;e--;)i=i.B;i.l=r}insert(e,r,i=1){if(e<0||e>this.i)throw new RangeError;if(i<=0)return this.i;if(e===0)for(;i--;)this.pushFront(r);else if(e===this.i)for(;i--;)this.pushBack(r);else{let n=this.p;for(let o=1;o<e;++o)n=n.B;let s=n.B;for(this.i+=i;i--;)n.B={l:r,L:n},n.B.L=n,n=n.B;n.B=s,s.L=n}return this.i}find(e){let r=this.p;for(;r!==this.h;){if(r.l===e)return new Bt(r,this.h,this);r=r.B}return this.end()}reverse(){if(this.i<=1)return;let e=this.p,r=this._,i=0;for(;i<<1<this.i;){let n=e.l;e.l=r.l,r.l=n,e=e.B,r=r.L,i+=1}}unique(){if(this.i<=1)return this.i;let e=this.p;for(;e!==this.h;){let r=e;for(;r.B!==this.h&&r.l===r.B.l;)r=r.B,this.i-=1;e.B=r.B,e.B.L=e,e=e.B}return this.i}sort(e){if(this.i<=1)return;let r=[];this.forEach(function(n){r.push(n)}),r.sort(e);let i=this.p;r.forEach(function(n){i.l=n,i=i.B})}merge(e){let r=this;if(this.i===0)e.forEach(function(i){r.pushBack(i)});else{let i=this.p;e.forEach(function(n){for(;i!==r.h&&i.l<=n;)i=i.B;r.G(n,i.L)})}return this.i}forEach(e){let r=this.p,i=0;for(;r!==this.h;)e(r.l,i++,this),r=r.B}[Symbol.iterator](){return function*(){if(this.i===0)return;let e=this.p;for(;e!==this.h;)yield e.l,e=e.B}.bind(this)()}},AE=da;Tn.default=AE});var Md=g(An=>{"use strict";Object.defineProperty(An,"t",{value:!0});An.default=void 0;var xE=OE(wn()),IE=fa();function OE(t){return t&&t.t?t:{default:t}}var qt=class t extends IE.RandomIterator{constructor(e,r,i){super(e,i),this.container=r}copy(){return new t(this.o,this.container,this.iteratorType)}},pa=class extends xE.default{constructor(e=[],r=4096){super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let i=(()=>{if(typeof e.length=="number")return e.length;if(typeof e.size=="number")return e.size;if(typeof e.size=="function")return e.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=r,this.P=Math.max(Math.ceil(i/this.F),1);for(let o=0;o<this.P;++o)this.A.push(new Array(this.F));let n=Math.ceil(i/this.F);this.j=this.R=(this.P>>1)-(n>>1),this.D=this.N=this.F-i%this.F>>1;let s=this;e.forEach(function(o){s.pushBack(o)})}T(){let e=[],r=Math.max(this.P>>1,1);for(let i=0;i<r;++i)e[i]=new Array(this.F);for(let i=this.j;i<this.P;++i)e[e.length]=this.A[i];for(let i=0;i<this.R;++i)e[e.length]=this.A[i];e[e.length]=[...this.A[this.R]],this.j=r,this.R=e.length-1;for(let i=0;i<r;++i)e[e.length]=new Array(this.F);this.A=e,this.P=e.length}O(e){let r=this.D+e+1,i=r%this.F,n=i-1,s=this.j+(r-i)/this.F;return i===0&&(s-=1),s%=this.P,n<0&&(n+=this.F),{curNodeBucketIndex:s,curNodePointerIndex:n}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new qt(0,this)}end(){return new qt(this.i,this)}rBegin(){return new qt(this.i-1,this,1)}rEnd(){return new qt(-1,this,1)}front(){if(this.i!==0)return this.A[this.j][this.D]}back(){if(this.i!==0)return this.A[this.R][this.N]}pushBack(e){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=e,this.i}popBack(){if(this.i===0)return;let e=this.A[this.R][this.N];return this.i!==1&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,e}pushFront(e){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=e,this.i}popFront(){if(this.i===0)return;let e=this.A[this.j][this.D];return this.i!==1&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,e}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let{curNodeBucketIndex:r,curNodePointerIndex:i}=this.O(e);return this.A[r][i]}setElementByPos(e,r){if(e<0||e>this.i-1)throw new RangeError;let{curNodeBucketIndex:i,curNodePointerIndex:n}=this.O(e);this.A[i][n]=r}insert(e,r,i=1){if(e<0||e>this.i)throw new RangeError;if(e===0)for(;i--;)this.pushFront(r);else if(e===this.i)for(;i--;)this.pushBack(r);else{let n=[];for(let s=e;s<this.i;++s)n.push(this.getElementByPos(s));this.cut(e-1);for(let s=0;s<i;++s)this.pushBack(r);for(let s=0;s<n.length;++s)this.pushBack(n[s])}return this.i}cut(e){if(e<0)return this.clear(),0;let{curNodeBucketIndex:r,curNodePointerIndex:i}=this.O(e);return this.R=r,this.N=i,this.i=e+1,this.i}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;if(e===0)this.popFront();else if(e===this.i-1)this.popBack();else{let r=[];for(let n=e+1;n<this.i;++n)r.push(this.getElementByPos(n));this.cut(e),this.popBack();let i=this;r.forEach(function(n){i.pushBack(n)})}return this.i}eraseElementByValue(e){if(this.i===0)return 0;let r=[];for(let n=0;n<this.i;++n){let s=this.getElementByPos(n);s!==e&&r.push(s)}let i=r.length;for(let n=0;n<i;++n)this.setElementByPos(n,r[n]);return this.cut(i-1)}eraseElementByIterator(e){let r=e.o;return this.eraseElementByPos(r),e=e.next(),e}find(e){for(let r=0;r<this.i;++r)if(this.getElementByPos(r)===e)return new qt(r,this);return this.end()}reverse(){let e=0,r=this.i-1;for(;e<r;){let i=this.getElementByPos(e);this.setElementByPos(e,this.getElementByPos(r)),this.setElementByPos(r,i),e+=1,r-=1}}unique(){if(this.i<=1)return this.i;let e=1,r=this.getElementByPos(0);for(let i=1;i<this.i;++i){let n=this.getElementByPos(i);n!==r&&(r=n,this.setElementByPos(e++,n))}for(;this.i>e;)this.popBack();return this.i}sort(e){let r=[];for(let i=0;i<this.i;++i)r.push(this.getElementByPos(i));r.sort(e);for(let i=0;i<this.i;++i)this.setElementByPos(i,r[i])}shrinkToFit(){if(this.i===0)return;let e=[];this.forEach(function(r){e.push(r)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let r=0;r<this.P;++r)this.A.push(new Array(this.F));for(let r=0;r<e.length;++r)this.pushBack(e[r])}forEach(e){for(let r=0;r<this.i;++r)e(this.getElementByPos(r),r,this)}[Symbol.iterator](){return function*(){for(let e=0;e<this.i;++e)yield this.getElementByPos(e)}.bind(this)()}},PE=pa;An.default=PE});var Bd=g(Sr=>{"use strict";Object.defineProperty(Sr,"t",{value:!0});Sr.TreeNodeEnableIndex=Sr.TreeNode=void 0;var xn=class{constructor(e,r){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=e,this.l=r}L(){let e=this;if(e.ee===1&&e.tt.tt===e)e=e.W;else if(e.U)for(e=e.U;e.W;)e=e.W;else{let r=e.tt;for(;r.U===e;)e=r,r=e.tt;e=r}return e}B(){let e=this;if(e.W){for(e=e.W;e.U;)e=e.U;return e}else{let r=e.tt;for(;r.W===e;)e=r,r=e.tt;return e.W!==r?r:e}}te(){let e=this.tt,r=this.W,i=r.U;return e.tt===this?e.tt=r:e.U===this?e.U=r:e.W=r,r.tt=e,r.U=this,this.tt=r,this.W=i,i&&(i.tt=this),r}se(){let e=this.tt,r=this.U,i=r.W;return e.tt===this?e.tt=r:e.U===this?e.U=r:e.W=r,r.tt=e,r.W=this,this.tt=r,this.U=i,i&&(i.tt=this),r}};Sr.TreeNode=xn;var ga=class extends xn{constructor(){super(...arguments),this.rt=1}te(){let e=super.te();return this.ie(),e.ie(),e}se(){let e=super.se();return this.ie(),e.ie(),e}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}};Sr.TreeNodeEnableIndex=ga});var ba=g(In=>{"use strict";Object.defineProperty(In,"t",{value:!0});In.default=void 0;var qd=Bd(),CE=Be(),Nd=qe(),_a=class extends CE.Container{constructor(e=function(i,n){return i<n?-1:i>n?1:0},r=!1){super(),this.Y=void 0,this.v=e,r?(this.re=qd.TreeNodeEnableIndex,this.M=function(i,n,s){let o=this.ne(i,n,s);if(o){let a=o.tt;for(;a!==this.h;)a.rt+=1,a=a.tt;let l=this.he(o);if(l){let{parentNode:u,grandParent:f,curNode:c}=l;u.ie(),f.ie(),c.ie()}}return this.i},this.V=function(i){let n=this.fe(i);for(;n!==this.h;)n.rt-=1,n=n.tt}):(this.re=qd.TreeNode,this.M=function(i,n,s){let o=this.ne(i,n,s);return o&&this.he(o),this.i},this.V=this.fe),this.h=new this.re}X(e,r){let i=this.h;for(;e;){let n=this.v(e.u,r);if(n<0)e=e.W;else if(n>0)i=e,e=e.U;else return e}return i}Z(e,r){let i=this.h;for(;e;)this.v(e.u,r)<=0?e=e.W:(i=e,e=e.U);return i}$(e,r){let i=this.h;for(;e;){let n=this.v(e.u,r);if(n<0)i=e,e=e.W;else if(n>0)e=e.U;else return e}return i}rr(e,r){let i=this.h;for(;e;)this.v(e.u,r)<0?(i=e,e=e.W):e=e.U;return i}ue(e){for(;;){let r=e.tt;if(r===this.h)return;if(e.ee===1){e.ee=0;return}if(e===r.U){let i=r.W;if(i.ee===1)i.ee=0,r.ee=1,r===this.Y?this.Y=r.te():r.te();else if(i.W&&i.W.ee===1){i.ee=r.ee,r.ee=0,i.W.ee=0,r===this.Y?this.Y=r.te():r.te();return}else i.U&&i.U.ee===1?(i.ee=1,i.U.ee=0,i.se()):(i.ee=1,e=r)}else{let i=r.U;if(i.ee===1)i.ee=0,r.ee=1,r===this.Y?this.Y=r.se():r.se();else if(i.U&&i.U.ee===1){i.ee=r.ee,r.ee=0,i.U.ee=0,r===this.Y?this.Y=r.se():r.se();return}else i.W&&i.W.ee===1?(i.ee=1,i.W.ee=0,i.te()):(i.ee=1,e=r)}}}fe(e){if(this.i===1)return this.clear(),this.h;let r=e;for(;r.U||r.W;){if(r.W)for(r=r.W;r.U;)r=r.U;else r=r.U;[e.u,r.u]=[r.u,e.u],[e.l,r.l]=[r.l,e.l],e=r}this.h.U===r?this.h.U=r.tt:this.h.W===r&&(this.h.W=r.tt),this.ue(r);let i=r.tt;return r===i.U?i.U=void 0:i.W=void 0,this.i-=1,this.Y.ee=0,i}oe(e,r){return e===void 0?!1:this.oe(e.U,r)||r(e)?!0:this.oe(e.W,r)}he(e){for(;;){let r=e.tt;if(r.ee===0)return;let i=r.tt;if(r===i.U){let n=i.W;if(n&&n.ee===1){if(n.ee=r.ee=0,i===this.Y)return;i.ee=1,e=i;continue}else if(e===r.W){if(e.ee=0,e.U&&(e.U.tt=r),e.W&&(e.W.tt=i),r.W=e.U,i.U=e.W,e.U=r,e.W=i,i===this.Y)this.Y=e,this.h.tt=e;else{let s=i.tt;s.U===i?s.U=e:s.W=e}return e.tt=i.tt,r.tt=e,i.tt=e,i.ee=1,{parentNode:r,grandParent:i,curNode:e}}else r.ee=0,i===this.Y?this.Y=i.se():i.se(),i.ee=1}else{let n=i.U;if(n&&n.ee===1){if(n.ee=r.ee=0,i===this.Y)return;i.ee=1,e=i;continue}else if(e===r.U){if(e.ee=0,e.U&&(e.U.tt=i),e.W&&(e.W.tt=r),i.W=e.U,r.U=e.W,e.U=i,e.W=r,i===this.Y)this.Y=e,this.h.tt=e;else{let s=i.tt;s.U===i?s.U=e:s.W=e}return e.tt=i.tt,r.tt=e,i.tt=e,i.ee=1,{parentNode:r,grandParent:i,curNode:e}}else r.ee=0,i===this.Y?this.Y=i.te():i.te(),i.ee=1}return}}ne(e,r,i){if(this.Y===void 0){this.i+=1,this.Y=new this.re(e,r),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,this.h.W=this.Y;return}let n,s=this.h.U,o=this.v(s.u,e);if(o===0){s.l=r;return}else if(o>0)s.U=new this.re(e,r),s.U.tt=s,n=s.U,this.h.U=n;else{let a=this.h.W,l=this.v(a.u,e);if(l===0){a.l=r;return}else if(l<0)a.W=new this.re(e,r),a.W.tt=a,n=a.W,this.h.W=n;else{if(i!==void 0){let u=i.o;if(u!==this.h){let f=this.v(u.u,e);if(f===0){u.l=r;return}else if(f>0){let c=u.L(),h=this.v(c.u,e);if(h===0){c.l=r;return}else h<0&&(n=new this.re(e,r),c.W===void 0?(c.W=n,n.tt=c):(u.U=n,n.tt=u))}}}if(n===void 0)for(n=this.Y;;){let u=this.v(n.u,e);if(u>0){if(n.U===void 0){n.U=new this.re(e,r),n.U.tt=n,n=n.U;break}n=n.U}else if(u<0){if(n.W===void 0){n.W=new this.re(e,r),n.W.tt=n,n=n.W;break}n=n.W}else{n.l=r;return}}}}return this.i+=1,n}I(e,r){for(;e;){let i=this.v(e.u,r);if(i<0)e=e.W;else if(i>0)e=e.U;else return e}return e||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(e,r){let i=e.o;if(i===this.h&&(0,Nd.throwIteratorAccessError)(),this.i===1)return i.u=r,!0;if(i===this.h.U)return this.v(i.B().u,r)>0?(i.u=r,!0):!1;if(i===this.h.W)return this.v(i.L().u,r)<0?(i.u=r,!0):!1;let n=i.L().u;if(this.v(n,r)>=0)return!1;let s=i.B().u;return this.v(s,r)<=0?!1:(i.u=r,!0)}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let r=0,i=this;return this.oe(this.Y,function(n){return e===r?(i.V(n),!0):(r+=1,!1)}),this.i}eraseElementByKey(e){if(this.i===0)return!1;let r=this.I(this.Y,e);return r===this.h?!1:(this.V(r),!0)}eraseElementByIterator(e){let r=e.o;r===this.h&&(0,Nd.throwIteratorAccessError)();let i=r.W===void 0;return e.iteratorType===0?i&&e.next():(!i||r.U===void 0)&&e.next(),this.V(r),e}forEach(e){let r=0;for(let i of this)e(i,r++,this)}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let r,i=0;for(let n of this){if(i===e){r=n;break}i+=1}return r}getHeight(){if(this.i===0)return 0;let e=function(r){return r?Math.max(e(r.U),e(r.W))+1:0};return e(this.Y)}},RE=_a;In.default=RE});var ma=g(Pn=>{"use strict";Object.defineProperty(Pn,"t",{value:!0});Pn.default=void 0;var kE=Be(),On=qe(),ya=class extends kE.ContainerIterator{constructor(e,r,i){super(i),this.o=e,this.h=r,this.iteratorType===0?(this.pre=function(){return this.o===this.h.U&&(0,On.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,On.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,On.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,On.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let e=this.o,r=this.h.tt;if(e===this.h)return r?r.rt-1:0;let i=0;for(e.U&&(i+=e.U.rt);e!==r;){let n=e.tt;e===n.W&&(i+=1,n.U&&(i+=n.U.rt)),e=n}return i}},ME=ya;Pn.default=ME});var jd=g(Cn=>{"use strict";Object.defineProperty(Cn,"t",{value:!0});Cn.default=void 0;var BE=Ld(ba()),qE=Ld(ma()),NE=qe();function Ld(t){return t&&t.t?t:{default:t}}var ve=class t extends qE.default{constructor(e,r,i,n){super(e,r,n),this.container=i}get pointer(){return this.o===this.h&&(0,NE.throwIteratorAccessError)(),this.o.u}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},wa=class extends BE.default{constructor(e=[],r,i){super(r,i);let n=this;e.forEach(function(s){n.insert(s)})}*K(e){e!==void 0&&(yield*this.K(e.U),yield e.u,yield*this.K(e.W))}begin(){return new ve(this.h.U||this.h,this.h,this)}end(){return new ve(this.h,this.h,this)}rBegin(){return new ve(this.h.W||this.h,this.h,this,1)}rEnd(){return new ve(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(e,r){return this.M(e,void 0,r)}find(e){let r=this.I(this.Y,e);return new ve(r,this.h,this)}lowerBound(e){let r=this.X(this.Y,e);return new ve(r,this.h,this)}upperBound(e){let r=this.Z(this.Y,e);return new ve(r,this.h,this)}reverseLowerBound(e){let r=this.$(this.Y,e);return new ve(r,this.h,this)}reverseUpperBound(e){let r=this.rr(this.Y,e);return new ve(r,this.h,this)}union(e){let r=this;return e.forEach(function(i){r.insert(i)}),this.i}[Symbol.iterator](){return this.K(this.Y)}},LE=wa;Cn.default=LE});var Ud=g(Rn=>{"use strict";Object.defineProperty(Rn,"t",{value:!0});Rn.default=void 0;var jE=Dd(ba()),DE=Dd(ma()),UE=qe();function Dd(t){return t&&t.t?t:{default:t}}var Te=class t extends DE.default{constructor(e,r,i,n){super(e,r,n),this.container=i}get pointer(){this.o===this.h&&(0,UE.throwIteratorAccessError)();let e=this;return new Proxy([],{get(r,i){if(i==="0")return e.o.u;if(i==="1")return e.o.l},set(r,i,n){if(i!=="1")throw new TypeError("props must be 1");return e.o.l=n,!0}})}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},Sa=class extends jE.default{constructor(e=[],r,i){super(r,i);let n=this;e.forEach(function(s){n.setElement(s[0],s[1])})}*K(e){e!==void 0&&(yield*this.K(e.U),yield[e.u,e.l],yield*this.K(e.W))}begin(){return new Te(this.h.U||this.h,this.h,this)}end(){return new Te(this.h,this.h,this)}rBegin(){return new Te(this.h.W||this.h,this.h,this,1)}rEnd(){return new Te(this.h,this.h,this,1)}front(){if(this.i===0)return;let e=this.h.U;return[e.u,e.l]}back(){if(this.i===0)return;let e=this.h.W;return[e.u,e.l]}lowerBound(e){let r=this.X(this.Y,e);return new Te(r,this.h,this)}upperBound(e){let r=this.Z(this.Y,e);return new Te(r,this.h,this)}reverseLowerBound(e){let r=this.$(this.Y,e);return new Te(r,this.h,this)}reverseUpperBound(e){let r=this.rr(this.Y,e);return new Te(r,this.h,this)}setElement(e,r,i){return this.M(e,r,i)}find(e){let r=this.I(this.Y,e);return new Te(r,this.h,this)}getElementByKey(e){return this.I(this.Y,e).l}union(e){let r=this;return e.forEach(function(i){r.setElement(i[0],i[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}},WE=Sa;Rn.default=WE});var va=g(Ea=>{"use strict";Object.defineProperty(Ea,"t",{value:!0});Ea.default=FE;function FE(t){let e=typeof t;return e==="object"&&t!==null||e==="function"}});var Ia=g(Er=>{"use strict";Object.defineProperty(Er,"t",{value:!0});Er.HashContainerIterator=Er.HashContainer=void 0;var Wd=Be(),Ta=$E(va()),ti=qe();function $E(t){return t&&t.t?t:{default:t}}var Aa=class extends Wd.ContainerIterator{constructor(e,r,i){super(i),this.o=e,this.h=r,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,ti.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,ti.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,ti.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,ti.throwIteratorAccessError)(),this.o=this.o.L,this})}};Er.HashContainerIterator=Aa;var xa=class extends Wd.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(e){let{L:r,B:i}=e;r.B=i,i.L=r,e===this.p&&(this.p=i),e===this._&&(this._=r),this.i-=1}M(e,r,i){i===void 0&&(i=(0,Ta.default)(e));let n;if(i){let s=e[this.HASH_TAG];if(s!==void 0)return this.H[s].l=r,this.i;Object.defineProperty(e,this.HASH_TAG,{value:this.H.length,configurable:!0}),n={u:e,l:r,L:this._,B:this.h},this.H.push(n)}else{let s=this.g[e];if(s)return s.l=r,this.i;n={u:e,l:r,L:this._,B:this.h},this.g[e]=n}return this.i===0?(this.p=n,this.h.B=n):this._.B=n,this._=n,this.h.L=n,++this.i}I(e,r){if(r===void 0&&(r=(0,Ta.default)(e)),r){let i=e[this.HASH_TAG];return i===void 0?this.h:this.H[i]}else return this.g[e]||this.h}clear(){let e=this.HASH_TAG;this.H.forEach(function(r){delete r.u[e]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(e,r){let i;if(r===void 0&&(r=(0,Ta.default)(e)),r){let n=e[this.HASH_TAG];if(n===void 0)return!1;delete e[this.HASH_TAG],i=this.H[n],delete this.H[n]}else{if(i=this.g[e],i===void 0)return!1;delete this.g[e]}return this.V(i),!0}eraseElementByIterator(e){let r=e.o;return r===this.h&&(0,ti.throwIteratorAccessError)(),this.V(r),e.next()}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let r=this.p;for(;e--;)r=r.B;return this.V(r),this.i}};Er.HashContainer=xa});var $d=g(kn=>{"use strict";Object.defineProperty(kn,"t",{value:!0});kn.default=void 0;var Fd=Ia(),VE=qe(),Nt=class t extends Fd.HashContainerIterator{constructor(e,r,i,n){super(e,r,n),this.container=i}get pointer(){return this.o===this.h&&(0,VE.throwIteratorAccessError)(),this.o.u}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},Oa=class extends Fd.HashContainer{constructor(e=[]){super();let r=this;e.forEach(function(i){r.insert(i)})}begin(){return new Nt(this.p,this.h,this)}end(){return new Nt(this.h,this.h,this)}rBegin(){return new Nt(this._,this.h,this,1)}rEnd(){return new Nt(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(e,r){return this.M(e,void 0,r)}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let r=this.p;for(;e--;)r=r.B;return r.u}find(e,r){let i=this.I(e,r);return new Nt(i,this.h,this)}forEach(e){let r=0,i=this.p;for(;i!==this.h;)e(i.u,r++,this),i=i.B}[Symbol.iterator](){return function*(){let e=this.p;for(;e!==this.h;)yield e.u,e=e.B}.bind(this)()}},HE=Oa;kn.default=HE});var Hd=g(Mn=>{"use strict";Object.defineProperty(Mn,"t",{value:!0});Mn.default=void 0;var Vd=Ia(),GE=KE(va()),zE=qe();function KE(t){return t&&t.t?t:{default:t}}var Lt=class t extends Vd.HashContainerIterator{constructor(e,r,i,n){super(e,r,n),this.container=i}get pointer(){this.o===this.h&&(0,zE.throwIteratorAccessError)();let e=this;return new Proxy([],{get(r,i){if(i==="0")return e.o.u;if(i==="1")return e.o.l},set(r,i,n){if(i!=="1")throw new TypeError("props must be 1");return e.o.l=n,!0}})}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},Pa=class extends Vd.HashContainer{constructor(e=[]){super();let r=this;e.forEach(function(i){r.setElement(i[0],i[1])})}begin(){return new Lt(this.p,this.h,this)}end(){return new Lt(this.h,this.h,this)}rBegin(){return new Lt(this._,this.h,this,1)}rEnd(){return new Lt(this.h,this.h,this,1)}front(){if(this.i!==0)return[this.p.u,this.p.l]}back(){if(this.i!==0)return[this._.u,this._.l]}setElement(e,r,i){return this.M(e,r,i)}getElementByKey(e,r){if(r===void 0&&(r=(0,GE.default)(e)),r){let n=e[this.HASH_TAG];return n!==void 0?this.H[n].l:void 0}let i=this.g[e];return i?i.l:void 0}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let r=this.p;for(;e--;)r=r.B;return[r.u,r.l]}find(e,r){let i=this.I(e,r);return new Lt(i,this.h,this)}forEach(e){let r=0,i=this.p;for(;i!==this.h;)e([i.u,i.l],r++,this),i=i.B}[Symbol.iterator](){return function*(){let e=this.p;for(;e!==this.h;)yield[e.u,e.l],e=e.B}.bind(this)()}},YE=Pa;Mn.default=YE});var Gd=g(pe=>{"use strict";Object.defineProperty(pe,"t",{value:!0});Object.defineProperty(pe,"Deque",{enumerable:!0,get:function(){return tv.default}});Object.defineProperty(pe,"HashMap",{enumerable:!0,get:function(){return sv.default}});Object.defineProperty(pe,"HashSet",{enumerable:!0,get:function(){return nv.default}});Object.defineProperty(pe,"LinkList",{enumerable:!0,get:function(){return ev.default}});Object.defineProperty(pe,"OrderedMap",{enumerable:!0,get:function(){return iv.default}});Object.defineProperty(pe,"OrderedSet",{enumerable:!0,get:function(){return rv.default}});Object.defineProperty(pe,"PriorityQueue",{enumerable:!0,get:function(){return XE.default}});Object.defineProperty(pe,"Queue",{enumerable:!0,get:function(){return JE.default}});Object.defineProperty(pe,"Stack",{enumerable:!0,get:function(){return QE.default}});Object.defineProperty(pe,"Vector",{enumerable:!0,get:function(){return ZE.default}});var QE=Ne(Od()),JE=Ne(Pd()),XE=Ne(Cd()),ZE=Ne(Rd()),ev=Ne(kd()),tv=Ne(Md()),rv=Ne(jd()),iv=Ne(Ud()),nv=Ne($d()),sv=Ne(Hd());function Ne(t){return t&&t.t?t:{default:t}}});var Kd=g((gI,zd)=>{"use strict";var ov=Gd().OrderedSet,Le=ke()("number-allocator:trace"),av=ke()("number-allocator:error");function ie(t,e){this.low=t,this.high=e}ie.prototype.equals=function(t){return this.low===t.low&&this.high===t.high};ie.prototype.compare=function(t){return this.low<t.low&&this.high<t.low?-1:t.low<this.low&&t.high<this.low?1:0};function je(t,e){if(!(this instanceof je))return new je(t,e);this.min=t,this.max=e,this.ss=new ov([],(r,i)=>r.compare(i)),Le("Create"),this.clear()}je.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low};je.prototype.alloc=function(){if(this.ss.size()===0)return Le("alloc():empty"),null;let t=this.ss.begin(),e=t.pointer.low,r=t.pointer.high,i=e;return i+1<=r?this.ss.updateKeyByIterator(t,new ie(e+1,r)):this.ss.eraseElementByPos(0),Le("alloc():"+i),i};je.prototype.use=function(t){let e=new ie(t,t),r=this.ss.lowerBound(e);if(!r.equals(this.ss.end())){let i=r.pointer.low,n=r.pointer.high;return r.pointer.equals(e)?(this.ss.eraseElementByIterator(r),Le("use():"+t),!0):i>t?!1:i===t?(this.ss.updateKeyByIterator(r,new ie(i+1,n)),Le("use():"+t),!0):n===t?(this.ss.updateKeyByIterator(r,new ie(i,n-1)),Le("use():"+t),!0):(this.ss.updateKeyByIterator(r,new ie(t+1,n)),this.ss.insert(new ie(i,t-1)),Le("use():"+t),!0)}return Le("use():failed"),!1};je.prototype.free=function(t){if(t<this.min||t>this.max){av("free():"+t+" is out of range");return}let e=new ie(t,t),r=this.ss.upperBound(e);if(r.equals(this.ss.end())){if(r.equals(this.ss.begin())){this.ss.insert(e);return}r.pre();let i=r.pointer.high;r.pointer.high+1===t?this.ss.updateKeyByIterator(r,new ie(i,t)):this.ss.insert(e)}else if(r.equals(this.ss.begin()))if(t+1===r.pointer.low){let i=r.pointer.high;this.ss.updateKeyByIterator(r,new ie(t,i))}else this.ss.insert(e);else{let i=r.pointer.low,n=r.pointer.high;r.pre();let s=r.pointer.low;r.pointer.high+1===t?t+1===i?(this.ss.eraseElementByIterator(r),this.ss.updateKeyByIterator(r,new ie(s,n))):this.ss.updateKeyByIterator(r,new ie(s,t)):t+1===i?(this.ss.eraseElementByIterator(r.next()),this.ss.insert(new ie(t,n))):this.ss.insert(e)}Le("free():"+t)};je.prototype.clear=function(){Le("clear()"),this.ss.clear(),this.ss.insert(new ie(this.min,this.max))};je.prototype.intervalCount=function(){return this.ss.size()};je.prototype.dump=function(){console.log("length:"+this.ss.size());for(let t of this.ss)console.log(t)};zd.exports=je});var Ca=g((_I,Yd)=>{"use strict";var lv=Kd();Yd.exports.NumberAllocator=lv});var Qd=g(ka=>{"use strict";Object.defineProperty(ka,"__esModule",{value:!0});var uv=Id(),cv=Ca(),Ra=class{constructor(e){e>0&&(this.aliasToTopic=new uv.LRUCache({max:e}),this.topicToAlias={},this.numberAllocator=new cv.NumberAllocator(1,e),this.max=e,this.length=0)}put(e,r){if(r===0||r>this.max)return!1;let i=this.aliasToTopic.get(r);return i&&delete this.topicToAlias[i],this.aliasToTopic.set(r,e),this.topicToAlias[e]=r,this.numberAllocator.use(r),this.length=this.aliasToTopic.size,!0}getTopicByAlias(e){return this.aliasToTopic.get(e)}getAliasByTopic(e){let r=this.topicToAlias[e];return typeof r<"u"&&this.aliasToTopic.get(r),r}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){let e=this.numberAllocator.firstVacant();return e||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}};ka.default=Ra});var Jd=g(ri=>{"use strict";var fv=ri&&ri.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ri,"__esModule",{value:!0});var hv=ei(),dv=fv(Qd()),pv=Rt(),gv=(t,e)=>{t.log("_handleConnack");let{options:r}=t,n=r.protocolVersion===5?e.reasonCode:e.returnCode;if(clearTimeout(t.connackTimer),delete t.topicAliasSend,e.properties){if(e.properties.topicAliasMaximum){if(e.properties.topicAliasMaximum>65535){t.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}e.properties.topicAliasMaximum>0&&(t.topicAliasSend=new dv.default(e.properties.topicAliasMaximum))}e.properties.serverKeepAlive&&r.keepalive&&(r.keepalive=e.properties.serverKeepAlive),e.properties.maximumPacketSize&&(r.properties||(r.properties={}),r.properties.maximumPacketSize=e.properties.maximumPacketSize)}if(n===0)t.reconnecting=!1,t._onConnect(e);else if(n>0){let s=new pv.ErrorWithReasonCode(`Connection refused: ${hv.ReasonCodes[n]}`,n);t.emit("error",s),t.options.reconnectOnConnackError&&t._cleanUp(!0)}};ri.default=gv});var Xd=g(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});var _v=(t,e,r)=>{t.log("handling pubrel packet");let i=typeof r<"u"?r:t.noop,{messageId:n}=e,s={cmd:"pubcomp",messageId:n};t.incomingStore.get(e,(o,a)=>{o?t._sendPacket(s,i):(t.emit("message",a.topic,a.payload,a),t.handleMessage(a,l=>{if(l)return i(l);t.incomingStore.del(a,t.noop),t._sendPacket(s,i)}))})};Ma.default=_v});var Zd=g(ii=>{"use strict";var ni=ii&&ii.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ii,"__esModule",{value:!0});var bv=ni(yd()),yv=ni(Ed()),mv=ni(Jd()),wv=ni(ei()),Sv=ni(Xd()),Ev=(t,e,r)=>{let{options:i}=t;if(i.protocolVersion===5&&i.properties&&i.properties.maximumPacketSize&&i.properties.maximumPacketSize<e.length)return t.emit("error",new Error(`exceeding packets size ${e.cmd}`)),t.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),t;switch(t.log("_handlePacket :: emitting packetreceive"),t.emit("packetreceive",e),e.cmd){case"publish":(0,bv.default)(t,e,r);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":t.reschedulePing(),(0,wv.default)(t,e),r();break;case"pubrel":t.reschedulePing(),(0,Sv.default)(t,e,r);break;case"connack":(0,mv.default)(t,e),r();break;case"auth":t.reschedulePing(),(0,yv.default)(t,e),r();break;case"pingresp":t.log("_handlePacket :: received pingresp"),t.reschedulePing(!0),r();break;case"disconnect":t.emit("disconnect",e),r();break;default:t.log("_handlePacket :: unknown command"),r();break}};ii.default=Ev});var ep=g(vr=>{"use strict";var vv=vr&&vr.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(vr,"__esModule",{value:!0});vr.TypedEventEmitter=void 0;var Tv=vv(E("events")),Av=Rt(),Bn=class{};vr.TypedEventEmitter=Bn;(0,Av.applyMixin)(Bn,Tv.default)});var si=g(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.isReactNativeBrowser=jt.isWebWorker=void 0;var xv=()=>{var t;return typeof window<"u"?typeof navigator<"u"&&((t=navigator.userAgent)===null||t===void 0?void 0:t.toLowerCase().indexOf(" electron/"))>-1&&(process!=null&&process.versions)?!Object.prototype.hasOwnProperty.call(process.versions,"electron"):typeof window.document<"u":!1},tp=()=>{var t,e;return!!(typeof self=="object"&&(!((e=(t=self?.constructor)===null||t===void 0?void 0:t.name)===null||e===void 0)&&e.includes("WorkerGlobalScope")))},rp=()=>typeof navigator<"u"&&navigator.product==="ReactNative",Iv=xv()||tp()||rp();jt.isWebWorker=tp();jt.isReactNativeBrowser=rp();jt.default=Iv});var ip=g(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.createAddUniqueNumber=void 0;var Ov=t=>e=>{let r=t(e);return e.add(r),r};qn.createAddUniqueNumber=Ov});var np=g(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.createCache=void 0;var Pv=t=>(e,r)=>(t.set(e,r),r);Nn.createCache=Pv});var lp=g(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.createGenerateUniqueNumber=void 0;var sp=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,ap=536870912,op=ap*2,Cv=(t,e)=>r=>{let i=e.get(r),n=i===void 0?r.size:i<op?i+1:0;if(!r.has(n))return t(r,n);if(r.size<ap){for(;r.has(n);)n=Math.floor(Math.random()*op);return t(r,n)}if(r.size>sp)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(n);)n=Math.floor(Math.random()*sp);return t(r,n)};Ln.createGenerateUniqueNumber=Cv});var cp=g(up=>{"use strict";Object.defineProperty(up,"__esModule",{value:!0})});var hp=g(fp=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0})});var pp=g(dp=>{"use strict";Object.defineProperty(dp,"__esModule",{value:!0})});var _p=g(gp=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0})});var yp=g(bp=>{"use strict";Object.defineProperty(bp,"__esModule",{value:!0})});var wp=g(mp=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0})});var Sp=g($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});var Ba=cp();Object.keys(Ba).forEach(function(t){t==="default"||t==="__esModule"||t in $&&$[t]===Ba[t]||Object.defineProperty($,t,{enumerable:!0,get:function(){return Ba[t]}})});var qa=hp();Object.keys(qa).forEach(function(t){t==="default"||t==="__esModule"||t in $&&$[t]===qa[t]||Object.defineProperty($,t,{enumerable:!0,get:function(){return qa[t]}})});var Na=pp();Object.keys(Na).forEach(function(t){t==="default"||t==="__esModule"||t in $&&$[t]===Na[t]||Object.defineProperty($,t,{enumerable:!0,get:function(){return Na[t]}})});var La=_p();Object.keys(La).forEach(function(t){t==="default"||t==="__esModule"||t in $&&$[t]===La[t]||Object.defineProperty($,t,{enumerable:!0,get:function(){return La[t]}})});var ja=yp();Object.keys(ja).forEach(function(t){t==="default"||t==="__esModule"||t in $&&$[t]===ja[t]||Object.defineProperty($,t,{enumerable:!0,get:function(){return ja[t]}})});var Da=wp();Object.keys(Da).forEach(function(t){t==="default"||t==="__esModule"||t in $&&$[t]===Da[t]||Object.defineProperty($,t,{enumerable:!0,get:function(){return Da[t]}})})});var vp=g(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});var Rv={addUniqueNumber:!0,generateUniqueNumber:!0};He.generateUniqueNumber=He.addUniqueNumber=void 0;var kv=ip(),Mv=np(),Bv=lp(),Ua=Sp();Object.keys(Ua).forEach(function(t){t==="default"||t==="__esModule"||Object.prototype.hasOwnProperty.call(Rv,t)||t in He&&He[t]===Ua[t]||Object.defineProperty(He,t,{enumerable:!0,get:function(){return Ua[t]}})});var Ep=new WeakMap,qv=(0,Mv.createCache)(Ep),Nv=He.generateUniqueNumber=(0,Bv.createGenerateUniqueNumber)(qv,Ep),MI=He.addUniqueNumber=(0,kv.createAddUniqueNumber)(Nv)});var Ap=g((jn,Tp)=>{"use strict";(function(t,e){typeof jn=="object"&&typeof Tp<"u"?e(jn,vp()):typeof define=="function"&&define.amd?define(["exports","fast-unique-numbers"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t.workerTimersBroker={},t.fastUniqueNumbers))})(jn,function(t,e){"use strict";var r=function(o){return o.method!==void 0&&o.method==="call"},i=function(o){return o.error===null&&typeof o.id=="number"},n=function(o){var a=new Map([[0,function(){}]]),l=new Map([[0,function(){}]]),u=new Map,f=new Worker(o);f.addEventListener("message",function(p){var y=p.data;if(r(y)){var b=y.params,m=b.timerId,A=b.timerType;if(A==="interval"){var S=a.get(m);if(typeof S=="number"){var I=u.get(S);if(I===void 0||I.timerId!==m||I.timerType!==A)throw new Error("The timer is in an undefined state.")}else if(typeof S<"u")S();else throw new Error("The timer is in an undefined state.")}else if(A==="timeout"){var N=l.get(m);if(typeof N=="number"){var M=u.get(N);if(M===void 0||M.timerId!==m||M.timerType!==A)throw new Error("The timer is in an undefined state.")}else if(typeof N<"u")N(),l.delete(m);else throw new Error("The timer is in an undefined state.")}}else if(i(y)){var F=y.id,B=u.get(F);if(B===void 0)throw new Error("The timer is in an undefined state.");var Q=B.timerId,kr=B.timerType;u.delete(F),kr==="interval"?a.delete(Q):l.delete(Q)}else{var os=y.error.message;throw new Error(os)}});var c=function(y){var b=e.generateUniqueNumber(u);u.set(b,{timerId:y,timerType:"interval"}),a.set(y,b),f.postMessage({id:b,method:"clear",params:{timerId:y,timerType:"interval"}})},h=function(y){var b=e.generateUniqueNumber(u);u.set(b,{timerId:y,timerType:"timeout"}),l.set(y,b),f.postMessage({id:b,method:"clear",params:{timerId:y,timerType:"timeout"}})},d=function(y){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=e.generateUniqueNumber(a);return a.set(m,function(){y(),typeof a.get(m)=="function"&&f.postMessage({id:null,method:"set",params:{delay:b,now:performance.now(),timerId:m,timerType:"interval"}})}),f.postMessage({id:null,method:"set",params:{delay:b,now:performance.now(),timerId:m,timerType:"interval"}}),m},_=function(y){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=e.generateUniqueNumber(l);return l.set(m,y),f.postMessage({id:null,method:"set",params:{delay:b,now:performance.now(),timerId:m,timerType:"timeout"}}),m};return{clearInterval:c,clearTimeout:h,setInterval:d,setTimeout:_}};t.load=n})});var Ip=g((Dn,xp)=>{"use strict";(function(t,e){typeof Dn=="object"&&typeof xp<"u"?e(Dn,Ap()):typeof define=="function"&&define.amd?define(["exports","worker-timers-broker"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t.workerTimers={},t.workerTimersBroker))})(Dn,function(t,e){"use strict";var r=function(f,c){var h=null;return function(){if(h!==null)return h;var d=new Blob([c],{type:"application/javascript; charset=utf-8"}),_=URL.createObjectURL(d);return h=f(_),setTimeout(function(){return URL.revokeObjectURL(_)}),h}},i=`(()=>{var e={472:(e,t,r)=>{var o,i;void 0===(i="function"==typeof(o=function(){"use strict";var e=new Map,t=new Map,r=function(t){var r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)},o=function(e){var r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)},i=function(e,t){var r,o=performance.now();return{expected:o+(r=e-Math.max(0,o-t)),remainingDelay:r}},n=function e(t,r,o,i){var n=performance.now();n>o?postMessage({id:null,method:"call",params:{timerId:r,timerType:i}}):t.set(r,setTimeout(e,o-n,t,r,o,i))},a=function(t,r,o){var a=i(t,o),s=a.expected,d=a.remainingDelay;e.set(r,setTimeout(n,d,e,r,s,"interval"))},s=function(e,r,o){var a=i(e,o),s=a.expected,d=a.remainingDelay;t.set(r,setTimeout(n,d,t,r,s,"timeout"))};addEventListener("message",(function(e){var t=e.data;try{if("clear"===t.method){var i=t.id,n=t.params,d=n.timerId,c=n.timerType;if("interval"===c)r(d),postMessage({error:null,id:i});else{if("timeout"!==c)throw new Error('The given type "'.concat(c,'" is not supported'));o(d),postMessage({error:null,id:i})}}else{if("set"!==t.method)throw new Error('The given method "'.concat(t.method,'" is not supported'));var u=t.params,l=u.delay,p=u.now,m=u.timerId,v=u.timerType;if("interval"===v)a(l,m,p);else{if("timeout"!==v)throw new Error('The given type "'.concat(v,'" is not supported'));s(l,m,p)}}}catch(e){postMessage({error:{message:e.message},id:t.id,result:null})}}))})?o.call(t,r,t,e):o)||(e.exports=i)}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();`,n=r(e.load,i),s=function(f){return n().clearInterval(f)},o=function(f){return n().clearTimeout(f)},a=function(){var f;return(f=n()).setInterval.apply(f,arguments)},l=function(){var f;return(f=n()).setTimeout.apply(f,arguments)};t.clearInterval=s,t.clearTimeout=o,t.setInterval=a,t.setTimeout=l})});var Rp=g(Ge=>{"use strict";var Lv=Ge&&Ge.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),jv=Ge&&Ge.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Dv=Ge&&Ge.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Lv(e,t,r);return jv(e,t),e};Object.defineProperty(Ge,"__esModule",{value:!0});var Wa=Dv(si()),Op=Ip(),Pp={set:Op.setInterval,clear:Op.clearInterval},Cp={set:(t,e)=>setInterval(t,e),clear:t=>clearInterval(t)},Uv=t=>{switch(t){case"native":return Cp;case"worker":return Pp;case"auto":default:return Wa.default&&!Wa.isWebWorker&&!Wa.isReactNativeBrowser?Pp:Cp}};Ge.default=Uv});var $a=g(oi=>{"use strict";var Wv=oi&&oi.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(oi,"__esModule",{value:!0});var Fv=Wv(Rp()),Fa=class{get keepaliveTimeoutTimestamp(){return this._keepaliveTimeoutTimestamp}get intervalEvery(){return this._intervalEvery}get keepalive(){return this._keepalive}constructor(e,r){this.destroyed=!1,this.client=e,this.timer=typeof r=="object"&&"set"in r&&"clear"in r?r:(0,Fv.default)(r),this.setKeepalive(e.options.keepalive)}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}setKeepalive(e){if(e*=1e3,isNaN(e)||e<=0||e>2147483647)throw new Error(`Keepalive value must be an integer between 0 and 2147483647. Provided value is ${e}`);this._keepalive=e,this.reschedule(),this.client.log(`KeepaliveManager: set keepalive to ${e}ms`)}destroy(){this.clear(),this.destroyed=!0}reschedule(){if(this.destroyed)return;this.clear(),this.counter=0;let e=Math.ceil(this._keepalive*1.5);this._keepaliveTimeoutTimestamp=Date.now()+e,this._intervalEvery=Math.ceil(this._keepalive/2),this.timerId=this.timer.set(()=>{this.destroyed||(this.counter+=1,this.counter===2?this.client.sendPing():this.counter>2&&this.client.onKeepaliveTimeout())},this._intervalEvery)}};oi.default=Fa});var Fn=g(Ae=>{"use strict";var $v=Ae&&Ae.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Vv=Ae&&Ae.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Np=Ae&&Ae.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&$v(e,t,r);return Vv(e,t),e},dt=Ae&&Ae.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ae,"__esModule",{value:!0});var Hv=dt(vu()),Va=dt(cd()),Gv=dt(zo()),zv=ot(),kp=dt(pd()),Mp=Np(_d()),Kv=dt(ke()),Tr=dt(Qo()),Yv=dt(Zd()),Un=Rt(),Qv=ep(),Jv=dt($a()),Bp=Np(si()),Ha=globalThis.setImmediate||((...t)=>{let e=t.shift();(0,Un.nextTick)(()=>{e(...t)})}),qp={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0,writeCache:!0,timerVariant:"auto"},Wn=class t extends Qv.TypedEventEmitter{static defaultId(){return`mqttjs_${Math.random().toString(16).substr(2,8)}`}constructor(e,r){super(),this.options=r||{};for(let i in qp)typeof this.options[i]>"u"?this.options[i]=qp[i]:this.options[i]=r[i];this.log=this.options.log||(0,Kv.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",t.VERSION),Bp.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",Bp.default?"browser":"node"),this.log("MqttClient :: options.protocol",r.protocol),this.log("MqttClient :: options.protocolVersion",r.protocolVersion),this.log("MqttClient :: options.username",r.username),this.log("MqttClient :: options.keepalive",r.keepalive),this.log("MqttClient :: options.reconnectPeriod",r.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",r.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",r.properties?r.properties.topicAliasMaximum:void 0),this.options.clientId=typeof r.clientId=="string"?r.clientId:t.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=r.protocolVersion===5&&r.customHandleAcks?r.customHandleAcks:(...i)=>{i[3](null,0)},this.options.writeCache||(Va.default.writeToStream.cacheNumbers=!1),this.streamBuilder=e,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new Gv.default:this.options.messageIdProvider,this.outgoingStore=r.outgoingStore||new Tr.default,this.incomingStore=r.incomingStore||new Tr.default,this.queueQoSZero=r.queueQoSZero===void 0?!0:r.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.keepaliveManager=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,r.properties&&r.properties.topicAliasMaximum>0&&(r.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new Hv.default(r.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:i}=this,n=()=>{let s=i.shift();this.log("deliver :: entry %o",s);let o=null;if(!s){this._resubscribe();return}o=s.packet,this.log("deliver :: call _sendPacket for %o",o);let a=!0;o.messageId&&o.messageId!==0&&(this.messageIdProvider.register(o.messageId)||(a=!1)),a?this._sendPacket(o,l=>{s.cb&&s.cb(l),n()}):(this.log("messageId: %d has already used. The message is skipped and removed.",o.messageId),n())};this.log("connect :: sending queued packets"),n()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this._destroyKeepaliveManager(),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}handleAuth(e,r){r()}handleMessage(e,r){r()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){var e;let r=new zv.Writable,i=Va.default.parser(this.options),n=null,s=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.disconnected&&!this.reconnecting&&(this.incomingStore=this.options.incomingStore||new Tr.default,this.outgoingStore=this.options.outgoingStore||new Tr.default,this.disconnecting=!1,this.disconnected=!1),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),i.on("packet",f=>{this.log("parser :: on packet push to packets array."),s.push(f)});let o=()=>{this.log("work :: getting next packet in queue");let f=s.shift();if(f)this.log("work :: packet pulled from queue"),(0,Yv.default)(this,f,a);else{this.log("work :: no packets in queue");let c=n;n=null,this.log("work :: done flag is %s",!!c),c&&c()}},a=()=>{if(s.length)(0,Un.nextTick)(o);else{let f=n;n=null,f()}};r._write=(f,c,h)=>{n=h,this.log("writable stream :: parsing buffer"),i.parse(f),o()};let l=f=>{this.log("streamErrorHandler :: error",f.message),f.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",f)):this.noop(f)};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(r),this.stream.on("error",l),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let u={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(u.will=Object.assign(Object.assign({},this.options.will),{payload:(e=this.options.will)===null||e===void 0?void 0:e.payload})),this.topicAliasRecv&&(u.properties||(u.properties={}),this.topicAliasRecv&&(u.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(u),i.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){let f=Object.assign({cmd:"auth",reasonCode:0},this.options.authPacket);this._writePacket(f)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(e,r,i,n){this.log("publish :: message `%s` to topic `%s`",r,e);let{options:s}=this;typeof i=="function"&&(n=i,i=null),i=i||{},i=Object.assign(Object.assign({},{qos:0,retain:!1,dup:!1}),i);let{qos:a,retain:l,dup:u,properties:f,cbStorePut:c}=i;if(this._checkDisconnecting(n))return this;let h=()=>{let d=0;if((a===1||a===2)&&(d=this._nextId(),d===null))return this.log("No messageId left"),!1;let _={cmd:"publish",topic:e,payload:r,qos:a,retain:l,messageId:d,dup:u};switch(s.protocolVersion===5&&(_.properties=f),this.log("publish :: qos",a),a){case 1:case 2:this.outgoing[_.messageId]={volatile:!1,cb:n||this.noop},this.log("MqttClient:publish: packet cmd: %s",_.cmd),this._sendPacket(_,void 0,c);break;default:this.log("MqttClient:publish: packet cmd: %s",_.cmd),this._sendPacket(_,n,c);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!h())&&this._storeProcessingQueue.push({invoke:h,cbStorePut:i.cbStorePut,callback:n}),this}publishAsync(e,r,i){return new Promise((n,s)=>{this.publish(e,r,i,(o,a)=>{o?s(o):n(a)})})}subscribe(e,r,i){let n=this.options.protocolVersion;typeof r=="function"&&(i=r),i=i||this.noop;let s=!1,o=[];typeof e=="string"?(e=[e],o=e):Array.isArray(e)?o=e:typeof e=="object"&&(s=e.resubscribe,delete e.resubscribe,o=Object.keys(e));let a=Mp.validateTopics(o);if(a!==null)return Ha(i,new Error(`Invalid topic ${a}`)),this;if(this._checkDisconnecting(i))return this.log("subscribe: discconecting true"),this;let l={qos:0};n===5&&(l.nl=!1,l.rap=!1,l.rh=0),r=Object.assign(Object.assign({},l),r);let u=r.properties,f=[],c=(d,_)=>{if(_=_||r,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,d)||this._resubscribeTopics[d].qos<_.qos||s){let p={topic:d,qos:_.qos};n===5&&(p.nl=_.nl,p.rap=_.rap,p.rh=_.rh,p.properties=u),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",p.topic,p.qos),f.push(p)}};if(Array.isArray(e)?e.forEach(d=>{this.log("subscribe: array topic %s",d),c(d)}):Object.keys(e).forEach(d=>{this.log("subscribe: object topic %s, %o",d,e[d]),c(d,e[d])}),!f.length)return i(null,[]),this;let h=()=>{let d=this._nextId();if(d===null)return this.log("No messageId left"),!1;let _={cmd:"subscribe",subscriptions:f,messageId:d};if(u&&(_.properties=u),this.options.resubscribe){this.log("subscribe :: resubscribe true");let p=[];f.forEach(y=>{if(this.options.reconnectPeriod>0){let b={qos:y.qos};n===5&&(b.nl=y.nl||!1,b.rap=y.rap||!1,b.rh=y.rh||0,b.properties=y.properties),this._resubscribeTopics[y.topic]=b,p.push(y.topic)}}),this.messageIdToTopic[_.messageId]=p}return this.outgoing[_.messageId]={volatile:!0,cb(p,y){if(!p){let{granted:b}=y;for(let m=0;m<b.length;m+=1)f[m].qos=b[m]}i(p,f,y)}},this.log("subscribe :: call _sendPacket"),this._sendPacket(_),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!h())&&this._storeProcessingQueue.push({invoke:h,callback:i}),this}subscribeAsync(e,r){return new Promise((i,n)=>{this.subscribe(e,r,(s,o)=>{s?n(s):i(o)})})}unsubscribe(e,r,i){typeof e=="string"&&(e=[e]),typeof r=="function"&&(i=r),i=i||this.noop;let n=Mp.validateTopics(e);if(n!==null)return Ha(i,new Error(`Invalid topic ${n}`)),this;if(this._checkDisconnecting(i))return this;let s=()=>{let o=this._nextId();if(o===null)return this.log("No messageId left"),!1;let a={cmd:"unsubscribe",messageId:o,unsubscriptions:[]};return typeof e=="string"?a.unsubscriptions=[e]:Array.isArray(e)&&(a.unsubscriptions=e),this.options.resubscribe&&a.unsubscriptions.forEach(l=>{delete this._resubscribeTopics[l]}),typeof r=="object"&&r.properties&&(a.properties=r.properties),this.outgoing[a.messageId]={volatile:!0,cb:i},this.log("unsubscribe: call _sendPacket"),this._sendPacket(a),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!s())&&this._storeProcessingQueue.push({invoke:s,callback:i}),this}unsubscribeAsync(e,r){return new Promise((i,n)=>{this.unsubscribe(e,r,(s,o)=>{s?n(s):i(o)})})}end(e,r,i){this.log("end :: (%s)",this.options.clientId),(e==null||typeof e!="boolean")&&(i=i||r,r=e,e=!1),typeof r!="object"&&(i=i||r,r=null),this.log("end :: cb? %s",!!i),(!i||typeof i!="function")&&(i=this.noop);let n=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close(o=>{this.outgoingStore.close(a=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),i){let l=o||a;this.log("end :: closeStores: invoking callback with args"),i(l)}})}),this._deferredReconnect?this._deferredReconnect():(this.options.reconnectPeriod===0||this.options.manualConnect)&&(this.disconnecting=!1)},s=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,e),this._cleanUp(e,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,Un.nextTick)(n)},r)};return this.disconnecting?(i(),this):(this._clearReconnect(),this.disconnecting=!0,!e&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,s,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),s()),this)}endAsync(e,r){return new Promise((i,n)=>{this.end(e,r,s=>{s?n(s):i()})})}removeOutgoingMessage(e){if(this.outgoing[e]){let{cb:r}=this.outgoing[e];this._removeOutgoingAndStoreMessage(e,()=>{r(new Error("Message removed"))})}return this}reconnect(e){this.log("client reconnect");let r=()=>{e?(this.options.incomingStore=e.incomingStore,this.options.outgoingStore=e.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new Tr.default,this.outgoingStore=this.options.outgoingStore||new Tr.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(e=>{this.outgoing[e].volatile&&typeof this.outgoing[e].cb=="function"&&(this.outgoing[e].cb(new Error("Connection closed")),delete this.outgoing[e])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(e=>{typeof this.outgoing[e].cb=="function"&&(this.outgoing[e].cb(new Error("Connection closed")),delete this.outgoing[e])}))}_removeTopicAliasAndRecoverTopicName(e){let r;e.properties&&(r=e.properties.topicAlias);let i=e.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",r,i),i.length===0){if(typeof r>"u")return new Error("Unregistered Topic Alias");if(i=this.topicAliasSend.getTopicByAlias(r),typeof i>"u")return new Error("Unregistered Topic Alias");e.topic=i}r&&delete e.properties.topicAlias}_checkDisconnecting(e){return this.disconnecting&&(e&&e!==this.noop?e(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(e,r,i={}){if(r&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",r)),this.log("_cleanUp :: forced? %s",e),e)this.options.reconnectPeriod===0&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let n=Object.assign({cmd:"disconnect"},i);this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(n,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),Ha(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this._destroyKeepaliveManager(),r&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",r),r())}_storeAndSend(e,r,i){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",e.cmd);let n=e,s;if(n.cmd==="publish"&&(n=(0,kp.default)(e),s=this._removeTopicAliasAndRecoverTopicName(n),s))return r&&r(s);this.outgoingStore.put(n,o=>{if(o)return r&&r(o);i(),this._writePacket(e,r)})}_applyTopicAlias(e){if(this.options.protocolVersion===5&&e.cmd==="publish"){let r;e.properties&&(r=e.properties.topicAlias);let i=e.topic.toString();if(this.topicAliasSend)if(r){if(i.length!==0&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",i,r),!this.topicAliasSend.put(i,r)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",i,r),new Error("Sending Topic Alias out of range")}else i.length!==0&&(this.options.autoAssignTopicAlias?(r=this.topicAliasSend.getAliasByTopic(i),r?(e.topic="",e.properties=Object.assign(Object.assign({},e.properties),{topicAlias:r}),this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",i,r)):(r=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(i,r),e.properties=Object.assign(Object.assign({},e.properties),{topicAlias:r}),this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",i,r))):this.options.autoUseTopicAlias&&(r=this.topicAliasSend.getAliasByTopic(i),r&&(e.topic="",e.properties=Object.assign(Object.assign({},e.properties),{topicAlias:r}),this.log("applyTopicAlias :: auto use topic: %s - alias: %d",i,r))));else if(r)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",i,r),new Error("Sending Topic Alias out of range")}}_noop(e){this.log("noop ::",e)}_writePacket(e,r){this.log("_writePacket :: packet: %O",e),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",e),this.log("_writePacket :: writing to stream");let i=Va.default.writeToStream(e,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",i),!i&&r&&r!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",r)):r&&(this.log("_writePacket :: invoking cb"),r())}_sendPacket(e,r,i,n){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),i=i||this.noop,r=r||this.noop;let s=this._applyTopicAlias(e);if(s){r(s);return}if(!this.connected){if(e.cmd==="auth"){this._writePacket(e,r);return}this.log("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(e,r,i);return}if(n){this._writePacket(e,r);return}switch(e.cmd){case"publish":break;case"pubrel":this._storeAndSend(e,r,i);return;default:this._writePacket(e,r);return}switch(e.qos){case 2:case 1:this._storeAndSend(e,r,i);break;case 0:default:this._writePacket(e,r);break}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}_storePacket(e,r,i){this.log("_storePacket :: packet: %o",e),this.log("_storePacket :: cb? %s",!!r),i=i||this.noop;let n=e;if(n.cmd==="publish"){n=(0,kp.default)(e);let o=this._removeTopicAliasAndRecoverTopicName(n);if(o)return r&&r(o)}let s=n.qos||0;s===0&&this.queueQoSZero||n.cmd!=="publish"?this.queue.push({packet:n,cb:r}):s>0?(r=this.outgoing[n.messageId]?this.outgoing[n.messageId].cb:null,this.outgoingStore.put(n,o=>{if(o)return r&&r(o);i()})):r&&r(new Error("No connection to broker"))}_setupKeepaliveManager(){this.log("_setupKeepaliveManager :: keepalive %d (seconds)",this.options.keepalive),!this.keepaliveManager&&this.options.keepalive&&(this.keepaliveManager=new Jv.default(this,this.options.timerVariant))}_destroyKeepaliveManager(){this.keepaliveManager&&(this.log("_destroyKeepaliveManager :: destroying keepalive manager"),this.keepaliveManager.destroy(),this.keepaliveManager=null)}reschedulePing(e=!1){this.keepaliveManager&&this.options.keepalive&&(e||this.options.reschedulePings)&&this._reschedulePing()}_reschedulePing(){this.log("_reschedulePing :: rescheduling ping"),this.keepaliveManager.reschedule()}sendPing(){this.log("_sendPing :: sending pingreq"),this._sendPacket({cmd:"pingreq"})}onKeepaliveTimeout(){this.emit("error",new Error("Keepalive timeout")),this.log("onKeepaliveTimeout :: calling _cleanUp with force true"),this._cleanUp(!0)}_resubscribe(){this.log("_resubscribe");let e=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&e.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){this.log("_resubscribe: protocolVersion 5");for(let r=0;r<e.length;r++){let i={};i[e[r]]=this._resubscribeTopics[e[r]],i.resubscribe=!0,this.subscribe(i,{properties:i[e[r]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(e){if(this.disconnected){this.emit("connect",e);return}this.connackPacket=e,this.messageIdProvider.clear(),this._setupKeepaliveManager(),this.connected=!0;let r=()=>{let i=this.outgoingStore.createStream(),n=()=>{i.destroy(),i=null,this._flushStoreProcessingQueue(),s()},s=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",n),i.on("error",a=>{s(),this._flushStoreProcessingQueue(),this.removeListener("close",n),this.emit("error",a)});let o=()=>{if(!i)return;let a=i.read(1),l;if(!a){i.once("readable",o);return}if(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[a.messageId]){o();return}!this.disconnecting&&!this.reconnectTimer?(l=this.outgoing[a.messageId]?this.outgoing[a.messageId].cb:null,this.outgoing[a.messageId]={volatile:!1,cb(u,f){l&&l(u,f),o()}},this._packetIdsDuringStoreProcessing[a.messageId]=!0,this.messageIdProvider.register(a.messageId)?this._sendPacket(a,void 0,void 0,!0):this.log("messageId: %d has already used.",a.messageId)):i.destroy&&i.destroy()};i.on("end",()=>{let a=!0;for(let l in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[l]){a=!1;break}this.removeListener("close",n),a?(s(),this._invokeAllStoreProcessingQueue(),this.emit("connect",e)):r()}),o()};r()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let e=this._storeProcessingQueue[0];if(e&&e.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let e of this._storeProcessingQueue)e.cbStorePut&&e.cbStorePut(new Error("Connection closed")),e.callback&&e.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(e,r){delete this.outgoing[e],this.outgoingStore.del({messageId:e},(i,n)=>{r(i,n),this.messageIdProvider.deallocate(e),this._invokeStoreProcessingQueue()})}};Wn.VERSION=Un.MQTTJS_VERSION;Ae.default=Wn});var Lp=g(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});var Xv=Ca(),Ga=class{constructor(){this.numberAllocator=new Xv.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(e){return this.numberAllocator.use(e)}deallocate(e){this.numberAllocator.free(e)}clear(){this.numberAllocator.clear()}};za.default=Ga});var ze=g((DI,Up)=>{"use strict";var jp=["nodebuffer","arraybuffer","fragments"],Dp=typeof Blob<"u";Dp&&jp.push("blob");Up.exports={BINARY_TYPES:jp,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:Dp,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var ai=g((UI,$n)=>{"use strict";var{EMPTY_BUFFER:Zv}=ze(),Ka=Buffer[Symbol.species];function e1(t,e){if(t.length===0)return Zv;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),i=0;for(let n=0;n<t.length;n++){let s=t[n];r.set(s,i),i+=s.length}return i<e?new Ka(r.buffer,r.byteOffset,i):r}function Wp(t,e,r,i,n){for(let s=0;s<n;s++)r[i+s]=t[s]^e[s&3]}function Fp(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function t1(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function Ya(t){if(Ya.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new Ka(t):ArrayBuffer.isView(t)?e=new Ka(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),Ya.readOnly=!1),e}$n.exports={concat:e1,mask:Wp,toArrayBuffer:t1,toBuffer:Ya,unmask:Fp};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=E("bufferutil");$n.exports.mask=function(e,r,i,n,s){s<48?Wp(e,r,i,n,s):t.mask(e,r,i,n,s)},$n.exports.unmask=function(e,r){e.length<32?Fp(e,r):t.unmask(e,r)}}catch{}});var Hp=g((WI,Vp)=>{"use strict";var $p=Symbol("kDone"),Qa=Symbol("kRun"),Ja=class{constructor(e){this[$p]=()=>{this.pending--,this[Qa]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Qa]()}[Qa](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[$p])}}};Vp.exports=Ja});var ci=g((FI,Yp)=>{"use strict";var li=E("zlib"),Gp=ai(),r1=Hp(),{kStatusCode:zp}=ze(),i1=Buffer[Symbol.species],n1=Buffer.from([0,0,255,255]),Gn=Symbol("permessage-deflate"),Ke=Symbol("total-length"),ui=Symbol("callback"),pt=Symbol("buffers"),Hn=Symbol("error"),Vn,Xa=class{constructor(e,r,i){if(this._maxPayload=i|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Vn){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Vn=new r1(n)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[ui];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,i=e.find(n=>!(r.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>n.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!i)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(i.server_no_context_takeover=!0),r.clientNoContextTakeover&&(i.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(i.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?i.client_max_window_bits=r.clientMaxWindowBits:(i.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete i.client_max_window_bits,i}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(i=>{let n=r[i];if(n.length>1)throw new Error(`Parameter "${i}" must have only a single value`);if(n=n[0],i==="client_max_window_bits"){if(n!==!0){let s=+n;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${i}": ${n}`);n=s}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${i}": ${n}`)}else if(i==="server_max_window_bits"){let s=+n;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${i}": ${n}`);n=s}else if(i==="client_no_context_takeover"||i==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${i}": ${n}`)}else throw new Error(`Unknown parameter "${i}"`);r[i]=n})}),e}decompress(e,r,i){Vn.add(n=>{this._decompress(e,r,(s,o)=>{n(),i(s,o)})})}compress(e,r,i){Vn.add(n=>{this._compress(e,r,(s,o)=>{n(),i(s,o)})})}_decompress(e,r,i){let n=this._isServer?"client":"server";if(!this._inflate){let s=`${n}_max_window_bits`,o=typeof this.params[s]!="number"?li.Z_DEFAULT_WINDOWBITS:this.params[s];this._inflate=li.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[Gn]=this,this._inflate[Ke]=0,this._inflate[pt]=[],this._inflate.on("error",o1),this._inflate.on("data",Kp)}this._inflate[ui]=i,this._inflate.write(e),r&&this._inflate.write(n1),this._inflate.flush(()=>{let s=this._inflate[Hn];if(s){this._inflate.close(),this._inflate=null,i(s);return}let o=Gp.concat(this._inflate[pt],this._inflate[Ke]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Ke]=0,this._inflate[pt]=[],r&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),i(null,o)})}_compress(e,r,i){let n=this._isServer?"server":"client";if(!this._deflate){let s=`${n}_max_window_bits`,o=typeof this.params[s]!="number"?li.Z_DEFAULT_WINDOWBITS:this.params[s];this._deflate=li.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[Ke]=0,this._deflate[pt]=[],this._deflate.on("data",s1)}this._deflate[ui]=i,this._deflate.write(e),this._deflate.flush(li.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let s=Gp.concat(this._deflate[pt],this._deflate[Ke]);r&&(s=new i1(s.buffer,s.byteOffset,s.length-4)),this._deflate[ui]=null,this._deflate[Ke]=0,this._deflate[pt]=[],r&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),i(null,s)})}};Yp.exports=Xa;function s1(t){this[pt].push(t),this[Ke]+=t.length}function Kp(t){if(this[Ke]+=t.length,this[Gn]._maxPayload<1||this[Ke]<=this[Gn]._maxPayload){this[pt].push(t);return}this[Hn]=new RangeError("Max payload size exceeded"),this[Hn].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Hn][zp]=1009,this.removeListener("data",Kp),this.reset()}function o1(t){this[Gn]._inflate=null,t[zp]=1007,this[ui](t)}});var Ar=g(($I,zn)=>{"use strict";var{isUtf8:Qp}=E("buffer"),{hasBlob:a1}=ze(),l1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function u1(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function Za(t){let e=t.length,r=0;for(;r<e;)if(!(t[r]&128))r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function c1(t){return a1&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}zn.exports={isBlob:c1,isValidStatusCode:u1,isValidUTF8:Za,tokenChars:l1};if(Qp)zn.exports.isValidUTF8=function(t){return t.length<24?Za(t):Qp(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=E("utf-8-validate");zn.exports.isValidUTF8=function(e){return e.length<32?Za(e):t(e)}}catch{}});var nl=g((VI,ig)=>{"use strict";var{Writable:f1}=E("stream"),Jp=ci(),{BINARY_TYPES:h1,EMPTY_BUFFER:Xp,kStatusCode:d1,kWebSocket:p1}=ze(),{concat:el,toArrayBuffer:g1,unmask:_1}=ai(),{isValidStatusCode:b1,isValidUTF8:Zp}=Ar(),Kn=Buffer[Symbol.species],ge=0,eg=1,tg=2,rg=3,tl=4,rl=5,Yn=6,il=class extends f1{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||h1[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[p1]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=ge}_write(e,r,i){if(this._opcode===8&&this._state==ge)return i();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(i)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let i=this._buffers[0];return this._buffers[0]=new Kn(i.buffer,i.byteOffset+e,i.length-e),new Kn(i.buffer,i.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let i=this._buffers[0],n=r.length-e;e>=i.length?r.set(this._buffers.shift(),n):(r.set(new Uint8Array(i.buffer,i.byteOffset,e),n),this._buffers[0]=new Kn(i.buffer,i.byteOffset+e,i.length-e)),e-=i.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case ge:this.getInfo(e);break;case eg:this.getPayloadLength16(e);break;case tg:this.getPayloadLength64(e);break;case rg:this.getMask();break;case tl:this.getData(e);break;case rl:case Yn:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if(r[0]&48){let n=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(n);return}let i=(r[0]&64)===64;if(i&&!this._extensions[Jp.extensionName]){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(i){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(!this._fragmented){let n=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._compressed=i}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let n=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(n);return}if(i){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let n=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(n);return}}else{let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let n=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(n);return}}else if(this._masked){let n=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(n);return}this._payloadLength===126?this._state=eg:this._payloadLength===127?this._state=tg:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),i=r.readUInt32BE(0);if(i>Math.pow(2,21)-1){let n=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(n);return}this._payloadLength=i*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=rg:this._state=tl}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=tl}getData(e){let r=Xp;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&_1(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=rl,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[Jp.extensionName].decompress(e,this._fin,(n,s)=>{if(n)return r(n);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(o);return}this._fragments.push(s)}this.dataMessage(r),this._state===ge&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=ge;return}let r=this._messageLength,i=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let n;this._binaryType==="nodebuffer"?n=el(i,r):this._binaryType==="arraybuffer"?n=g1(el(i,r)):this._binaryType==="blob"?n=new Blob(i):n=i,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=ge):(this._state=Yn,setImmediate(()=>{this.emit("message",n,!0),this._state=ge,this.startLoop(e)}))}else{let n=el(i,r);if(!this._skipUTF8Validation&&!Zp(n)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(s);return}this._state===rl||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=ge):(this._state=Yn,setImmediate(()=>{this.emit("message",n,!1),this._state=ge,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,Xp),this.end();else{let i=e.readUInt16BE(0);if(!b1(i)){let s=this.createError(RangeError,`invalid status code ${i}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(s);return}let n=new Kn(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!Zp(n)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(s);return}this._loop=!1,this.emit("conclude",i,n),this.end()}this._state=ge;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=ge):(this._state=Yn,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=ge,this.startLoop(r)}))}createError(e,r,i,n,s){this._loop=!1,this._errored=!0;let o=new e(i?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(o,this.createError),o.code=s,o[d1]=n,o}};ig.exports=il});var al=g((GI,og)=>{"use strict";var{Duplex:HI}=E("stream"),{randomFillSync:y1}=E("crypto"),ng=ci(),{EMPTY_BUFFER:m1,kWebSocket:w1,NOOP:S1}=ze(),{isBlob:xr,isValidStatusCode:E1}=Ar(),{mask:sg,toBuffer:Dt}=ai(),_e=Symbol("kByteLength"),v1=Buffer.alloc(4),Qn=8*1024,Ut,Ir=Qn,xe=0,T1=1,A1=2,sl=class t{constructor(e,r,i){this._extensions=r||{},i&&(this._generateMask=i,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=xe,this.onerror=S1,this[w1]=void 0}static frame(e,r){let i,n=!1,s=2,o=!1;r.mask&&(i=r.maskBuffer||v1,r.generateMask?r.generateMask(i):(Ir===Qn&&(Ut===void 0&&(Ut=Buffer.alloc(Qn)),y1(Ut,0,Qn),Ir=0),i[0]=Ut[Ir++],i[1]=Ut[Ir++],i[2]=Ut[Ir++],i[3]=Ut[Ir++]),o=(i[0]|i[1]|i[2]|i[3])===0,s=6);let a;typeof e=="string"?(!r.mask||o)&&r[_e]!==void 0?a=r[_e]:(e=Buffer.from(e),a=e.length):(a=e.length,n=r.mask&&r.readOnly&&!o);let l=a;a>=65536?(s+=8,l=127):a>125&&(s+=2,l=126);let u=Buffer.allocUnsafe(n?a+s:s);return u[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(u[0]|=64),u[1]=l,l===126?u.writeUInt16BE(a,2):l===127&&(u[2]=u[3]=0,u.writeUIntBE(a,4,6)),r.mask?(u[1]|=128,u[s-4]=i[0],u[s-3]=i[1],u[s-2]=i[2],u[s-1]=i[3],o?[u,e]:n?(sg(e,i,u,s,a),[u]):(sg(e,i,e,0,a),[u,e])):[u,e]}close(e,r,i,n){let s;if(e===void 0)s=m1;else{if(typeof e!="number"||!E1(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)s=Buffer.allocUnsafe(2),s.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+a),s.writeUInt16BE(e,0),typeof r=="string"?s.write(r,2):s.set(r,2)}}let o={[_e]:s.length,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==xe?this.enqueue([this.dispatch,s,!1,o,n]):this.sendFrame(t.frame(s,o),n)}ping(e,r,i){let n,s;if(typeof e=="string"?(n=Buffer.byteLength(e),s=!1):xr(e)?(n=e.size,s=!1):(e=Dt(e),n=e.length,s=Dt.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[_e]:n,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};xr(e)?this._state!==xe?this.enqueue([this.getBlobData,e,!1,o,i]):this.getBlobData(e,!1,o,i):this._state!==xe?this.enqueue([this.dispatch,e,!1,o,i]):this.sendFrame(t.frame(e,o),i)}pong(e,r,i){let n,s;if(typeof e=="string"?(n=Buffer.byteLength(e),s=!1):xr(e)?(n=e.size,s=!1):(e=Dt(e),n=e.length,s=Dt.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[_e]:n,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};xr(e)?this._state!==xe?this.enqueue([this.getBlobData,e,!1,o,i]):this.getBlobData(e,!1,o,i):this._state!==xe?this.enqueue([this.dispatch,e,!1,o,i]):this.sendFrame(t.frame(e,o),i)}send(e,r,i){let n=this._extensions[ng.extensionName],s=r.binary?2:1,o=r.compress,a,l;typeof e=="string"?(a=Buffer.byteLength(e),l=!1):xr(e)?(a=e.size,l=!1):(e=Dt(e),a=e.length,l=Dt.readOnly),this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=n._threshold),this._compress=o):(o=!1,s=0),r.fin&&(this._firstFragment=!0);let u={[_e]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:l,rsv1:o};xr(e)?this._state!==xe?this.enqueue([this.getBlobData,e,this._compress,u,i]):this.getBlobData(e,this._compress,u,i):this._state!==xe?this.enqueue([this.dispatch,e,this._compress,u,i]):this.dispatch(e,this._compress,u,i)}getBlobData(e,r,i,n){this._bufferedBytes+=i[_e],this._state=A1,e.arrayBuffer().then(s=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(ol,this,a,n);return}this._bufferedBytes-=i[_e];let o=Dt(s);r?this.dispatch(o,r,i,n):(this._state=xe,this.sendFrame(t.frame(o,i),n),this.dequeue())}).catch(s=>{process.nextTick(x1,this,s,n)})}dispatch(e,r,i,n){if(!r){this.sendFrame(t.frame(e,i),n);return}let s=this._extensions[ng.extensionName];this._bufferedBytes+=i[_e],this._state=T1,s.compress(e,i.fin,(o,a)=>{if(this._socket.destroyed){let l=new Error("The socket was closed while data was being compressed");ol(this,l,n);return}this._bufferedBytes-=i[_e],this._state=xe,i.readOnly=!1,this.sendFrame(t.frame(a,i),n),this.dequeue()})}dequeue(){for(;this._state===xe&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][_e],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][_e],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};og.exports=sl;function ol(t,e,r){typeof r=="function"&&r(e);for(let i=0;i<t._queue.length;i++){let n=t._queue[i],s=n[n.length-1];typeof s=="function"&&s(e)}}function x1(t,e,r){ol(t,e,r),t.onerror(e)}});var gg=g((zI,pg)=>{"use strict";var{kForOnEventAttribute:fi,kListener:ll}=ze(),ag=Symbol("kCode"),lg=Symbol("kData"),ug=Symbol("kError"),cg=Symbol("kMessage"),fg=Symbol("kReason"),Or=Symbol("kTarget"),hg=Symbol("kType"),dg=Symbol("kWasClean"),Ye=class{constructor(e){this[Or]=null,this[hg]=e}get target(){return this[Or]}get type(){return this[hg]}};Object.defineProperty(Ye.prototype,"target",{enumerable:!0});Object.defineProperty(Ye.prototype,"type",{enumerable:!0});var Wt=class extends Ye{constructor(e,r={}){super(e),this[ag]=r.code===void 0?0:r.code,this[fg]=r.reason===void 0?"":r.reason,this[dg]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[ag]}get reason(){return this[fg]}get wasClean(){return this[dg]}};Object.defineProperty(Wt.prototype,"code",{enumerable:!0});Object.defineProperty(Wt.prototype,"reason",{enumerable:!0});Object.defineProperty(Wt.prototype,"wasClean",{enumerable:!0});var Pr=class extends Ye{constructor(e,r={}){super(e),this[ug]=r.error===void 0?null:r.error,this[cg]=r.message===void 0?"":r.message}get error(){return this[ug]}get message(){return this[cg]}};Object.defineProperty(Pr.prototype,"error",{enumerable:!0});Object.defineProperty(Pr.prototype,"message",{enumerable:!0});var hi=class extends Ye{constructor(e,r={}){super(e),this[lg]=r.data===void 0?null:r.data}get data(){return this[lg]}};Object.defineProperty(hi.prototype,"data",{enumerable:!0});var I1={addEventListener(t,e,r={}){for(let n of this.listeners(t))if(!r[fi]&&n[ll]===e&&!n[fi])return;let i;if(t==="message")i=function(s,o){let a=new hi("message",{data:o?s:s.toString()});a[Or]=this,Jn(e,this,a)};else if(t==="close")i=function(s,o){let a=new Wt("close",{code:s,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Or]=this,Jn(e,this,a)};else if(t==="error")i=function(s){let o=new Pr("error",{error:s,message:s.message});o[Or]=this,Jn(e,this,o)};else if(t==="open")i=function(){let s=new Ye("open");s[Or]=this,Jn(e,this,s)};else return;i[fi]=!!r[fi],i[ll]=e,r.once?this.once(t,i):this.on(t,i)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[ll]===e&&!r[fi]){this.removeListener(t,r);break}}};pg.exports={CloseEvent:Wt,ErrorEvent:Pr,Event:Ye,EventTarget:I1,MessageEvent:hi};function Jn(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var ul=g((KI,_g)=>{"use strict";var{tokenChars:di}=Ar();function De(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function O1(t){let e=Object.create(null),r=Object.create(null),i=!1,n=!1,s=!1,o,a,l=-1,u=-1,f=-1,c=0;for(;c<t.length;c++)if(u=t.charCodeAt(c),o===void 0)if(f===-1&&di[u]===1)l===-1&&(l=c);else if(c!==0&&(u===32||u===9))f===-1&&l!==-1&&(f=c);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${c}`);f===-1&&(f=c);let d=t.slice(l,f);u===44?(De(e,d,r),r=Object.create(null)):o=d,l=f=-1}else throw new SyntaxError(`Unexpected character at index ${c}`);else if(a===void 0)if(f===-1&&di[u]===1)l===-1&&(l=c);else if(u===32||u===9)f===-1&&l!==-1&&(f=c);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${c}`);f===-1&&(f=c),De(r,t.slice(l,f),!0),u===44&&(De(e,o,r),r=Object.create(null),o=void 0),l=f=-1}else if(u===61&&l!==-1&&f===-1)a=t.slice(l,c),l=f=-1;else throw new SyntaxError(`Unexpected character at index ${c}`);else if(n){if(di[u]!==1)throw new SyntaxError(`Unexpected character at index ${c}`);l===-1?l=c:i||(i=!0),n=!1}else if(s)if(di[u]===1)l===-1&&(l=c);else if(u===34&&l!==-1)s=!1,f=c;else if(u===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${c}`);else if(u===34&&t.charCodeAt(c-1)===61)s=!0;else if(f===-1&&di[u]===1)l===-1&&(l=c);else if(l!==-1&&(u===32||u===9))f===-1&&(f=c);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${c}`);f===-1&&(f=c);let d=t.slice(l,f);i&&(d=d.replace(/\\/g,""),i=!1),De(r,a,d),u===44&&(De(e,o,r),r=Object.create(null),o=void 0),a=void 0,l=f=-1}else throw new SyntaxError(`Unexpected character at index ${c}`);if(l===-1||s||u===32||u===9)throw new SyntaxError("Unexpected end of input");f===-1&&(f=c);let h=t.slice(l,f);return o===void 0?De(e,h,r):(a===void 0?De(r,h,!0):i?De(r,a,h.replace(/\\/g,"")):De(r,a,h),De(e,o,r)),e}function P1(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(i=>[e].concat(Object.keys(i).map(n=>{let s=i[n];return Array.isArray(s)||(s=[s]),s.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}_g.exports={format:P1,parse:O1}});var pl=g((JI,Og)=>{"use strict";var C1=E("events"),R1=E("https"),k1=E("http"),mg=E("net"),M1=E("tls"),{randomBytes:B1,createHash:q1}=E("crypto"),{Duplex:YI,Readable:QI}=E("stream"),{URL:cl}=E("url"),gt=ci(),N1=nl(),L1=al(),{isBlob:j1}=Ar(),{BINARY_TYPES:bg,EMPTY_BUFFER:Xn,GUID:D1,kForOnEventAttribute:fl,kListener:U1,kStatusCode:W1,kWebSocket:Y,NOOP:wg}=ze(),{EventTarget:{addEventListener:F1,removeEventListener:$1}}=gg(),{format:V1,parse:H1}=ul(),{toBuffer:G1}=ai(),z1=30*1e3,Sg=Symbol("kAborted"),hl=[8,13],Qe=["CONNECTING","OPEN","CLOSING","CLOSED"],K1=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,D=class t extends C1{constructor(e,r,i){super(),this._binaryType=bg[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Xn,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(i=r,r=[]):r=[r]),Eg(this,e,r,i)):(this._autoPong=i.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){bg.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,i){let n=new N1({allowSynchronousEvents:i.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation}),s=new L1(e,this._extensions,i.generateMask);this._receiver=n,this._sender=s,this._socket=e,n[Y]=this,s[Y]=this,e[Y]=this,n.on("conclude",J1),n.on("drain",X1),n.on("error",Z1),n.on("message",eT),n.on("ping",tT),n.on("pong",rT),s.onerror=iT,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",Ag),e.on("data",es),e.on("end",xg),e.on("error",Ig),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[gt.extensionName]&&this._extensions[gt.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){ae(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,i=>{i||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Tg(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,i){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(i=e,e=r=void 0):typeof r=="function"&&(i=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){dl(this,e,i);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Xn,r,i)}pong(e,r,i){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(i=e,e=r=void 0):typeof r=="function"&&(i=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){dl(this,e,i);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Xn,r,i)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,i){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(i=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){dl(this,e,i);return}let n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[gt.extensionName]||(n.compress=!1),this._sender.send(e||Xn,n,i)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){ae(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(D,"CONNECTING",{enumerable:!0,value:Qe.indexOf("CONNECTING")});Object.defineProperty(D.prototype,"CONNECTING",{enumerable:!0,value:Qe.indexOf("CONNECTING")});Object.defineProperty(D,"OPEN",{enumerable:!0,value:Qe.indexOf("OPEN")});Object.defineProperty(D.prototype,"OPEN",{enumerable:!0,value:Qe.indexOf("OPEN")});Object.defineProperty(D,"CLOSING",{enumerable:!0,value:Qe.indexOf("CLOSING")});Object.defineProperty(D.prototype,"CLOSING",{enumerable:!0,value:Qe.indexOf("CLOSING")});Object.defineProperty(D,"CLOSED",{enumerable:!0,value:Qe.indexOf("CLOSED")});Object.defineProperty(D.prototype,"CLOSED",{enumerable:!0,value:Qe.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(D.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(D.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[fl])return e[U1];return null},set(e){for(let r of this.listeners(t))if(r[fl]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[fl]:!0})}})});D.prototype.addEventListener=F1;D.prototype.removeEventListener=$1;Og.exports=D;function Eg(t,e,r,i){let n={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:hl[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...i,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=n.autoPong,!hl.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${hl.join(", ")})`);let s;if(e instanceof cl)s=e;else try{s=new cl(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s.protocol==="http:"?s.protocol="ws:":s.protocol==="https:"&&(s.protocol="wss:"),t._url=s.href;let o=s.protocol==="wss:",a=s.protocol==="ws+unix:",l;if(s.protocol!=="ws:"&&!o&&!a?l=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:a&&!s.pathname?l="The URL's pathname is empty":s.hash&&(l="The URL contains a fragment identifier"),l){let p=new SyntaxError(l);if(t._redirects===0)throw p;Zn(t,p);return}let u=o?443:80,f=B1(16).toString("base64"),c=o?R1.request:k1.request,h=new Set,d;if(n.createConnection=n.createConnection||(o?Q1:Y1),n.defaultPort=n.defaultPort||u,n.port=s.port||u,n.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,n.headers={...n.headers,"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":f,Connection:"Upgrade",Upgrade:"websocket"},n.path=s.pathname+s.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(d=new gt(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=V1({[gt.extensionName]:d.offer()})),r.length){for(let p of r){if(typeof p!="string"||!K1.test(p)||h.has(p))throw new SyntaxError("An invalid or duplicated subprotocol was specified");h.add(p)}n.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(s.username||s.password)&&(n.auth=`${s.username}:${s.password}`),a){let p=n.path.split(":");n.socketPath=p[0],n.path=p[1]}let _;if(n.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=o,t._originalHostOrSocketPath=a?n.socketPath:s.host;let p=i&&i.headers;if(i={...i,headers:{}},p)for(let[y,b]of Object.entries(p))i.headers[y.toLowerCase()]=b}else if(t.listenerCount("redirect")===0){let p=a?t._originalIpc?n.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:s.host===t._originalHostOrSocketPath;(!p||t._originalSecure&&!o)&&(delete n.headers.authorization,delete n.headers.cookie,p||delete n.headers.host,n.auth=void 0)}n.auth&&!i.headers.authorization&&(i.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),_=t._req=c(n),t._redirects&&t.emit("redirect",t.url,_)}else _=t._req=c(n);n.timeout&&_.on("timeout",()=>{ae(t,_,"Opening handshake has timed out")}),_.on("error",p=>{_===null||_[Sg]||(_=t._req=null,Zn(t,p))}),_.on("response",p=>{let y=p.headers.location,b=p.statusCode;if(y&&n.followRedirects&&b>=300&&b<400){if(++t._redirects>n.maxRedirects){ae(t,_,"Maximum redirects exceeded");return}_.abort();let m;try{m=new cl(y,e)}catch{let S=new SyntaxError(`Invalid URL: ${y}`);Zn(t,S);return}Eg(t,m,r,i)}else t.emit("unexpected-response",_,p)||ae(t,_,`Unexpected server response: ${p.statusCode}`)}),_.on("upgrade",(p,y,b)=>{if(t.emit("upgrade",p),t.readyState!==D.CONNECTING)return;_=t._req=null;let m=p.headers.upgrade;if(m===void 0||m.toLowerCase()!=="websocket"){ae(t,y,"Invalid Upgrade header");return}let A=q1("sha1").update(f+D1).digest("base64");if(p.headers["sec-websocket-accept"]!==A){ae(t,y,"Invalid Sec-WebSocket-Accept header");return}let S=p.headers["sec-websocket-protocol"],I;if(S!==void 0?h.size?h.has(S)||(I="Server sent an invalid subprotocol"):I="Server sent a subprotocol but none was requested":h.size&&(I="Server sent no subprotocol"),I){ae(t,y,I);return}S&&(t._protocol=S);let N=p.headers["sec-websocket-extensions"];if(N!==void 0){if(!d){ae(t,y,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let M;try{M=H1(N)}catch{ae(t,y,"Invalid Sec-WebSocket-Extensions header");return}let F=Object.keys(M);if(F.length!==1||F[0]!==gt.extensionName){ae(t,y,"Server indicated an extension that was not requested");return}try{d.accept(M[gt.extensionName])}catch{ae(t,y,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[gt.extensionName]=d}t.setSocket(y,b,{allowSynchronousEvents:n.allowSynchronousEvents,generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(_,t):_.end()}function Zn(t,e){t._readyState=D.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function Y1(t){return t.path=t.socketPath,mg.connect(t)}function Q1(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=mg.isIP(t.host)?"":t.host),M1.connect(t)}function ae(t,e,r){t._readyState=D.CLOSING;let i=new Error(r);Error.captureStackTrace(i,ae),e.setHeader?(e[Sg]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Zn,t,i)):(e.destroy(i),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function dl(t,e,r){if(e){let i=j1(e)?e.size:G1(e).length;t._socket?t._sender._bufferedBytes+=i:t._bufferedAmount+=i}if(r){let i=new Error(`WebSocket is not open: readyState ${t.readyState} (${Qe[t.readyState]})`);process.nextTick(r,i)}}function J1(t,e){let r=this[Y];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[Y]!==void 0&&(r._socket.removeListener("data",es),process.nextTick(vg,r._socket),t===1005?r.close():r.close(t,e))}function X1(){let t=this[Y];t.isPaused||t._socket.resume()}function Z1(t){let e=this[Y];e._socket[Y]!==void 0&&(e._socket.removeListener("data",es),process.nextTick(vg,e._socket),e.close(t[W1])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function yg(){this[Y].emitClose()}function eT(t,e){this[Y].emit("message",t,e)}function tT(t){let e=this[Y];e._autoPong&&e.pong(t,!this._isServer,wg),e.emit("ping",t)}function rT(t){this[Y].emit("pong",t)}function vg(t){t.resume()}function iT(t){let e=this[Y];e.readyState!==D.CLOSED&&(e.readyState===D.OPEN&&(e._readyState=D.CLOSING,Tg(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function Tg(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),z1)}function Ag(){let t=this[Y];this.removeListener("close",Ag),this.removeListener("data",es),this.removeListener("end",xg),t._readyState=D.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[Y]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",yg),t._receiver.on("finish",yg))}function es(t){this[Y]._receiver.write(t)||this.pause()}function xg(){let t=this[Y];t._readyState=D.CLOSING,t._receiver.end(),this.end()}function Ig(){let t=this[Y];this.removeListener("error",Ig),this.on("error",wg),t&&(t._readyState=D.CLOSING,this.destroy())}});var kg=g((XI,Rg)=>{"use strict";var{Duplex:nT}=E("stream");function Pg(t){t.emit("close")}function sT(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Cg(t){this.removeListener("error",Cg),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function oT(t,e){let r=!0,i=new nT({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(s,o){let a=!o&&i._readableState.objectMode?s.toString():s;i.push(a)||t.pause()}),t.once("error",function(s){i.destroyed||(r=!1,i.destroy(s))}),t.once("close",function(){i.destroyed||i.push(null)}),i._destroy=function(n,s){if(t.readyState===t.CLOSED){s(n),process.nextTick(Pg,i);return}let o=!1;t.once("error",function(l){o=!0,s(l)}),t.once("close",function(){o||s(n),process.nextTick(Pg,i)}),r&&t.terminate()},i._final=function(n){if(t.readyState===t.CONNECTING){t.once("open",function(){i._final(n)});return}t._socket!==null&&(t._socket._writableState.finished?(n(),i._readableState.endEmitted&&i.destroy()):(t._socket.once("finish",function(){n()}),t.close()))},i._read=function(){t.isPaused&&t.resume()},i._write=function(n,s,o){if(t.readyState===t.CONNECTING){t.once("open",function(){i._write(n,s,o)});return}t.send(n,o)},i.on("end",sT),i.on("error",Cg),i}Rg.exports=oT});var Bg=g((ZI,Mg)=>{"use strict";var{tokenChars:aT}=Ar();function lT(t){let e=new Set,r=-1,i=-1,n=0;for(n;n<t.length;n++){let o=t.charCodeAt(n);if(i===-1&&aT[o]===1)r===-1&&(r=n);else if(n!==0&&(o===32||o===9))i===-1&&r!==-1&&(i=n);else if(o===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${n}`);i===-1&&(i=n);let a=t.slice(r,i);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=i=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(r===-1||i!==-1)throw new SyntaxError("Unexpected end of input");let s=t.slice(r,n);if(e.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return e.add(s),e}Mg.exports={parse:lT}});var Wg=g((tO,Ug)=>{"use strict";var uT=E("events"),ts=E("http"),{Duplex:eO}=E("stream"),{createHash:cT}=E("crypto"),qg=ul(),Ft=ci(),fT=Bg(),hT=pl(),{GUID:dT,kWebSocket:pT}=ze(),gT=/^[+/0-9A-Za-z]{22}==$/,Ng=0,Lg=1,Dg=2,gl=class extends uT{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:hT,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=ts.createServer((i,n)=>{let s=ts.STATUS_CODES[426];n.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),n.end(s)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let i=this.emit.bind(this,"connection");this._removeListeners=_T(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,s,o)=>{this.handleUpgrade(n,s,o,i)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Ng}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Dg){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(pi,this);return}if(e&&this.once("close",e),this._state!==Lg)if(this._state=Lg,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(pi,this):process.nextTick(pi,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{pi(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,i,n){r.on("error",jg);let s=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){$t(this,e,r,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){$t(this,e,r,400,"Invalid Upgrade header");return}if(s===void 0||!gT.test(s)){$t(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==8&&a!==13){$t(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){gi(r,400);return}let l=e.headers["sec-websocket-protocol"],u=new Set;if(l!==void 0)try{u=fT.parse(l)}catch{$t(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let f=e.headers["sec-websocket-extensions"],c={};if(this.options.perMessageDeflate&&f!==void 0){let h=new Ft(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let d=qg.parse(f);d[Ft.extensionName]&&(h.accept(d[Ft.extensionName]),c[Ft.extensionName]=h)}catch{$t(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let h={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(h,(d,_,p,y)=>{if(!d)return gi(r,_||401,p,y);this.completeUpgrade(c,s,u,e,r,i,n)});return}if(!this.options.verifyClient(h))return gi(r,401)}this.completeUpgrade(c,s,u,e,r,i,n)}completeUpgrade(e,r,i,n,s,o,a){if(!s.readable||!s.writable)return s.destroy();if(s[pT])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ng)return gi(s,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${cT("sha1").update(r+dT).digest("base64")}`],f=new this.options.WebSocket(null,void 0,this.options);if(i.size){let c=this.options.handleProtocols?this.options.handleProtocols(i,n):i.values().next().value;c&&(u.push(`Sec-WebSocket-Protocol: ${c}`),f._protocol=c)}if(e[Ft.extensionName]){let c=e[Ft.extensionName].params,h=qg.format({[Ft.extensionName]:[c]});u.push(`Sec-WebSocket-Extensions: ${h}`),f._extensions=e}this.emit("headers",u,n),s.write(u.concat(`\r
`).join(`\r
`)),s.removeListener("error",jg),f.setSocket(s,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(pi,this)})),a(f,n)}};Ug.exports=gl;function _T(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let i of Object.keys(e))t.removeListener(i,e[i])}}function pi(t){t._state=Dg,t.emit("close")}function jg(){this.destroy()}function gi(t,e,r,i){r=r||ts.STATUS_CODES[e],i={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...i},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${ts.STATUS_CODES[e]}\r
`+Object.keys(i).map(n=>`${n}: ${i[n]}`).join(`\r
`)+`\r
\r
`+r)}function $t(t,e,r,i,n){if(t.listenerCount("wsClientError")){let s=new Error(n);Error.captureStackTrace(s,$t),t.emit("wsClientError",s,r,e)}else gi(r,i,n)}});var $g=g((rO,Fg)=>{"use strict";var Je=pl();Je.createWebSocketStream=kg();Je.Server=Wg();Je.Receiver=nl();Je.Sender=al();Je.WebSocket=Je;Je.WebSocketServer=Je.Server;Fg.exports=Je});var rs=g(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.BufferedDuplex=Cr.writev=void 0;var bT=ot(),Vg=E("buffer");function Hg(t,e){let r=new Array(t.length);for(let i=0;i<t.length;i++)typeof t[i].chunk=="string"?r[i]=Vg.Buffer.from(t[i].chunk,"utf8"):r[i]=t[i].chunk;this._write(Vg.Buffer.concat(r),"binary",e)}Cr.writev=Hg;var _l=class extends bT.Duplex{constructor(e,r,i){super({objectMode:!0}),this.proxy=r,this.socket=i,this.writeQueue=[],e.objectMode||(this._writev=Hg.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",n=>{this.destroyed||this.push(n)})}_read(e){this.proxy.read(e)}_write(e,r,i){this.isSocketOpen?this.writeToProxy(e,r,i):this.writeQueue.push({chunk:e,encoding:r,cb:i})}_final(e){this.writeQueue=[],this.proxy.end(e)}_destroy(e,r){this.writeQueue=[],this.proxy.destroy(),r(e)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(e,r,i){this.proxy.write(e,r)===!1?this.proxy.once("drain",i):i()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:e,encoding:r,cb:i}=this.writeQueue.shift();this.writeToProxy(e,r,i)}}};Cr.BufferedDuplex=_l});var _i=g(bt=>{"use strict";var yl=bt&&bt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(bt,"__esModule",{value:!0});bt.streamBuilder=bt.browserStreamBuilder=void 0;var is=E("buffer"),Gg=yl($g()),yT=yl(ke()),mT=ot(),wT=yl(si()),bl=rs(),_t=(0,yT.default)("mqttjs:ws"),ST=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function zg(t,e){let r=`${t.protocol}://${t.hostname}:${t.port}${t.path}`;return typeof t.transformWsUrl=="function"&&(r=t.transformWsUrl(r,t,e)),r}function Kg(t){let e=t;return t.port||(t.protocol==="wss"?e.port=443:e.port=80),t.path||(e.path="/"),t.wsOptions||(e.wsOptions={}),!wT.default&&!t.forceNativeWebSocket&&t.protocol==="wss"&&ST.forEach(r=>{Object.prototype.hasOwnProperty.call(t,r)&&!Object.prototype.hasOwnProperty.call(t.wsOptions,r)&&(e.wsOptions[r]=t[r])}),e}function ET(t){let e=Kg(t);if(e.hostname||(e.hostname=e.host),!e.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let r=new URL(document.URL);e.hostname=r.hostname,e.port||(e.port=Number(r.port))}return e.objectMode===void 0&&(e.objectMode=!(e.binary===!0||e.binary===void 0)),e}function vT(t,e,r){_t("createWebSocket"),_t(`protocol: ${r.protocolId} ${r.protocolVersion}`);let i=r.protocolId==="MQIsdp"&&r.protocolVersion===3?"mqttv3.1":"mqtt";_t(`creating new Websocket for url: ${e} and protocol: ${i}`);let n;return r.createWebsocket?n=r.createWebsocket(e,[i],r):n=new Gg.default(e,[i],r.wsOptions),n}function TT(t,e){let r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt",i=zg(e,t),n;return e.createWebsocket?n=e.createWebsocket(i,[r],e):n=new WebSocket(i,[r]),n.binaryType="arraybuffer",n}var AT=(t,e)=>{_t("streamBuilder");let r=Kg(e);r.hostname=r.hostname||r.host||"localhost";let i=zg(r,t),n=vT(t,i,r),s=Gg.default.createWebSocketStream(n,r.wsOptions);return s.url=i,n.on("close",()=>{s.destroy()}),s};bt.streamBuilder=AT;var xT=(t,e)=>{_t("browserStreamBuilder");let r,n=ET(e).browserBufferSize||1024*512,s=e.browserBufferTimeout||1e3,o=!e.objectMode,a=TT(t,e),l=f(e,p,y);e.objectMode||(l._writev=bl.writev.bind(l)),l.on("close",()=>{a.close()});let u=typeof a.addEventListener<"u";a.readyState===a.OPEN?(r=l,r.socket=a):(r=new bl.BufferedDuplex(e,l,a),u?a.addEventListener("open",c):a.onopen=c),u?(a.addEventListener("close",h),a.addEventListener("error",d),a.addEventListener("message",_)):(a.onclose=h,a.onerror=d,a.onmessage=_);function f(b,m,A){let S=new mT.Transform({objectMode:b.objectMode});return S._write=m,S._flush=A,S}function c(){_t("WebSocket onOpen"),r instanceof bl.BufferedDuplex&&r.socketReady()}function h(b){_t("WebSocket onClose",b),r.end(),r.destroy()}function d(b){_t("WebSocket onError",b);let m=new Error("WebSocket error");m.event=b,r.destroy(m)}async function _(b){let{data:m}=b;m instanceof ArrayBuffer?m=is.Buffer.from(m):m instanceof Blob?m=is.Buffer.from(await new Response(m).arrayBuffer()):m=is.Buffer.from(m,"utf8"),l&&!l.destroyed&&l.push(m)}function p(b,m,A){if(a.bufferedAmount>n){setTimeout(p,s,b,m,A);return}o&&typeof b=="string"&&(b=is.Buffer.from(b,"utf8"));try{a.send(b)}catch(S){return A(S)}A()}function y(b){a.close(),b()}return r};bt.browserStreamBuilder=xT});var ml=g(bi=>{"use strict";var Yg=bi&&bi.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(bi,"__esModule",{value:!0});var IT=Yg(E("net")),OT=Yg(ke()),PT=(0,OT.default)("mqttjs:tcp"),CT=(t,e)=>{e.port=e.port||1883,e.hostname=e.hostname||e.host||"localhost";let{port:r,path:i}=e,n=e.hostname;return PT("port %d and host %s",r,n),IT.default.createConnection({port:r,host:n,path:i})};bi.default=CT});var Sl=g(yi=>{"use strict";var wl=yi&&yi.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(yi,"__esModule",{value:!0});var RT=wl(E("tls")),kT=wl(E("net")),MT=wl(ke()),BT=(0,MT.default)("mqttjs:tls"),qT=(t,e)=>{e.port=e.port||8883,e.host=e.hostname||e.host||"localhost",kT.default.isIP(e.host)===0&&(e.servername=e.host),e.rejectUnauthorized=e.rejectUnauthorized!==!1,delete e.path,BT("port %d host %s rejectUnauthorized %b",e.port,e.host,e.rejectUnauthorized);let r=RT.default.connect(e);r.on("secureConnect",()=>{e.rejectUnauthorized&&!r.authorized?r.emit("error",new Error("TLS not authorized")):r.removeListener("error",i)});function i(n){e.rejectUnauthorized&&t.emit("error",n),r.end()}return r.on("error",i),r};yi.default=qT});var Tl=g(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});var Qg=E("buffer"),NT=ot(),LT=rs(),Ue,El,le;function jT(){let t=new NT.Transform;return t._write=(e,r,i)=>{Ue.send({data:e.buffer,success(){i()},fail(n){i(new Error(n))}})},t._flush=e=>{Ue.close({success(){e()}})},t}function DT(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}function UT(t,e){let r=t.protocol==="wxs"?"wss":"ws",i=`${r}://${t.hostname}${t.path}`;return t.port&&t.port!==80&&t.port!==443&&(i=`${r}://${t.hostname}:${t.port}${t.path}`),typeof t.transformWsUrl=="function"&&(i=t.transformWsUrl(i,t,e)),i}function WT(){Ue.onOpen(()=>{le.socketReady()}),Ue.onMessage(t=>{let{data:e}=t;e instanceof ArrayBuffer?e=Qg.Buffer.from(e):e=Qg.Buffer.from(e,"utf8"),El.push(e)}),Ue.onClose(()=>{le.emit("close"),le.end(),le.destroy()}),Ue.onError(t=>{let e=new Error(t.errMsg);le.destroy(e)})}var FT=(t,e)=>{if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");let r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt";DT(e);let i=UT(e,t);Ue=wx.connectSocket({url:i,protocols:[r]}),El=jT(),le=new LT.BufferedDuplex(e,El,Ue),le._destroy=(s,o)=>{Ue.close({success(){o&&o(s)}})};let n=le.destroy;return le.destroy=(s,o)=>(le.destroy=n,setTimeout(()=>{Ue.close({fail(){le._destroy(s,o)}})},0),le),WT(),le};vl.default=FT});var Il=g(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});var Al=E("buffer"),$T=ot(),VT=rs(),Xe,ns,Rr,Jg=!1;function HT(){let t=new $T.Transform;return t._write=(e,r,i)=>{Xe.sendSocketMessage({data:e.buffer,success(){i()},fail(){i(new Error)}})},t._flush=e=>{Xe.closeSocket({success(){e()}})},t}function GT(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}function zT(t,e){let r=t.protocol==="alis"?"wss":"ws",i=`${r}://${t.hostname}${t.path}`;return t.port&&t.port!==80&&t.port!==443&&(i=`${r}://${t.hostname}:${t.port}${t.path}`),typeof t.transformWsUrl=="function"&&(i=t.transformWsUrl(i,t,e)),i}function KT(){Jg||(Jg=!0,Xe.onSocketOpen(()=>{Rr.socketReady()}),Xe.onSocketMessage(t=>{if(typeof t.data=="string"){let e=Al.Buffer.from(t.data,"base64");ns.push(e)}else{let e=new FileReader;e.addEventListener("load",()=>{let r=e.result;r instanceof ArrayBuffer?r=Al.Buffer.from(r):r=Al.Buffer.from(r,"utf8"),ns.push(r)}),e.readAsArrayBuffer(t.data)}}),Xe.onSocketClose(()=>{Rr.end(),Rr.destroy()}),Xe.onSocketError(t=>{Rr.destroy(t)}))}var YT=(t,e)=>{if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");let r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt";GT(e);let i=zT(e,t);return Xe=e.my,Xe.connectSocket({url:i,protocols:r}),ns=HT(),Rr=new VT.BufferedDuplex(e,ns,Xe),KT(),Rr};xl.default=YT});var e_=g(Vt=>{"use strict";var ss=Vt&&Vt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.connectAsync=void 0;var QT=ss(ke()),JT=ss(E("url")),XT=ss(Fn()),ZT=ss(si());typeof(process==null?void 0:process.nextTick)!="function"&&(process.nextTick=setImmediate);var Xg=(0,QT.default)("mqttjs"),G=null;function eA(t){let e;t.auth&&(e=t.auth.match(/^(.+):(.+)$/),e?(t.username=e[1],t.password=e[2]):t.username=t.auth)}function Zg(t,e){var r,i,n,s;if(Xg("connecting to an MQTT broker..."),typeof t=="object"&&!e&&(e=t,t=""),e=e||{},t&&typeof t=="string"){let l=JT.default.parse(t,!0),u={};if(l.port!=null&&(u.port=Number(l.port)),u.host=l.hostname,u.query=l.query,u.auth=l.auth,u.protocol=l.protocol,u.path=l.path,u.protocol=(r=u.protocol)===null||r===void 0?void 0:r.replace(/:$/,""),e=Object.assign(Object.assign({},u),e),!e.protocol)throw new Error("Missing protocol")}if(e.unixSocket=e.unixSocket||((i=e.protocol)===null||i===void 0?void 0:i.includes("+unix")),e.unixSocket?e.protocol=e.protocol.replace("+unix",""):!(!((n=e.protocol)===null||n===void 0)&&n.startsWith("ws"))&&!(!((s=e.protocol)===null||s===void 0)&&s.startsWith("wx"))&&delete e.path,eA(e),e.query&&typeof e.query.clientId=="string"&&(e.clientId=e.query.clientId),e.cert&&e.key)if(e.protocol){if(["mqtts","wss","wxs","alis"].indexOf(e.protocol)===-1)switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error(`Unknown protocol for secure connection: "${e.protocol}"!`)}}else throw new Error("Missing secure protocol key");if(G||(G={},!ZT.default&&!e.forceNativeWebSocket?(G.ws=_i().streamBuilder,G.wss=_i().streamBuilder,G.mqtt=ml().default,G.tcp=ml().default,G.ssl=Sl().default,G.tls=G.ssl,G.mqtts=Sl().default):(G.ws=_i().browserStreamBuilder,G.wss=_i().browserStreamBuilder,G.wx=Tl().default,G.wxs=Tl().default,G.ali=Il().default,G.alis=Il().default)),!G[e.protocol]){let l=["mqtts","wss"].indexOf(e.protocol)!==-1;e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((u,f)=>l&&f%2===0?!1:typeof G[u]=="function")[0]}if(e.clean===!1&&!e.clientId)throw new Error("Missing clientId for unclean clients");e.protocol&&(e.defaultProtocol=e.protocol);function o(l){return e.servers&&((!l._reconnectCount||l._reconnectCount===e.servers.length)&&(l._reconnectCount=0),e.host=e.servers[l._reconnectCount].host,e.port=e.servers[l._reconnectCount].port,e.protocol=e.servers[l._reconnectCount].protocol?e.servers[l._reconnectCount].protocol:e.defaultProtocol,e.hostname=e.host,l._reconnectCount++),Xg("calling streambuilder for",e.protocol),G[e.protocol](l,e)}let a=new XT.default(o,e);return a.on("error",()=>{}),a}function tA(t,e,r=!0){return new Promise((i,n)=>{let s=Zg(t,e),o={connect:l=>{a(),i(s)},end:()=>{a(),i(s)},error:l=>{a(),s.end(),n(l)}};r===!1&&(o.close=()=>{o.error(new Error("Couldn't connect to server"))});function a(){Object.keys(o).forEach(l=>{s.off(l,o[l])})}Object.keys(o).forEach(l=>{s.on(l,o[l])})})}Vt.connectAsync=tA;Vt.default=Zg});var Ol=g(k=>{"use strict";var t_=k&&k.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),rA=k&&k.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),iA=k&&k.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&t_(e,t,r);return rA(e,t),e},r_=k&&k.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&t_(e,t,r)},mi=k&&k.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(k,"__esModule",{value:!0});k.ReasonCodes=k.KeepaliveManager=k.UniqueMessageIdProvider=k.DefaultMessageIdProvider=k.Store=k.MqttClient=k.connectAsync=k.connect=k.Client=void 0;var i_=mi(Fn());k.MqttClient=i_.default;var nA=mi(zo());k.DefaultMessageIdProvider=nA.default;var sA=mi(Lp());k.UniqueMessageIdProvider=sA.default;var oA=mi(Qo());k.Store=oA.default;var n_=iA(e_());k.connect=n_.default;Object.defineProperty(k,"connectAsync",{enumerable:!0,get:function(){return n_.connectAsync}});var aA=mi($a());k.KeepaliveManager=aA.default;k.Client=i_.default;r_(Fn(),k);r_(Rt(),k);var lA=ei();Object.defineProperty(k,"ReasonCodes",{enumerable:!0,get:function(){return lA.ReasonCodes}})});var o_=g(be=>{"use strict";var s_=be&&be.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),uA=be&&be.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),cA=be&&be.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&s_(e,t,r);return uA(e,t),e},fA=be&&be.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&s_(e,t,r)};Object.defineProperty(be,"__esModule",{value:!0});var hA=cA(Ol());be.default=hA;fA(Ol(),be)});var Ml=as(kl(),1);import{setTimeout as w_}from"timers/promises";var S_=250;async function us(t,e){let r=await(0,Ml.requestGPIOAccess)(),i=r.ports.get(t);if(!i)throw new Error(`GPIO(${t}) initialization failed.`);await i.export("out");let n=r.ports.get(e);if(!n)throw new Error(`GPIO(${e}) initialization failed.`);return await n.export("in"),console.log("jema: initialized",{controlGpio:t,monitorGpio:e}),{sendControl:async()=>{await i.write(1),await w_(S_),await i.write(0)},getMonitor:async()=>await n.read()===1,setMonitorListener:s=>{n.onchange=({value:o})=>s(o===1)},close:async()=>{for(let s of[i,n]){let{portNumber:o}=s;try{await s.unexport(),console.log(`jema: GPIO(${o}) successfully unexported.`)}catch(a){console.error(`jema: Failed to unexport GPIO(${o}):`,a)}}}}}var zt=as(Eu(),1),a_=as(o_(),1);import dA from"fs/promises";var Ht={COMMAND:"set",STATE:"state",AVAILABILITY:"availability"},yt={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"};function Gt(t,e){return`jema2mqtt/${t.id}/${e}`}async function pA(){console.log("jema2mqtt: start");let t=zt.default.get("HA_DISCOVERY_PREFIX").default("homeassistant").asString(),e=zt.default.get("QOS").default(1).asIntPositive(),{deviceId:r,entities:i}=JSON.parse(await dA.readFile("./config.json","utf-8")),n=c=>{let h={unique_id:`jema2mqtt_${r}_${c.id}`,name:c.name,optimistic:!1,device:{identifiers:[`jema2mqtt_${r}`],name:`jema2mqtt.${r}`,model:"jema2mqtt",manufacturer:"nana4rider"},origin:{name:"jema2mqtt",sw_version:"1.0.0",support_url:"https://github.com/nana4rider/jema2mqtt"}},{domain:d}=c;if(d==="lock"||d==="switch")return{...h,command_topic:Gt(c,Ht.COMMAND),state_topic:Gt(c,Ht.STATE),availability_topic:Gt(c,Ht.AVAILABILITY),payload_lock:yt.ACTIVE,payload_unlock:yt.INACTIVE,state_locked:yt.ACTIVE,state_unlocked:yt.INACTIVE,qos:e,retain:!0};throw new Error(`unknown domain: ${c.domain}`)},s=new Map(await Promise.all(i.map(async({id:c,controlGpio:h,monitorGpio:d})=>{let _=await us(h,d);return[c,_]}))),o=await a_.default.connectAsync(zt.default.get("MQTT_BROKER").required().asString(),{username:zt.default.get("MQTT_USERNAME").asString(),password:zt.default.get("MQTT_PASSWORD").asString()});console.log("mqtt-client: connected"),await o.subscribeAsync(i.map(c=>Gt(c,Ht.COMMAND)));let a=async(c,h)=>{let d=i.find(y=>Gt(y,Ht.COMMAND)===c);if(!d)return;let _=s.get(d.id),p=await _.getMonitor();(h===yt.ACTIVE&&!p||h===yt.INACTIVE&&p)&&await _.sendControl()};o.on("message",(c,h)=>{a(c,h.toString())}),await Promise.all(i.map(async c=>{let h=p=>o.publishAsync(Gt(c,Ht.STATE),p?yt.ACTIVE:yt.INACTIVE,{retain:!0}),d=s.get(c.id);d.setMonitorListener(p=>void h(p)),await h(await d.getMonitor());let _=n(c);await o.publishAsync(`${t}/${c.domain}/${_.unique_id}/config`,JSON.stringify(_),{retain:!0})}));let l=c=>Promise.all(i.map(h=>o.publishAsync(Gt(h,Ht.AVAILABILITY),c))),u=setInterval(()=>void l("online"),zt.default.get("AVAILABILITY_INTERVAL").default(1e4).asIntPositive()),f=async()=>{console.log("jema2mqtt: shutdown"),clearInterval(u),await l("offline"),await o.endAsync(),console.log("mqtt-client: closed"),await Promise.all(Array.from(s.values())),process.exit(0)};process.on("SIGINT",()=>void f()),process.on("SIGTERM",()=>void f()),await l("online"),console.log("jema2mqtt: ready")}try{await pA()}catch(t){console.error("jema2mqtt:",t),process.exit(1)}
